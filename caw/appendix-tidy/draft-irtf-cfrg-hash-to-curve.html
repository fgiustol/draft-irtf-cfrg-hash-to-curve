<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Hashing to Elliptic Curves</title>
<meta content="Armando Faz-Hernandez" name="author">
<meta content="Sam Scott" name="author">
<meta content="Nick Sullivan" name="author">
<meta content="Riad S. Wahby" name="author">
<meta content="Christopher A. Wood" name="author">
<meta content="
       This document specifies a number of algorithms that may be used to encode or hash an
arbitrary string to a point on an elliptic curve. 
    " name="description">
<meta content="xml2rfc 2.37.3" name="generator">
<meta content="Internet-Draft" name="keyword">
<meta content="draft-irtf-cfrg-hash-to-curve-latest" name="ietf.draft">
<link href="draft-irtf-cfrg-hash-to-curve.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">@import url('https://martinthomson.github.io/i-d-template/fonts.css');

html {
  --background-color: #fff;
  --text-color: #222;
  --title-color: #191919;
  --link-color: #2a6496;
  --highlight-color: #f9f9f9;
  --line-color: #eee;
  --small-font-size: 14.5px;
}
body {
  max-width: 624px;
  margin: 75px auto;
  padding: 0 5px;
  color: var(--text-color);
  background-color: var(--background-color);
  font: 16px/22px "Lora", serif;
  scroll-behavior: smooth;
}

.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  font-family: "Cabin Condensed", sans-serif;
  font-weight: 600;
  margin: 0.8em 0 0.3em;
  font-size-adjust: 0.5;
  color: var(--title-color);
}
#title {
  padding: 1em 0 0.2em;
  font-size: 32px;
  line-height: 40px;
  clear: both;
}
h1, h2, h3 {
  font-size: 22px;
  line-height: 26px;
}
h4, h5, h6 {
  font-size: 18px;
  line-height: 22px;
}

/* general structure */
.author {
  padding-bottom: 0.3em;
}
#abstract+p, #abstract+p code, #abstract+p samp, #abstract+p tt {
  font-size: 18px;
  line-height: 24px;
}
p {
  padding: 0;
  margin: 0.5em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignRight.art-text pre {
  padding: 0;
  width: auto;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignCenter.art-text pre {
  padding: 0;
  width: auto;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a, a[href].selfRef:hover {
  text-decoration: none;
}
a[href].selfRef {
  color: var(--text-color);
}
a[href] {
  color: var(--link-color);
}
a[href]:hover {
  text-decoration: underline;
}
a[href].selfRef:hover {
  background-color: var(--highlight-color);
}

/* Figures */
tt, code, pre {
  background-color: var(--highlight-color);
  font: 14px/22px 'Oxygen Mono', monospace;
}
pre {
  border: 1px solid var(--line-color);
  line-height: 17px;
  margin: 5px;
  padding: 5px;
}
img {
  max-width: 100%;
}
figure {
  margin: 0.5em 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption, caption {
  font-style: italic;
  margin: 0.5em 1.5em;
  text-align: left;
}
@media screen {
  pre {
    display: inline-block;
    overflow-x: auto;
    max-width: 100%;
    width: calc(100% - 22px - 1em);
  }
  figure pre {
    display: block;
    width: calc(100% - 25px);
  }
  pre + .pilcrow {
    display: inline-block;
    vertical-align: text-bottom;
    padding-bottom: 8px;
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 0 2em;
  font-style: italic;
}
blockquote {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid var(--line-color);
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #eee;
}
tr:nth-child(2n) > td {
  background-color: var(--background-color);
}
tr:nth-child(2n+1) > td {
  background-color: var(--highlight-color);
}
thead+tbody tr:nth-child(2n) > td {
  background-color: var(--highlight-color);
}
thead+tbody tr:nth-child(2n+1) > td {
  background-color: var(--background-color);
}
table caption {
  font-style: italic;
  margin: 0.3em 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  margin-left: 3px;
  visibility: hidden;
  user-select: none;
}
a.pilcrow[href] { color: #ddd; }
a.pilcrow[href]:hover { text-decoration: none; }
@media screen {
  :hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid var(--line-color);
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: var(--small-font-size);
  line-height: 18px;
  --identifier-width: 8em;
}
#identifiers dt {
  width: var(--identifier-width);
  margin: 0;
  clear: left;
  float: left;
  text-align: right;
}
#identifiers dd {
  margin: 0 0 0 calc(1em + var(--identifier-width));
  min-width: 5em;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
#toc nav ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
#toc nav li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    column-count: 2;
    column-gap: 20px;
  }
  .index ul ul {
    column-count: 1;
    column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}
address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}
@media (min-width: 600px) {
  #authors-addresses {
    display: relative;
    padding: 32px 0 0;
    column-count: 2;
    column-gap: 20px;
  }
  #name-authors-addresses {
    position: absolute;
    top: 0px;
    column-span: all;
  }
  /* hack for break-inside: avoid-column */
  #authors-addresses address {
    display: inline-block;
  }
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #b76427;
  background-color: rgba(249, 232, 105, 0.3);
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: rgba(249, 232, 105, 0.3);
  border-radius: 3px;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 953px) {
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    border-bottom: 1px solid #ccc;
    opacity: 0.6;
  }
  #toc.active {
      opacity: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 2px 0 2px 6px;
    padding-right: 1em;
    font-size: 18px;
    line-height: 24px;
    min-width: 190px;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 8px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    background-color: var(--background-color);
    padding: 0.5em 1em 1em;
    overflow: auto;
    overscroll-behavior: contain;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
  #toc.active nav {
    display: block;
  }
  /* Make the collapsed ToC header render white on gray also when it's a link */
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
  #toc a.toplink {
    margin-top: 2px;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 954px) {
  body {
    padding-right: 380px;
  }
  #toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 480px);
    width: 312px;
    margin: 0;
    padding: 0;
    z-index: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 2em;
    overflow: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  #toc nav > ul  {
    margin-bottom: 2em;
  }
  #toc ul {
    margin: 0 0 0 4px;
    font-size: var(--small-font-size);
  }
  #toc ul p, #toc ul li {
    margin: 2px 0;
    line-height: 22px;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Changes introduced to fix issues found during implementation */

/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}

/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin: 8px 0.5em 0;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact information look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 20em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  dd {
    page-break-before: avoid;
  }
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css">
</head>
<body>
<script src="metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">hash-to-curve</td>
<td class="right">February 2020</td>
</tr></thead>
<tfoot><tr>
<td class="left">Faz-Hernandez, et al.</td>
<td class="center">Expires 19 August 2020</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">Network Working Group</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-irtf-cfrg-hash-to-curve-latest</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2020-02-16" class="published">16 February 2020</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Informational</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2020-08-19">19 August 2020</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">A. Faz-Hernandez</div>
<div class="org">Cloudflare</div>
</div>
<div class="author">
      <div class="author-name">S. Scott</div>
<div class="org">Cornell Tech</div>
</div>
<div class="author">
      <div class="author-name">N. Sullivan</div>
<div class="org">Cloudflare</div>
</div>
<div class="author">
      <div class="author-name">R.S. Wahby</div>
<div class="org">Stanford University</div>
</div>
<div class="author">
      <div class="author-name">C.A. Wood</div>
<div class="org">Apple Inc.</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Hashing to Elliptic Curves</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">This document specifies a number of algorithms that may be used to encode or hash an
arbitrary string to a point on an elliptic curve.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 19 August 2020.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2020 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Simplified BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Simplified BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1"><a href="#section-1" class="xref">1</a>.  <a href="#name-introduction" class="xref">Introduction</a><a href="#section-toc.1-1.1.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1"><a href="#section-1.1" class="xref">1.1</a>.  <a href="#name-how-to-use-this-document" class="xref">How to use this document</a><a href="#section-toc.1-1.1.2.1.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.1.2.2">
                <p id="section-toc.1-1.1.2.2.1"><a href="#section-1.2" class="xref">1.2</a>.  <a href="#name-requirements" class="xref">Requirements</a><a href="#section-toc.1-1.1.2.2.1" class="pilcrow">¶</a></p>
</li>
</ul>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="xref">2</a>.  <a href="#name-background" class="xref">Background</a><a href="#section-toc.1-1.2.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.2.2.1">
                <p id="section-toc.1-1.2.2.1.1"><a href="#section-2.1" class="xref">2.1</a>.  <a href="#name-elliptic-curves" class="xref">Elliptic curves</a><a href="#section-toc.1-1.2.2.1.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.2.2.2">
                <p id="section-toc.1-1.2.2.2.1"><a href="#section-2.2" class="xref">2.2</a>.  <a href="#name-terminology" class="xref">Terminology</a><a href="#section-toc.1-1.2.2.2.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.2.2.2.2.1">
                    <p id="section-toc.1-1.2.2.2.2.1.1"><a href="#section-2.2.1" class="xref">2.2.1</a>.  <a href="#name-mappings" class="xref">Mappings</a><a href="#section-toc.1-1.2.2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.2.2.2.2.2">
                    <p id="section-toc.1-1.2.2.2.2.2.1"><a href="#section-2.2.2" class="xref">2.2.2</a>.  <a href="#name-encodings" class="xref">Encodings</a><a href="#section-toc.1-1.2.2.2.2.2.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.2.2.2.2.3">
                    <p id="section-toc.1-1.2.2.2.2.3.1"><a href="#section-2.2.3" class="xref">2.2.3</a>.  <a href="#name-random-oracle-encodings" class="xref">Random oracle encodings</a><a href="#section-toc.1-1.2.2.2.2.3.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.2.2.2.2.4">
                    <p id="section-toc.1-1.2.2.2.2.4.1"><a href="#section-2.2.4" class="xref">2.2.4</a>.  <a href="#name-serialization" class="xref">Serialization</a><a href="#section-toc.1-1.2.2.2.2.4.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.2.2.2.2.5">
                    <p id="section-toc.1-1.2.2.2.2.5.1"><a href="#section-2.2.5" class="xref">2.2.5</a>.  <a href="#name-domain-separation" class="xref">Domain separation</a><a href="#section-toc.1-1.2.2.2.2.5.1" class="pilcrow">¶</a></p>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="xref">3</a>.  <a href="#name-roadmap" class="xref">Roadmap</a><a href="#section-toc.1-1.3.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="xref">3.1</a>.  <a href="#name-domain-separation-requireme" class="xref">Domain separation requirements</a><a href="#section-toc.1-1.3.2.1.1" class="pilcrow">¶</a></p>
</li>
</ul>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="xref">4</a>.  <a href="#name-utility-functions" class="xref">Utility Functions</a><a href="#section-toc.1-1.4.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="xref">4.1</a>.  <a href="#name-sgn0-variants" class="xref">sgn0 variants</a><a href="#section-toc.1-1.4.2.1.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.4.2.1.2.1">
                    <p id="section-toc.1-1.4.2.1.2.1.1"><a href="#section-4.1.1" class="xref">4.1.1</a>.  <a href="#name-big-endian-variant" class="xref">Big endian variant</a><a href="#section-toc.1-1.4.2.1.2.1.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.4.2.1.2.2">
                    <p id="section-toc.1-1.4.2.1.2.2.1"><a href="#section-4.1.2" class="xref">4.1.2</a>.  <a href="#name-little-endian-variant" class="xref">Little endian variant</a><a href="#section-toc.1-1.4.2.1.2.2.1" class="pilcrow">¶</a></p>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="xref">5</a>.  <a href="#name-hashing-to-a-finite-field" class="xref">Hashing to a Finite Field</a><a href="#section-toc.1-1.5.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="xref">5.1</a>.  <a href="#name-security-considerations" class="xref">Security considerations</a><a href="#section-toc.1-1.5.2.1.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="xref">5.2</a>.  <a href="#name-performance-considerations" class="xref">Performance considerations</a><a href="#section-toc.1-1.5.2.2.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.5.2.3">
                <p id="section-toc.1-1.5.2.3.1"><a href="#section-5.3" class="xref">5.3</a>.  <a href="#name-implementation" class="xref">Implementation</a><a href="#section-toc.1-1.5.2.3.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.5.2.4">
                <p id="section-toc.1-1.5.2.4.1"><a href="#section-5.4" class="xref">5.4</a>.  <a href="#name-alternative-hash_to_base-fu" class="xref">Alternative hash_to_base functions</a><a href="#section-toc.1-1.5.2.4.1" class="pilcrow">¶</a></p>
</li>
</ul>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="xref">6</a>.  <a href="#name-deterministic-mappings" class="xref">Deterministic Mappings</a><a href="#section-toc.1-1.6.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="xref">6.1</a>.  <a href="#name-choosing-a-mapping-function" class="xref">Choosing a mapping function</a><a href="#section-toc.1-1.6.2.1.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.6.2.2">
                <p id="section-toc.1-1.6.2.2.1"><a href="#section-6.2" class="xref">6.2</a>.  <a href="#name-interface" class="xref">Interface</a><a href="#section-toc.1-1.6.2.2.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.6.2.3">
                <p id="section-toc.1-1.6.2.3.1"><a href="#section-6.3" class="xref">6.3</a>.  <a href="#name-notation" class="xref">Notation</a><a href="#section-toc.1-1.6.2.3.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.6.2.4">
                <p id="section-toc.1-1.6.2.4.1"><a href="#section-6.4" class="xref">6.4</a>.  <a href="#name-sign-of-the-resulting-point" class="xref">Sign of the resulting point</a><a href="#section-toc.1-1.6.2.4.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.6.2.5">
                <p id="section-toc.1-1.6.2.5.1"><a href="#section-6.5" class="xref">6.5</a>.  <a href="#name-exceptional-cases" class="xref">Exceptional cases</a><a href="#section-toc.1-1.6.2.5.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.6.2.6">
                <p id="section-toc.1-1.6.2.6.1"><a href="#section-6.6" class="xref">6.6</a>.  <a href="#name-mappings-for-weierstrass-cu" class="xref">Mappings for Weierstrass curves</a><a href="#section-toc.1-1.6.2.6.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.6.2.6.2.1">
                    <p id="section-toc.1-1.6.2.6.2.1.1"><a href="#section-6.6.1" class="xref">6.6.1</a>.  <a href="#name-shallue-van-de-woestijne-me" class="xref">Shallue-van de Woestijne Method</a><a href="#section-toc.1-1.6.2.6.2.1.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.6.2.6.2.2">
                    <p id="section-toc.1-1.6.2.6.2.2.1"><a href="#section-6.6.2" class="xref">6.6.2</a>.  <a href="#name-simplified-shallue-van-de-w" class="xref">Simplified Shallue-van de Woestijne-Ulas Method</a><a href="#section-toc.1-1.6.2.6.2.2.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.6.2.6.2.3">
                    <p id="section-toc.1-1.6.2.6.2.3.1"><a href="#section-6.6.3" class="xref">6.6.3</a>.  <a href="#name-simplified-swu-for-ab-0" class="xref">Simplified SWU for AB == 0</a><a href="#section-toc.1-1.6.2.6.2.3.1" class="pilcrow">¶</a></p>
</li>
</ul>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.6.2.7">
                <p id="section-toc.1-1.6.2.7.1"><a href="#section-6.7" class="xref">6.7</a>.  <a href="#name-mappings-for-montgomery-cur" class="xref">Mappings for Montgomery curves</a><a href="#section-toc.1-1.6.2.7.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.6.2.7.2.1">
                    <p id="section-toc.1-1.6.2.7.2.1.1"><a href="#section-6.7.1" class="xref">6.7.1</a>.  <a href="#name-elligator-2-method" class="xref">Elligator 2 Method</a><a href="#section-toc.1-1.6.2.7.2.1.1" class="pilcrow">¶</a></p>
</li>
</ul>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.6.2.8">
                <p id="section-toc.1-1.6.2.8.1"><a href="#section-6.8" class="xref">6.8</a>.  <a href="#name-mappings-for-twisted-edward" class="xref">Mappings for Twisted Edwards curves</a><a href="#section-toc.1-1.6.2.8.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.6.2.8.2.1">
                    <p id="section-toc.1-1.6.2.8.2.1.1"><a href="#section-6.8.1" class="xref">6.8.1</a>.  <a href="#name-rational-maps-from-montgome" class="xref">Rational maps from Montgomery to twisted Edwards curves</a><a href="#section-toc.1-1.6.2.8.2.1.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.6.2.8.2.2">
                    <p id="section-toc.1-1.6.2.8.2.2.1"><a href="#section-6.8.2" class="xref">6.8.2</a>.  <a href="#name-elligator-2-method-2" class="xref">Elligator 2 Method</a><a href="#section-toc.1-1.6.2.8.2.2.1" class="pilcrow">¶</a></p>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="xref">7</a>.  <a href="#name-clearing-the-cofactor" class="xref">Clearing the cofactor</a><a href="#section-toc.1-1.7.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="xref">8</a>.  <a href="#name-suites-for-hashing" class="xref">Suites for Hashing</a><a href="#section-toc.1-1.8.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.8.2.1">
                <p id="section-toc.1-1.8.2.1.1"><a href="#section-8.1" class="xref">8.1</a>.  <a href="#name-defining-a-new-hash-to-curv" class="xref">Defining a new hash-to-curve suite</a><a href="#section-toc.1-1.8.2.1.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.8.2.2">
                <p id="section-toc.1-1.8.2.2.1"><a href="#section-8.2" class="xref">8.2</a>.  <a href="#name-suite-id-naming-conventions" class="xref">Suite ID naming conventions</a><a href="#section-toc.1-1.8.2.2.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.8.2.3">
                <p id="section-toc.1-1.8.2.3.1"><a href="#section-8.3" class="xref">8.3</a>.  <a href="#name-suites-for-nist-p-256" class="xref">Suites for NIST P-256</a><a href="#section-toc.1-1.8.2.3.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.8.2.4">
                <p id="section-toc.1-1.8.2.4.1"><a href="#section-8.4" class="xref">8.4</a>.  <a href="#name-suites-for-nist-p-384" class="xref">Suites for NIST P-384</a><a href="#section-toc.1-1.8.2.4.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.8.2.5">
                <p id="section-toc.1-1.8.2.5.1"><a href="#section-8.5" class="xref">8.5</a>.  <a href="#name-suites-for-nist-p-521" class="xref">Suites for NIST P-521</a><a href="#section-toc.1-1.8.2.5.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.8.2.6">
                <p id="section-toc.1-1.8.2.6.1"><a href="#section-8.6" class="xref">8.6</a>.  <a href="#name-suites-for-curve25519-and-e" class="xref">Suites for curve25519 and edwards25519</a><a href="#section-toc.1-1.8.2.6.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.8.2.7">
                <p id="section-toc.1-1.8.2.7.1"><a href="#section-8.7" class="xref">8.7</a>.  <a href="#name-suites-for-curve448-and-edw" class="xref">Suites for curve448 and edwards448</a><a href="#section-toc.1-1.8.2.7.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.8.2.8">
                <p id="section-toc.1-1.8.2.8.1"><a href="#section-8.8" class="xref">8.8</a>.  <a href="#name-suites-for-secp256k1" class="xref">Suites for secp256k1</a><a href="#section-toc.1-1.8.2.8.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.8.2.9">
                <p id="section-toc.1-1.8.2.9.1"><a href="#section-8.9" class="xref">8.9</a>.  <a href="#name-suites-for-bls12-381" class="xref">Suites for BLS12-381</a><a href="#section-toc.1-1.8.2.9.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.8.2.9.2.1">
                    <p id="section-toc.1-1.8.2.9.2.1.1"><a href="#section-8.9.1" class="xref">8.9.1</a>.  <a href="#name-bls12-381-g1" class="xref">BLS12-381 G1</a><a href="#section-toc.1-1.8.2.9.2.1.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.8.2.9.2.2">
                    <p id="section-toc.1-1.8.2.9.2.2.1"><a href="#section-8.9.2" class="xref">8.9.2</a>.  <a href="#name-bls12-381-g2" class="xref">BLS12-381 G2</a><a href="#section-toc.1-1.8.2.9.2.2.1" class="pilcrow">¶</a></p>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="xref">9</a>.  <a href="#name-iana-considerations" class="xref">IANA Considerations</a><a href="#section-toc.1-1.9.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="xref">10</a>. <a href="#name-security-considerations-2" class="xref">Security Considerations</a><a href="#section-toc.1-1.10.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#section-11" class="xref">11</a>. <a href="#name-acknowledgements" class="xref">Acknowledgements</a><a href="#section-toc.1-1.11.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#section-12" class="xref">12</a>. <a href="#name-contributors" class="xref">Contributors</a><a href="#section-toc.1-1.12.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a href="#section-13" class="xref">13</a>. <a href="#name-references" class="xref">References</a><a href="#section-toc.1-1.13.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.13.2.1">
                <p id="section-toc.1-1.13.2.1.1"><a href="#section-13.1" class="xref">13.1</a>.  <a href="#name-normative-references" class="xref">Normative References</a><a href="#section-toc.1-1.13.2.1.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.13.2.2">
                <p id="section-toc.1-1.13.2.2.1"><a href="#section-13.2" class="xref">13.2</a>.  <a href="#name-informative-references" class="xref">Informative References</a><a href="#section-toc.1-1.13.2.2.1" class="pilcrow">¶</a></p>
</li>
</ul>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.14">
            <p id="section-toc.1-1.14.1"><a href="#section-appendix.a" class="xref">Appendix A</a>.  <a href="#name-related-work" class="xref">Related Work</a><a href="#section-toc.1-1.14.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.15">
            <p id="section-toc.1-1.15.1"><a href="#section-appendix.b" class="xref">Appendix B</a>.  <a href="#name-rational-maps" class="xref">Rational maps</a><a href="#section-toc.1-1.15.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.15.2.1">
                <p id="section-toc.1-1.15.2.1.1"><a href="#section-b.1" class="xref">B.1</a>.  <a href="#name-twisted-edwards-to-weierstr" class="xref">Twisted Edwards to Weierstrass and Montgomery curves</a><a href="#section-toc.1-1.15.2.1.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.15.2.2">
                <p id="section-toc.1-1.15.2.2.1"><a href="#section-b.2" class="xref">B.2</a>.  <a href="#name-montgomery-to-weierstrass-c" class="xref">Montgomery to Weierstrass curves</a><a href="#section-toc.1-1.15.2.2.1" class="pilcrow">¶</a></p>
</li>
</ul>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.16">
            <p id="section-toc.1-1.16.1"><a href="#section-appendix.c" class="xref">Appendix C</a>.  <a href="#name-isogeny-maps-for-suites" class="xref">Isogeny maps for Suites</a><a href="#section-toc.1-1.16.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.16.2.1">
                <p id="section-toc.1-1.16.2.1.1"><a href="#section-c.1" class="xref">C.1</a>.  <a href="#name-3-isogeny-map-for-secp256k1" class="xref">3-isogeny map for secp256k1</a><a href="#section-toc.1-1.16.2.1.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.16.2.2">
                <p id="section-toc.1-1.16.2.2.1"><a href="#section-c.2" class="xref">C.2</a>.  <a href="#name-11-isogeny-map-for-bls12-38" class="xref">11-isogeny map for BLS12-381 G1</a><a href="#section-toc.1-1.16.2.2.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.16.2.3">
                <p id="section-toc.1-1.16.2.3.1"><a href="#section-c.3" class="xref">C.3</a>.  <a href="#name-3-isogeny-map-for-bls12-381" class="xref">3-isogeny map for BLS12-381 G2</a><a href="#section-toc.1-1.16.2.3.1" class="pilcrow">¶</a></p>
</li>
</ul>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.17">
            <p id="section-toc.1-1.17.1"><a href="#section-appendix.d" class="xref">Appendix D</a>.  <a href="#name-sample-code" class="xref">Sample Code</a><a href="#section-toc.1-1.17.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.17.2.1">
                <p id="section-toc.1-1.17.2.1.1"><a href="#section-d.1" class="xref">D.1</a>.  <a href="#name-interface-and-projective-co" class="xref">Interface and projective coordinate systems</a><a href="#section-toc.1-1.17.2.1.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.17.2.2">
                <p id="section-toc.1-1.17.2.2.1"><a href="#section-d.2" class="xref">D.2</a>.  <a href="#name-simplified-swu-for-p-3-mod-" class="xref">Simplified SWU for p = 3 (mod 4)</a><a href="#section-toc.1-1.17.2.2.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.17.2.3">
                <p id="section-toc.1-1.17.2.3.1"><a href="#section-d.3" class="xref">D.3</a>.  <a href="#name-curve25519-elligator-2" class="xref">curve25519 (Elligator 2)</a><a href="#section-toc.1-1.17.2.3.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.17.2.4">
                <p id="section-toc.1-1.17.2.4.1"><a href="#section-d.4" class="xref">D.4</a>.  <a href="#name-edwards25519-elligator-2" class="xref">edwards25519 (Elligator 2)</a><a href="#section-toc.1-1.17.2.4.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.17.2.5">
                <p id="section-toc.1-1.17.2.5.1"><a href="#section-d.5" class="xref">D.5</a>.  <a href="#name-curve448-elligator-2" class="xref">curve448 (Elligator 2)</a><a href="#section-toc.1-1.17.2.5.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.17.2.6">
                <p id="section-toc.1-1.17.2.6.1"><a href="#section-d.6" class="xref">D.6</a>.  <a href="#name-edwards448-elligator-2" class="xref">edwards448 (Elligator 2)</a><a href="#section-toc.1-1.17.2.6.1" class="pilcrow">¶</a></p>
</li>
</ul>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.18">
            <p id="section-toc.1-1.18.1"><a href="#section-appendix.e" class="xref">Appendix E</a>.  <a href="#name-scripts-for-parameter-gener" class="xref">Scripts for parameter generation</a><a href="#section-toc.1-1.18.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.18.2.1">
                <p id="section-toc.1-1.18.2.1.1"><a href="#section-e.1" class="xref">E.1</a>.  <a href="#name-finding-z-for-the-shallue-a" class="xref">Finding Z for the Shallue and van de Woestijne map</a><a href="#section-toc.1-1.18.2.1.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.18.2.2">
                <p id="section-toc.1-1.18.2.2.1"><a href="#section-e.2" class="xref">E.2</a>.  <a href="#name-finding-z-for-simplified-sw" class="xref">Finding Z for Simplified SWU</a><a href="#section-toc.1-1.18.2.2.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.18.2.3">
                <p id="section-toc.1-1.18.2.3.1"><a href="#section-e.3" class="xref">E.3</a>.  <a href="#name-finding-z-for-elligator-2" class="xref">Finding Z for Elligator 2</a><a href="#section-toc.1-1.18.2.3.1" class="pilcrow">¶</a></p>
</li>
</ul>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.19">
            <p id="section-toc.1-1.19.1"><a href="#section-appendix.f" class="xref">Appendix F</a>.  <a href="#name-sqrt-functions" class="xref">sqrt functions</a><a href="#section-toc.1-1.19.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.19.2.1">
                <p id="section-toc.1-1.19.2.1.1"><a href="#section-f.1" class="xref">F.1</a>.  <a href="#name-q-3-mod-4" class="xref">q = 3 (mod 4)</a><a href="#section-toc.1-1.19.2.1.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.19.2.2">
                <p id="section-toc.1-1.19.2.2.1"><a href="#section-f.2" class="xref">F.2</a>.  <a href="#name-q-5-mod-8" class="xref">q = 5 (mod 8)</a><a href="#section-toc.1-1.19.2.2.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.19.2.3">
                <p id="section-toc.1-1.19.2.3.1"><a href="#section-f.3" class="xref">F.3</a>.  <a href="#name-q-9-mod-16" class="xref">q = 9 (mod 16)</a><a href="#section-toc.1-1.19.2.3.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.19.2.4">
                <p id="section-toc.1-1.19.2.4.1"><a href="#section-f.4" class="xref">F.4</a>.  <a href="#name-constant-time-tonelli-shank" class="xref">Constant-time Tonelli-Shanks algorithm</a><a href="#section-toc.1-1.19.2.4.1" class="pilcrow">¶</a></p>
</li>
</ul>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.20">
            <p id="section-toc.1-1.20.1"><a href="#section-appendix.g" class="xref"></a><a href="#name-authors-addresses" class="xref">Authors' Addresses</a><a href="#section-toc.1-1.20.1" class="pilcrow">¶</a></p>
</li>
</ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">Many cryptographic protocols require a procedure that encodes an arbitrary input,
e.g., a password, to a point on an elliptic curve. This procedure is known
as hashing to an elliptic curve. Prominent examples of cryptosystems that
hash to elliptic curves include Simple Password Exponential Key Exchange
<span>[<a href="#J96" class="xref">J96</a>]</span>, Password Authenticated Key Exchange <span>[<a href="#BMP00" class="xref">BMP00</a>]</span>, Identity-Based
Encryption <span>[<a href="#BF01" class="xref">BF01</a>]</span> and Boneh-Lynn-Shacham signatures <span>[<a href="#BLS01" class="xref">BLS01</a>]</span>.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">Unfortunately for implementors, the precise hash function that is suitable for a
given scheme is not necessarily included in the description of the protocol.
Compounding this problem is the need to pick a suitable curve for the specific
protocol.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">This document aims to bridge this gap by providing a thorough set of
recommended algorithms for a range of curve types.
Each algorithm conforms to a common interface: it takes as input an arbitrary-length
bit string and produces as output a point on an elliptic curve.
We provide implementation details for each algorithm, describe
the security rationale behind each recommendation, and give guidance for
elliptic curves that are not explicitly covered.<a href="#section-1-3" class="pilcrow">¶</a></p>
<p id="section-1-4">This document does not cover rejection sampling methods, sometimes known
as "try-and-increment" or "hunt-and-peck," because the goal is to describe
algorithms that can plausibly be made constant time. Use of these rejection
methods is NOT RECOMMENDED, because they have been a perennial cause of
side-channel vulnerabilities.<a href="#section-1-4" class="pilcrow">¶</a></p>
<div id="howto">
<section id="section-1.1">
        <h3 id="name-how-to-use-this-document">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-how-to-use-this-document" class="section-name selfRef">How to use this document</a>
        </h3>
<p id="section-1.1-1">This document is intended for use by both implementors and protocol designers.<a href="#section-1.1-1" class="pilcrow">¶</a></p>
<p id="section-1.1-2">For implementors, the necessary and sufficient level of specification is
a hash-to-curve suite, which fixes all of the parameters listed in <a href="#suites" class="xref">Section 8</a>,
plus a domain separation tag (<a href="#domain-separation" class="xref">Section 3.1</a>).
Starting from working operations on the target elliptic curve and its base field,
a hash-to-curve suite requires implementing the specified encoding function (<a href="#roadmap" class="xref">Section 3</a>),
its constituent subroutines (<a href="#hashtobase" class="xref">Section 5</a>, <a href="#mappings" class="xref">Section 6</a>, <a href="#cofactor-clearing" class="xref">Section 7</a>), and
a few utility functions (<a href="#utility" class="xref">Section 4</a>).<a href="#section-1.1-2" class="pilcrow">¶</a></p>
<p id="section-1.1-3">Correspondingly, designers specifying a protocol that requires hashing to an elliptic curve
should either choose an existing hash-to-curve suite or specify a new one (see <a href="#new-suite" class="xref">Section 8.1</a>).
In addition, designers should choose a domain separation tag following the guidelines in
<a href="#domain-separation" class="xref">Section 3.1</a>.<a href="#section-1.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="requirements">
<section id="section-1.2">
        <h3 id="name-requirements">
<a href="#section-1.2" class="section-number selfRef">1.2. </a><a href="#name-requirements" class="section-name selfRef">Requirements</a>
        </h3>
<p id="section-1.2-1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
"SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
document are to be interpreted as described in <span>[<a href="#RFC2119" class="xref">RFC2119</a>]</span>.<a href="#section-1.2-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="background">
<section id="section-2">
      <h2 id="name-background">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-background" class="section-name selfRef">Background</a>
      </h2>
<div id="bg-curves">
<section id="section-2.1">
        <h3 id="name-elliptic-curves">
<a href="#section-2.1" class="section-number selfRef">2.1. </a><a href="#name-elliptic-curves" class="section-name selfRef">Elliptic curves</a>
        </h3>
<p id="section-2.1-1">The following is a brief definition of elliptic curves, with an emphasis on
important parameters and their relation to hashing to curves.
For further reference on elliptic curves, consult <span>[<a href="#CFADLNV05" class="xref">CFADLNV05</a>]</span> or <span>[<a href="#W08" class="xref">W08</a>]</span>.<a href="#section-2.1-1" class="pilcrow">¶</a></p>
<p id="section-2.1-2">Let F be the finite field GF(q) of prime characteristic p &gt; 3.
(This document does not consider elliptic curves over fields of characteristic 2 or 3.)
In most cases F is a prime field, so q = p.
Otherwise, F is an extension field, so q = p^m for an integer m &gt; 1.
This document writes elements of extension fields
in a primitive element or polynomial basis, i.e., as a vector
of m elements of GF(p) written in ascending order by degree.
The entries of this vector are indexed in ascending order starting from 1,
i.e., x = (x_1, x_2, ..., x_m).
For example, if q = p^2 and the primitive element basis is (1, I),
then x = (a, b) corresponds to the element a + b * I, where
x_1 = a and x_2 = b.<a href="#section-2.1-2" class="pilcrow">¶</a></p>
<p id="section-2.1-3">An elliptic curve E is specified by an equation in two variables and a
finite field F. An elliptic curve equation takes one of several standard forms,
including (but not limited to) Weierstrass, Montgomery, and Edwards.<a href="#section-2.1-3" class="pilcrow">¶</a></p>
<p id="section-2.1-4">The curve E induces an algebraic group whose elements are those points
with coordinates (x, y) satisfying the curve equation, and where x and y
are elements of F.
This group has order n, meaning that there are n distinct points.
This document uses additive notation for the elliptic curve group operation.<a href="#section-2.1-4" class="pilcrow">¶</a></p>
<p id="section-2.1-5">For security reasons, groups of prime order MUST be used. Elliptic curves
induce subgroups of prime order. Let G be a subgroup of the curve of prime
order r, where n = h * r.
In this equation, h is an integer called the cofactor.
An algorithm that takes as input an arbitrary point on the curve E and
produces as output a point in the subgroup G of E is said to "clear
the cofactor."
Such algorithms are discussed in <a href="#cofactor-clearing" class="xref">Section 7</a>.<a href="#section-2.1-5" class="pilcrow">¶</a></p>
<p id="section-2.1-6">Certain hash-to-curve algorithms restrict the form of the curve equation, the
characteristic of the field, and/or the parameters of the curve. For each
algorithm presented, this document lists the relevant restrictions.<a href="#section-2.1-6" class="pilcrow">¶</a></p>
<p id="section-2.1-7">Summary of quantities:<a href="#section-2.1-7" class="pilcrow">¶</a></p>
<table class="center" id="table-1">
          <caption><a href="#table-1" class="selfRef">Table 1</a></caption>
<thead>
            <tr>
              <th class="text-center" rowspan="1" colspan="1">Symbol</th>
              <th class="text-left" rowspan="1" colspan="1">Meaning</th>
              <th class="text-left" rowspan="1" colspan="1">Relevance</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-center" rowspan="1" colspan="1">F,q,p</td>
              <td class="text-left" rowspan="1" colspan="1">Finite field F of characteristic p and #F = q = p^m.</td>
              <td class="text-left" rowspan="1" colspan="1">For prime fields, q = p; otherwise, q = p^m and m&gt;1.</td>
            </tr>
            <tr>
              <td class="text-center" rowspan="1" colspan="1">E</td>
              <td class="text-left" rowspan="1" colspan="1">Elliptic curve.</td>
              <td class="text-left" rowspan="1" colspan="1">E is specified by an equation and a field F.</td>
            </tr>
            <tr>
              <td class="text-center" rowspan="1" colspan="1">n</td>
              <td class="text-left" rowspan="1" colspan="1">Number of points on the elliptic curve E.</td>
              <td class="text-left" rowspan="1" colspan="1">n = h * r, for h and r defined below.</td>
            </tr>
            <tr>
              <td class="text-center" rowspan="1" colspan="1">G</td>
              <td class="text-left" rowspan="1" colspan="1">A subgroup of the elliptic curve.</td>
              <td class="text-left" rowspan="1" colspan="1">Destination group to which bit strings are encoded.</td>
            </tr>
            <tr>
              <td class="text-center" rowspan="1" colspan="1">r</td>
              <td class="text-left" rowspan="1" colspan="1">Order of G.</td>
              <td class="text-left" rowspan="1" colspan="1">This number MUST be prime.</td>
            </tr>
            <tr>
              <td class="text-center" rowspan="1" colspan="1">h</td>
              <td class="text-left" rowspan="1" colspan="1">Cofactor, h &gt;= 1.</td>
              <td class="text-left" rowspan="1" colspan="1">An integer satisfying n = h * r.</td>
            </tr>
          </tbody>
        </table>
</section>
</div>
<div id="terminology">
<section id="section-2.2">
        <h3 id="name-terminology">
<a href="#section-2.2" class="section-number selfRef">2.2. </a><a href="#name-terminology" class="section-name selfRef">Terminology</a>
        </h3>
<p id="section-2.2-1">In this section, we define important terms used in the rest of this document.<a href="#section-2.2-1" class="pilcrow">¶</a></p>
<div id="term-mapping">
<section id="section-2.2.1">
          <h4 id="name-mappings">
<a href="#section-2.2.1" class="section-number selfRef">2.2.1. </a><a href="#name-mappings" class="section-name selfRef">Mappings</a>
          </h4>
<p id="section-2.2.1-1">A mapping is a deterministic function from an element of the field F to a point
on an elliptic curve E defined over F.<a href="#section-2.2.1-1" class="pilcrow">¶</a></p>
<p id="section-2.2.1-2">In general, the set of all points that a mapping can produce over all
possible inputs may be only a subset of the points on an elliptic curve
(i.e., the mapping may not be surjective).
In addition, a mapping may output the same point for two or more distinct inputs
(i.e., the mapping may not be injective).
For example, consider a mapping from F to an elliptic curve having n points:
if the number of elements of F is not equal to n,
then this mapping cannot be bijective (i.e., both injective and surjective)
since it is defined to be deterministic.<a href="#section-2.2.1-2" class="pilcrow">¶</a></p>
<p id="section-2.2.1-3">Mappings may also be invertible, meaning that there is an efficient algorithm
that, for any point P output by the mapping, outputs an x in F such that
applying the mapping to x outputs P.
Some of the mappings given in <a href="#mappings" class="xref">Section 6</a> are invertible, but this
document does not discuss inversion algorithms.<a href="#section-2.2.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="term-encoding">
<section id="section-2.2.2">
          <h4 id="name-encodings">
<a href="#section-2.2.2" class="section-number selfRef">2.2.2. </a><a href="#name-encodings" class="section-name selfRef">Encodings</a>
          </h4>
<p id="section-2.2.2-1">Encodings are closely related to mappings.
Like a mapping, an encoding is a function that outputs a point on an elliptic curve.
In contrast to a mapping, however, the input to an encoding is an arbitrary bit string.
Encodings can be deterministic or probabilistic.
Deterministic encodings are preferred for security, because probabilistic
ones can leak information through side channels.<a href="#section-2.2.2-1" class="pilcrow">¶</a></p>
<p id="section-2.2.2-2">This document constructs deterministic encodings by composing a hash function H
with a deterministic mapping.
In particular, H takes as input an arbitrary bit string and outputs an element of F.
The deterministic mapping takes that element as input and outputs a point on an
elliptic curve E defined over F.
Since the hash function H takes arbitrary bit strings as inputs, it cannot be
injective: the set of inputs is larger than the set of outputs, so there must
be distinct inputs that give the same output (i.e., there must be collisions).
Thus, any encoding built from H is also not injective.<a href="#section-2.2.2-2" class="pilcrow">¶</a></p>
<p id="section-2.2.2-3">Like mappings, encodings may be invertible, meaning that there is an efficient
algorithm that, for any point P output by the encoding, outputs a bit string s
such that applying the encoding to s outputs P.
The hash function used by all encodings specified in this document (<a href="#hashtobase" class="xref">Section 5</a>)
is not invertible; thus, the encodings are also not invertible.<a href="#section-2.2.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="term-rom">
<section id="section-2.2.3">
          <h4 id="name-random-oracle-encodings">
<a href="#section-2.2.3" class="section-number selfRef">2.2.3. </a><a href="#name-random-oracle-encodings" class="section-name selfRef">Random oracle encodings</a>
          </h4>
<p id="section-2.2.3-1">Two different types of encodings are possible: nonuniform encodings,
whose output distribution is not uniformly random, and random oracle encodings,
whose output distribution is indistinguishable from uniformly random.
Some protocols require a random oracle for security, while others can
be securely instantiated with a nonuniform encoding.
When the required encoding is not clear, applications SHOULD use a random oracle.<a href="#section-2.2.3-1" class="pilcrow">¶</a></p>
<p id="section-2.2.3-2">Care is required when constructing a random oracle from a mapping function.
A simple but insecure approach is to use the output of a cryptographically
secure hash function H as the input to the mapping.
Because in general the mapping is not surjective, the output of this
construction is distinguishable from uniformly random, i.e., it does
not behave like a random oracle.<a href="#section-2.2.3-2" class="pilcrow">¶</a></p>
<p id="section-2.2.3-3">Brier et al. <span>[<a href="#BCIMRT10" class="xref">BCIMRT10</a>]</span> describe two generic methods for constructing
random oracle encodings.
Farashahi et al. <span>[<a href="#FFSTV13" class="xref">FFSTV13</a>]</span> and Tibouchi and Kim <span>[<a href="#TK17" class="xref">TK17</a>]</span> refine the analysis
of one of these constructions.
That construction is described in <a href="#roadmap" class="xref">Section 3</a>.<a href="#section-2.2.3-3" class="pilcrow">¶</a></p>
<p id="section-2.2.3-4">(In more detail: both constructions are
indifferentiable from a random oracle <span>[<a href="#MRH04" class="xref">MRH04</a>]</span> when instantiated
with appropriate hash functions modeled as random oracles.
See <a href="#security-considerations" class="xref">Section 10</a> for further discussion.)<a href="#section-2.2.3-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="term-serialization">
<section id="section-2.2.4">
          <h4 id="name-serialization">
<a href="#section-2.2.4" class="section-number selfRef">2.2.4. </a><a href="#name-serialization" class="section-name selfRef">Serialization</a>
          </h4>
<p id="section-2.2.4-1">A procedure related to encoding is the conversion of an elliptic curve point to a bit string.
This is called serialization, and is typically used for compactly storing or transmitting points.
The reverse operation, deserialization, converts a bit string to an elliptic curve point.
For example, <span>[<a href="#SEC1" class="xref">SEC1</a>]</span> and <span>[<a href="#p1363a" class="xref">p1363a</a>]</span> give standard methods for serialization and deserialization.<a href="#section-2.2.4-1" class="pilcrow">¶</a></p>
<p id="section-2.2.4-2">Deserialization is different from encoding in that only certain strings
(namely, those output by the serialization procedure) can be deserialized.
In contrast, this document is concerned with encodings from arbitrary bit strings
to elliptic curve points.
This document does not cover serialization or deserialization.<a href="#section-2.2.4-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="term-domain-separation">
<section id="section-2.2.5">
          <h4 id="name-domain-separation">
<a href="#section-2.2.5" class="section-number selfRef">2.2.5. </a><a href="#name-domain-separation" class="section-name selfRef">Domain separation</a>
          </h4>
<p id="section-2.2.5-1">Cryptographic protocols that use random oracles are often analyzed
under the assumption that random oracles answer only queries generated
by that protocol.
In practice, this assumption does not hold if two protocols query the
same random oracle.
Concretely, consider protocols P1 and P2 that query random oracle RO:
if P1 and P2 both query RO on the same value x, the security analysis of
one or both protocols may be invalidated.<a href="#section-2.2.5-1" class="pilcrow">¶</a></p>
<p id="section-2.2.5-2">A common approach to addressing this issue is called domain separation,
which allows a single random oracle to simulate multiple, independent oracles.
This is effected by ensuring that each simulated oracle sees queries that are
distinct from those seen by all other simulated oracles.
For example, to simulate two oracles RO1 and RO2 given a single oracle RO,
one might define<a href="#section-2.2.5-2" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-2.2.5-3">
<pre>
RO1(x) := RO("RO1" || x)
RO2(x) := RO("RO2" || x)
</pre><a href="#section-2.2.5-3" class="pilcrow">¶</a>
</div>
<p id="section-2.2.5-4">In this example, "RO1" and "RO2" are called domain separation tags;
they ensure that queries to RO1 and RO2 cannot result in identical
queries to RO.
Thus, it is safe to treat RO1 and RO2 as independent oracles.<a href="#section-2.2.5-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="roadmap">
<section id="section-3">
      <h2 id="name-roadmap">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-roadmap" class="section-name selfRef">Roadmap</a>
      </h2>
<p id="section-3-1">This section presents a general framework for encoding bit strings to points
on an elliptic curve. To construct these encodings, we rely on three basic
functions:<a href="#section-3-1" class="pilcrow">¶</a></p>
<ul>
<li id="section-3-2.1">The function hash_to_base, {0, 1}^* x {0, 1, 2} -&gt; F, hashes arbitrary-length bit strings
to elements of a finite field; its implementation is defined in
<a href="#hashtobase" class="xref">Section 5</a>.<a href="#section-3-2.1" class="pilcrow">¶</a>
</li>
<li id="section-3-2.2">The function map_to_curve, F -&gt; E, calculates a point on the elliptic curve E
from an element of the finite field F over which E is defined.
<a href="#mappings" class="xref">Section 6</a> describes mappings for a range of curve families.<a href="#section-3-2.2" class="pilcrow">¶</a>
</li>
<li id="section-3-2.3">The function clear_cofactor, E -&gt; G, sends any point on the curve E to
the subgroup G of E. <a href="#cofactor-clearing" class="xref">Section 7</a> describes methods to perform
this operation.<a href="#section-3-2.3" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-3-3">We describe two high-level encoding functions (<a href="#term-encoding" class="xref">Section 2.2.2</a>).
Although these functions have the same interface, the
distributions of their outputs are different.<a href="#section-3-3" class="pilcrow">¶</a></p>
<ul>
<li id="section-3-4.1">Nonuniform encoding (encode_to_curve). This function encodes bit strings to points in G.
The distribution of the output is not uniformly random in G.<a href="#section-3-4.1" class="pilcrow">¶</a>
</li>
</ul>
<div class="artwork art-text alignLeft" id="section-3-5">
<pre>
encode_to_curve(alpha)

Input: alpha, an arbitrary-length bit string.
Output: P, a point in G.

Steps:
1. u = hash_to_base(alpha, 2)
2. Q = map_to_curve(u)
3. P = clear_cofactor(Q)
4. return P
</pre><a href="#section-3-5" class="pilcrow">¶</a>
</div>
<ul>
<li id="section-3-6.1">Random oracle encoding (hash_to_curve). This function encodes bit strings to points in G.
This function is suitable for applications requiring a random oracle returning points in G,
provided that map_to_curve is "well distributed" (<span>[<a href="#FFSTV13" class="xref">FFSTV13</a>]</span>, Def. 1).
All of the map_to_curve functions defined in <a href="#mappings" class="xref">Section 6</a> meet this requirement.<a href="#section-3-6.1" class="pilcrow">¶</a>
</li>
</ul>
<div class="artwork art-text alignLeft" id="section-3-7">
<pre>
hash_to_curve(alpha)

Input: alpha, an arbitrary-length bit string.
Output: P, a point in G.

Steps:
1. u0 = hash_to_base(alpha, 0)
2. u1 = hash_to_base(alpha, 1)
3. Q0 = map_to_curve(u0)
4. Q1 = map_to_curve(u1)
5. R = Q0 + Q1              # Point addition
6. P = clear_cofactor(R)
7. return P
</pre><a href="#section-3-7" class="pilcrow">¶</a>
</div>
<p id="section-3-8">Instances of these functions are given in <a href="#suites" class="xref">Section 8</a>, which defines a list of
suites that specify a full set of parameters matching elliptic curves and
algorithms.<a href="#section-3-8" class="pilcrow">¶</a></p>
<div id="domain-separation">
<section id="section-3.1">
        <h3 id="name-domain-separation-requireme">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-domain-separation-requireme" class="section-name selfRef">Domain separation requirements</a>
        </h3>
<p id="section-3.1-1">All uses of the encoding functions defined in this document MUST include
domain separation (<a href="#term-domain-separation" class="xref">Section 2.2.5</a>) to avoid interfering with
other uses of similar functionality.<a href="#section-3.1-1" class="pilcrow">¶</a></p>
<p id="section-3.1-2">Protocols that instantiate multiple, independent hash functions based on
either hash_to_curve or encode_to_curve MUST enforce domain separation
between those hash functions.
This requirement applies both in the case of multiple hashes to the same
curve and in the case of multiple hashes to different curves.
(This is because the hash_to_base primitive (<a href="#hashtobase" class="xref">Section 5</a>) requires
domain separation to guarantee independent outputs.)<a href="#section-3.1-2" class="pilcrow">¶</a></p>
<p id="section-3.1-3">Domain separation is enforced with a domain separation tag (DST),
which is an octet string.
Care is required when selecting and using a domain separation tag.
The following requirements apply:<a href="#section-3.1-3" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal" id="section-3.1-4">
          <li id="section-3.1-4.1">Tags MUST be supplied as the DST parameter to hash_to_base, as
described in <a href="#hashtobase" class="xref">Section 5</a>.<a href="#section-3.1-4.1" class="pilcrow">¶</a>
</li>
<li id="section-3.1-4.2">Tags MUST begin with a fixed protocol identification string.
This identification string should be unique to the protocol.<a href="#section-3.1-4.2" class="pilcrow">¶</a>
</li>
<li id="section-3.1-4.3">Tags SHOULD include a protocol version number.<a href="#section-3.1-4.3" class="pilcrow">¶</a>
</li>
<li id="section-3.1-4.4">For protocols that define multiple ciphersuites, each ciphersuite's
tag MUST be different. For this purpose, it is RECOMMENDED to
include a ciphersuite identifier in each tag.<a href="#section-3.1-4.4" class="pilcrow">¶</a>
</li>
<li id="section-3.1-4.5">For protocols that use multiple encodings, either to the same curve
or to different curves, each encoding MUST use a different tag.
For this purpose, it is RECOMMENDED to include the encoding's
Suite ID (<a href="#suites" class="xref">Section 8</a>) in the domain separation tag.
For independent encodings based on the same suite, each tag should
also include a distinct identifier, e.g., "ENC1" and "ENC2".<a href="#section-3.1-4.5" class="pilcrow">¶</a>
</li>
</ol>
<p id="section-3.1-5">As an example, consider a fictional protocol named Quux
that defines several different ciphersuites.
A reasonable choice of tag is "QUUX-V&lt;xx&gt;-CS&lt;yy&gt;", where &lt;xx&gt; and &lt;yy&gt;
are two-digit numbers indicating the version and ciphersuite, respectively.<a href="#section-3.1-5" class="pilcrow">¶</a></p>
<p id="section-3.1-6">As another example, consider a fictional protocol named Baz that requires
two independent random oracles, where one oracle outputs points on the curve
E1 and the other outputs points on the curve E2.
Reasonable choices of tags for the E1 and E2 oracles are
"BAZ-V&lt;xx&gt;-CS&lt;yy&gt;-E1" and "BAZ-V&lt;xx&gt;-CS&lt;yy&gt;-E2", respectively,
where &lt;xx&gt; and &lt;yy&gt; are as described above.<a href="#section-3.1-6" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="utility">
<section id="section-4">
      <h2 id="name-utility-functions">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-utility-functions" class="section-name selfRef">Utility Functions</a>
      </h2>
<p id="section-4-1">Algorithms in this document make use of utility functions described below.<a href="#section-4-1" class="pilcrow">¶</a></p>
<p id="section-4-2">For security reasons, all field operations, comparisons, and assignments
MUST be implemented in constant time (i.e., execution time MUST NOT depend
on the values of the inputs), and without branching.
Guidance on implementing these low-level operations in constant time is
beyond the scope of this document.<a href="#section-4-2" class="pilcrow">¶</a></p>
<ul>
<li id="section-4-3.1">CMOV(a, b, c): If c is False, CMOV returns a, otherwise it returns b.
To prevent against timing attacks, this operation must run in constant
time, without revealing the value of c.
Commonly, implementations assume that the selector c is 1 for True or
0 for False. In this case, given a bit string C, the desired selector c can
be computed by OR-ing all bits of C together. The resulting selector will be
either 0 if all bits of C are zero, or 1 if at least one bit of C is 1.<a href="#section-4-3.1" class="pilcrow">¶</a>
</li>
<li id="section-4-3.2">is_square(x): This function returns True whenever the value x is a
square in the field F. Due to Euler's criterion, this function can be
calculated in constant time as<a href="#section-4-3.2" class="pilcrow">¶</a>
</li>
</ul>
<div class="artwork art-text alignLeft" id="section-4-4">
<pre>
is_square(x) := { True,  if x^((q - 1) / 2) is 0 or 1 in F;
                { False, otherwise.
</pre><a href="#section-4-4" class="pilcrow">¶</a>
</div>
<ul>
<li id="section-4-5.1">
          <p id="section-4-5.1.1">sqrt(x): The sqrt operation is a multi-valued function, i.e. there exist
two roots of x in the field F whenever x is square.
To maintain compatibility across implementations while allowing implementors
leeway for optimizations, this document does not require sqrt() to return a
particular value. Instead, as explained in <a href="#point-sign" class="xref">Section 6.4</a>, any higher-level
function that computes square roots also specifies how to determine the sign
of the result.<a href="#section-4-5.1.1" class="pilcrow">¶</a></p>
<p id="section-4-5.1.2">
The preferred way of computing square roots is to fix a deterministic
algorithm particular to F. We give several algorithms in <a href="#appx-sqrt" class="xref">Appendix F</a>.
Regardless of the method chosen, the sqrt function should be implemented
in a way that resists timing side channels, i.e., in constant time.<a href="#section-4-5.1.2" class="pilcrow">¶</a></p>
</li>
<li id="section-4-5.2">sgn0(x): This function returns either +1 or -1 indicating the "sign" of x,
where sgn0(x) == -1 just when x is "negative".
In other words, this function always considers 0 to be positive.
This function may be implemented in multiple ways; <a href="#sgn0-variants" class="xref">Section 4.1</a> defines two variants.
Throughout the document, sgn0 is used generically to mean either of these variants.
Each suite in <a href="#suites" class="xref">Section 8</a> specifies the sgn0 variant to be used.<a href="#section-4-5.2" class="pilcrow">¶</a>
</li>
<li id="section-4-5.3">inv0(x): This function returns the multiplicative inverse of x in F,
extended to all of F by fixing inv0(0) == 0.
To implement inv0 in constant time, compute inv0(x) := x^(q - 2).
Notice on input 0, the output is 0 as required.<a href="#section-4-5.3" class="pilcrow">¶</a>
</li>
<li id="section-4-5.4">I2OSP and OS2IP: These functions are used to convert an octet string to
and from a non-negative integer as described in <span>[<a href="#RFC8017" class="xref">RFC8017</a>]</span>.<a href="#section-4-5.4" class="pilcrow">¶</a>
</li>
<li id="section-4-5.5">a || b: denotes the concatenation of bit strings a and b.<a href="#section-4-5.5" class="pilcrow">¶</a>
</li>
</ul>
<div id="sgn0-variants">
<section id="section-4.1">
        <h3 id="name-sgn0-variants">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-sgn0-variants" class="section-name selfRef">sgn0 variants</a>
        </h3>
<p id="section-4.1-1">This section defines two ways of determining the "sign" of an element of F.
The variant that should be used is a matter of convention.
Other sgn0 variants are possible, but the two given below cover
commonly used notions of sign.<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<p id="section-4.1-2">It is RECOMMENDED to select the variant that matches the point decompression
method of the target curve.
In particular, since point decompression requires computing a square root
and then choosing the sign of the resulting point, all decompression methods
specify, implicitly or explicitly, a method for determining the sign of an
element of F.
It is convenient for hash-to-curve and decompression to agree on a notion of
sign, since this may permit simpler implementations.<a href="#section-4.1-2" class="pilcrow">¶</a></p>
<p id="section-4.1-3">See <a href="#bg-curves" class="xref">Section 2.1</a> for a discussion of representing elements of extension fields
as vectors; this representation is used in both of the sgn0 variants below.<a href="#section-4.1-3" class="pilcrow">¶</a></p>
<p id="section-4.1-4">Note that any valid sgn0 function for extension fields must iterate over
the entire vector representation of the input element.
To see why, imagine a function sgn0* that ignores the final entry in its
input vector, and consider a field element x = (0, x_2).
Since sgn0* ignores x_2, sgn0*(x) == sgn0*(-x), which is incorrect
when x_2 != 0.
The same argument applies to all entries of any x, establishing the claim.<a href="#section-4.1-4" class="pilcrow">¶</a></p>
<div id="sgn0-be">
<section id="section-4.1.1">
          <h4 id="name-big-endian-variant">
<a href="#section-4.1.1" class="section-number selfRef">4.1.1. </a><a href="#name-big-endian-variant" class="section-name selfRef">Big endian variant</a>
          </h4>
<p id="section-4.1.1-1">The following sgn0 variant is defined such that sgn0_be(x) = -1
just when the big-endian encoding of x is lexically greater than
the encoding of -x.<a href="#section-4.1.1-1" class="pilcrow">¶</a></p>
<p id="section-4.1.1-2">This variant SHOULD be used when points on the target elliptic curve
are serialized using the SORT compression method given in
IEEE 1363a-2004 <span>[<a href="#p1363a" class="xref">p1363a</a>]</span>, Section 5.5.6.1.2, and other similar methods.<a href="#section-4.1.1-2" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.1.1-3">
<pre>
sgn0_be(x)

Parameters:
- F, a finite field of characteristic p and order q = p^m.
- p, the characteristic of F (see immediately above).
- m, the extension degree of F, m &gt;= 1 (see immediately above).

Input: x, an element of F.
Output: -1 or 1 (an integer).

Notation: x_i is the i^th element of the vector representation of x.

Steps:
1. sign = 0
2. for i in (m, m - 1, ..., 1):
3.   sign_i = CMOV(1, -1, x_i &gt; ((p - 1) / 2))
4.   sign_i = CMOV(sign_i, 0, x_i == 0)
5.   sign = CMOV(sign, sign_i, sign == 0)
6. return CMOV(sign, 1, sign == 0)      # Regard x == 0 as positive
</pre><a href="#section-4.1.1-3" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="sgn0-le">
<section id="section-4.1.2">
          <h4 id="name-little-endian-variant">
<a href="#section-4.1.2" class="section-number selfRef">4.1.2. </a><a href="#name-little-endian-variant" class="section-name selfRef">Little endian variant</a>
          </h4>
<p id="section-4.1.2-1">The following sgn0 variant is defined such that sgn0_le(x) = -1
just when x != 0 and the parity of the least significant nonzero
entry of the vector representation of x is 1.<a href="#section-4.1.2-1" class="pilcrow">¶</a></p>
<p id="section-4.1.2-2">This variant SHOULD be used when points on the target elliptic curve are serialized
using any of the following methods:<a href="#section-4.1.2-2" class="pilcrow">¶</a></p>
<ul>
<li id="section-4.1.2-3.1">the LSB compression method given in IEEE 1363a-2004 <span>[<a href="#p1363a" class="xref">p1363a</a>]</span>, Section 5.5.6.1.1,<a href="#section-4.1.2-3.1" class="pilcrow">¶</a>
</li>
<li id="section-4.1.2-3.2">the method given in <span>[<a href="#SEC1" class="xref">SEC1</a>]</span> Section 2.3.3, or<a href="#section-4.1.2-3.2" class="pilcrow">¶</a>
</li>
<li id="section-4.1.2-3.3">the method given in ANSI X9.62-1998 <span>[<a href="#x9.62" class="xref">x9.62</a>]</span>, Section 4.2.1.<a href="#section-4.1.2-3.3" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-4.1.2-4">This variant is also compatible with the compression method specified for the
Ed25519 and Ed448 elliptic curves <span>[<a href="#RFC8032" class="xref">RFC8032</a>]</span>.<a href="#section-4.1.2-4" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.1.2-5">
<pre>
sgn0_le(x)

Parameters:
- F, a finite field of characteristic p and order q = p^m.
- p, the characteristic of F (see immediately above).
- m, the extension degree of F, m &gt;= 1 (see immediately above).

Input: x, an element of F.
Output: -1 or 1 (an integer).

Notation: x_i is the i^th element of the vector representation of x.

Steps:
1. sign = 0
2. for i in (1, 2, ..., m):
3.   sign_i = CMOV(1, -1, x_i mod 2 == 1)
4.   sign_i = CMOV(sign_i, 0, x_i == 0)
5.   sign = CMOV(sign, sign_i, sign == 0)
6. return CMOV(sign, 1, sign == 0)      # Regard x == 0 as positive
</pre><a href="#section-4.1.2-5" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="hashtobase">
<section id="section-5">
      <h2 id="name-hashing-to-a-finite-field">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-hashing-to-a-finite-field" class="section-name selfRef">Hashing to a Finite Field</a>
      </h2>
<p id="section-5-1">The hash_to_base function hashes a string msg of any length into an element of a
field F. This function is parametrized by the field F (<a href="#bg-curves" class="xref">Section 2.1</a>) and by H,
a cryptographic hash function that outputs b bits.<a href="#section-5-1" class="pilcrow">¶</a></p>
<p id="section-5-2">Implementors MUST NOT use rejection sampling to generate a uniformly
random element of F.
The reason is that these procedures are difficult to implement in constant time,
and later well-meaning "optimizations" may silently render an implementation
non-constant-time.<a href="#section-5-2" class="pilcrow">¶</a></p>
<div id="hashtobase-sec">
<section id="section-5.1">
        <h3 id="name-security-considerations">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-security-considerations" class="section-name selfRef">Security considerations</a>
        </h3>
<p id="section-5.1-1">For security, hash_to_base should be collision resistant and its output distribution
should be uniform over F. To this end, hash_to_base requires
a cryptographic hash function H which satisfies the following properties:<a href="#section-5.1-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal" id="section-5.1-2">
          <li id="section-5.1-2.1">The number of bits output by H should be b &gt;= 2 * k for sufficient collision
resistance, where k is the target security level in bits. (This is needed for a
birthday bound of approximately 2^(-k).)<a href="#section-5.1-2.1" class="pilcrow">¶</a>
</li>
<li id="section-5.1-2.2">H is modeled as a random oracle, so care should be taken when instantiating it.
Hash functions in the SHA-2 <span>[<a href="#FIPS180-4" class="xref">FIPS180-4</a>]</span> and SHA-3 <span>[<a href="#FIPS202" class="xref">FIPS202</a>]</span> families are
typical and RECOMMENDED choices.<a href="#section-5.1-2.2" class="pilcrow">¶</a>
</li>
</ol>
<p id="section-5.1-3">For example, for 128-bit security, b &gt;= 256 bits; in this case, SHA256 would
be an appropriate choice for H.<a href="#section-5.1-3" class="pilcrow">¶</a></p>
<p id="section-5.1-4">Ensuring that the hash_to_base output is a uniform random element of F requires
care, even when H is modeled as a random oracle. For example,
if H is SHA256 and F is a field of characteristic p = 2^255 - 19, then the
result of reducing H(msg) (a 256-bit integer) modulo p is slightly more likely
to be in [0, 37] than if the value were selected uniformly at random.
In this example the bias is negligible, but in general it can be significant.<a href="#section-5.1-4" class="pilcrow">¶</a></p>
<p id="section-5.1-5">To control bias, the input msg should be hashed to an integer comprising at
least ceil(log2(p)) + k bits; reducing this integer modulo p gives bias at
most 2^-k, which is a safe choice for a cryptosystem with k-bit security.
To obtain such an integer, HKDF <span>[<a href="#RFC5869" class="xref">RFC5869</a>]</span> is used to expand the input
msg to a L-byte string, where L = ceil((ceil(log2(p)) + k) / 8); this
string is then interpreted as an integer via OS2IP <span>[<a href="#RFC8017" class="xref">RFC8017</a>]</span>. For example,
for p a 255-bit prime and k = 128-bit security, L = ceil((255 + 128) / 8) = 48 bytes.<a href="#section-5.1-5" class="pilcrow">¶</a></p>
<p id="section-5.1-6">Finally, hash_to_base appends one zero byte to msg in the invocation of HKDF-Extract.
This ensures that the use of HKDF in hash_to_base is indifferentiable
from a random oracle (see <span>[<a href="#LBB19" class="xref">LBB19</a>]</span>, Lemma 8 and <span>[<a href="#DRST12" class="xref">DRST12</a>]</span>, Theorems 4.3 and 4.4).
(In particular, this approach works because it ensures that the final byte of
each HMAC invocation in HKDF-Extract and HKDF-Expand is distinct.)<a href="#section-5.1-6" class="pilcrow">¶</a></p>
<p id="section-5.1-7"><a href="#domain-separation" class="xref">Section 3.1</a> discusses requirements for domain separation and
recommendations for choosing domain separation tags. The hash_to_curve
function takes such a tag as a parameter, DST; this is the REQUIRED
method for applying domain separation.<a href="#section-5.1-7" class="pilcrow">¶</a></p>
<p id="section-5.1-8"><a href="#hashtobase-impl" class="xref">Section 5.3</a> details the hash_to_base procedure.<a href="#section-5.1-8" class="pilcrow">¶</a></p>
</section>
</div>
<div id="hashtobase-perf">
<section id="section-5.2">
        <h3 id="name-performance-considerations">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-performance-considerations" class="section-name selfRef">Performance considerations</a>
        </h3>
<p id="section-5.2-1">The hash_to_base function uses HKDF-Extract to combine the
input msg and domain separation tag DST into a short digest, which is then
passed to HKDF-Expand <span>[<a href="#RFC5869" class="xref">RFC5869</a>]</span>.
For short messages, this entails at most two extra invocations of H, which
is a negligible overhead in the context of hashing to elliptic curves.<a href="#section-5.2-1" class="pilcrow">¶</a></p>
<p id="section-5.2-2">A related issue is that the random oracle construction described in <a href="#roadmap" class="xref">Section 3</a>
requires evaluating two independent hash functions H0 and H1 on msg.
One way to instantiate independent hashes is to append a counter to
the value being hashed, e.g., H(msg || 0) and H(msg || 1).
If msg is long, however, this is either inefficient (because it entails hashing
msg twice) or requires non-black-box use of H (e.g., partial evaluation).<a href="#section-5.2-2" class="pilcrow">¶</a></p>
<p id="section-5.2-3">To sidestep both of these issues, hash_to_base takes a second argument, ctr,
which it passes to HKDF-Expand.
This means that two invocations of hash_to_base on the same msg with different
ctr values both start with identical invocations of HKDF-Extract.
This is an improvement because it allows sharing one evaluation of HKDF-Extract
among multiple invocations of hash_to_base, i.e., by factoring out the common
computation.<a href="#section-5.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="hashtobase-impl">
<section id="section-5.3">
        <h3 id="name-implementation">
<a href="#section-5.3" class="section-number selfRef">5.3. </a><a href="#name-implementation" class="section-name selfRef">Implementation</a>
        </h3>
<p id="section-5.3-1">The following procedure implements hash_to_base.<a href="#section-5.3-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-5.3-2">
<pre>
hash_to_base(msg, ctr)

Parameters:
- DST, a domain separation tag (see discussion above).
- H, a cryptographic hash function.
- F, a finite field of characteristic p and order q = p^m.
- p, the characteristic of F (see immediately above).
- m, the extension degree of F, m &gt;= 1 (see immediately above).
- L = ceil((ceil(log2(p)) + k) / 8), where k is the security
  parameter of the cryptosystem (e.g., k = 128).
- HKDF-Extract and HKDF-Expand are as defined in RFC5869,
  instantiated with the hash function H.

Inputs:
- msg is the message to hash.
- ctr is 0, 1, or 2.
  This is used to efficiently create independent
  instances of hash_to_base (see discussion above).

Output:
- u, an element in F.

Steps:
1. msg_prime = HKDF-Extract(DST, msg || I2OSP(0, 1))
2. info_pfx = "H2C" || I2OSP(ctr, 1)   # "H2C" is a 3-byte ASCII string
3. for i in (1, ..., m):
4.   info = info_pfx || I2OSP(i, 1)
5.   tv = HKDF-Expand(msg_prime, info, L)
6.   e_i = OS2IP(tv) mod p
7. u = (e_1, ..., e_m)
8. return u
</pre><a href="#section-5.3-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="hashtobase-alt">
<section id="section-5.4">
        <h3 id="name-alternative-hash_to_base-fu">
<a href="#section-5.4" class="section-number selfRef">5.4. </a><a href="#name-alternative-hash_to_base-fu" class="section-name selfRef">Alternative hash_to_base functions</a>
        </h3>
<p id="section-5.4-1">The hash_to_base function is suitable for use with a wide range of hash functions,
including SHA-2 <span>[<a href="#FIPS180-4" class="xref">FIPS180-4</a>]</span>, SHA-3 <span>[<a href="#FIPS202" class="xref">FIPS202</a>]</span>, BLAKE2 <span>[<a href="#RFC7693" class="xref">RFC7693</a>]</span>, and others.
In some cases, however, implementors may wish to replace the HKDF-based function
defined in this section with one built on a different pseudorandom function.
This section briefly describes the REQUIRED way of doing so.<a href="#section-5.4-1" class="pilcrow">¶</a></p>
<p id="section-5.4-2">The security considerations of <a href="#hashtobase-sec" class="xref">Section 5.1</a> continue to apply.
In particular, an alternative hash_to_base function:<a href="#section-5.4-2" class="pilcrow">¶</a></p>
<ul>
<li id="section-5.4-3.1">MUST give collision resistance commensurate with the security level of the target elliptic curve.<a href="#section-5.4-3.1" class="pilcrow">¶</a>
</li>
<li id="section-5.4-3.2">MUST be built on a pseudorandom function that is designed for use in
applications requiring cryptographic randomness.<a href="#section-5.4-3.2" class="pilcrow">¶</a>
</li>
<li id="section-5.4-3.3">MUST NOT use rejection sampling.<a href="#section-5.4-3.3" class="pilcrow">¶</a>
</li>
<li id="section-5.4-3.4">MUST output an element of F whose statistical distance from uniform is commensurate
with the security level of the target elliptic curve.
It is RECOMMENDED to follow the guidelines for controlling bias in <a href="#hashtobase-sec" class="xref">Section 5.1</a>.<a href="#section-5.4-3.4" class="pilcrow">¶</a>
</li>
<li id="section-5.4-3.5">MUST give independent output values for distinct (msg, ctr) inputs.<a href="#section-5.4-3.5" class="pilcrow">¶</a>
</li>
<li id="section-5.4-3.6">MUST support domain separation via a supplied domain separation tag (DST).
Care is required when implementing domain separation: this document
assumes that instantiating hash_to_base with distinct DSTs yields
independent hash functions.<a href="#section-5.4-3.6" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-5.4-4">The efficiency considerations of <a href="#hashtobase-perf" class="xref">Section 5.2</a> should also be followed.
In particular, it SHOULD be possible to hash one msg with multiple ctr values
without requiring multiple passes over msg.<a href="#section-5.4-4" class="pilcrow">¶</a></p>
<p id="section-5.4-5">Finally, the Suite ID value MUST be modified to indicate that an alternative
hash_to_base function is being used.
<a href="#suiteIDformat" class="xref">Section 8.2</a> gives details.<a href="#section-5.4-5" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="mappings">
<section id="section-6">
      <h2 id="name-deterministic-mappings">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-deterministic-mappings" class="section-name selfRef">Deterministic Mappings</a>
      </h2>
<p id="section-6-1">The mappings in this section are suitable for constructing either nonuniform
 or random oracle encodings using the constructions of <a href="#roadmap" class="xref">Section 3</a>.
 Certain mappings restrict the form of the curve or its parameters.
 For each mapping presented, this document lists the relevant restrictions.<a href="#section-6-1" class="pilcrow">¶</a></p>
<p id="section-6-2">Note that mappings in this section are not interchangeable: different mappings
will almost certainly output different points when evaluated on the same input.<a href="#section-6-2" class="pilcrow">¶</a></p>
<div id="choosing-mapping">
<section id="section-6.1">
        <h3 id="name-choosing-a-mapping-function">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-choosing-a-mapping-function" class="section-name selfRef">Choosing a mapping function</a>
        </h3>
<p id="section-6.1-1">This section gives brief guidelines on choosing a mapping function
for a given elliptic curve.
Note that the suites given in <a href="#suites" class="xref">Section 8</a> are recommended mappings
for the respective curves.<a href="#section-6.1-1" class="pilcrow">¶</a></p>
<p id="section-6.1-2">If the target elliptic curve is a Montgomery curve (<a href="#montgomery" class="xref">Section 6.7</a>),
the Elligator 2 method (<a href="#elligator2" class="xref">Section 6.7.1</a>) is recommended.
Similarly, if the target elliptic curve is a twisted Edwards curve (<a href="#twisted-edwards" class="xref">Section 6.8</a>),
the twisted Edwards Elligator 2 method (<a href="#ell2edwards" class="xref">Section 6.8.2</a>) is recommended.<a href="#section-6.1-2" class="pilcrow">¶</a></p>
<p id="section-6.1-3">The remaining cases are Weierstrass curves.
For curves supported by the Simplified SWU method (<a href="#simple-swu" class="xref">Section 6.6.2</a>),
that mapping is the recommended one.
Otherwise, the Simplified SWU method for AB == 0 (<a href="#simple-swu-AB0" class="xref">Section 6.6.3</a>)
is recommended if the goal is best performance, while
the Shallue-van de Woestijne method (<a href="#svdw" class="xref">Section 6.6.1</a>) is recommended
if the goal is simplicity of implementation.
(The reason for this distinction is that the Simplified SWU method for AB == 0
requires implementing an isogeny map in addition to the mapping function, while
the Shallue-van de Woestijne method does not.)<a href="#section-6.1-3" class="pilcrow">¶</a></p>
<p id="section-6.1-4">The Shallue-van de Woestijne method (<a href="#svdw" class="xref">Section 6.6.1</a>) works with any curve,
and may be used in cases where a generic mapping is required.
Note, however, that this mapping is almost always more computationally
expensive than the curve-specific recommendations above.<a href="#section-6.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="interface">
<section id="section-6.2">
        <h3 id="name-interface">
<a href="#section-6.2" class="section-number selfRef">6.2. </a><a href="#name-interface" class="section-name selfRef">Interface</a>
        </h3>
<p id="section-6.2-1">The generic interface shared by all mappings in this section is as follows:<a href="#section-6.2-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-6.2-2">
<pre>
    (x, y) = map_to_curve(u)
</pre><a href="#section-6.2-2" class="pilcrow">¶</a>
</div>
<p id="section-6.2-3">The input u and outputs x and y are elements of the field F.
The coordinates (x, y) specify a point on an elliptic curve defined over F.
Note that the point (x, y) is not a uniformly random point. If uniformity
is required for security, the random oracle construction of <a href="#roadmap" class="xref">Section 3</a> MUST be
used instead.<a href="#section-6.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="notation">
<section id="section-6.3">
        <h3 id="name-notation">
<a href="#section-6.3" class="section-number selfRef">6.3. </a><a href="#name-notation" class="section-name selfRef">Notation</a>
        </h3>
<p id="section-6.3-1">As a rough guide, the following conventions are used in pseudocode:<a href="#section-6.3-1" class="pilcrow">¶</a></p>
<ul>
<li id="section-6.3-2.1">All arithmetic operations are performed over a field F, unless
explicitly stated otherwise.<a href="#section-6.3-2.1" class="pilcrow">¶</a>
</li>
<li id="section-6.3-2.2">u: the input to the mapping function.
This is an element of F produced by the hash_to_base function.<a href="#section-6.3-2.2" class="pilcrow">¶</a>
</li>
<li id="section-6.3-2.3">(x, y), (X, Y), (v, w): the affine coordinates of the point output by the mapping.
Indexed variables (e.g., x1, y2, ...) are used for candidate values.<a href="#section-6.3-2.3" class="pilcrow">¶</a>
</li>
<li id="section-6.3-2.4">tv1, tv2, ...: reusable temporary variables.<a href="#section-6.3-2.4" class="pilcrow">¶</a>
</li>
<li id="section-6.3-2.5">c1, c2, ...: constant values, which can be computed in advance.<a href="#section-6.3-2.5" class="pilcrow">¶</a>
</li>
</ul>
</section>
</div>
<div id="point-sign">
<section id="section-6.4">
        <h3 id="name-sign-of-the-resulting-point">
<a href="#section-6.4" class="section-number selfRef">6.4. </a><a href="#name-sign-of-the-resulting-point" class="section-name selfRef">Sign of the resulting point</a>
        </h3>
<p id="section-6.4-1">In general, elliptic curves have equations of the form y^2 = g(x).
Most of the mappings in this section first identify an x such that
g(x) is square, then take a square root to find y. Since there
are two square roots when g(x) != 0, this results in an ambiguity
regarding the sign of y.<a href="#section-6.4-1" class="pilcrow">¶</a></p>
<p id="section-6.4-2">To resolve this ambiguity, the mappings in this section specify
the sign of the y-coordinate in terms of the input to the mapping function.
Two main reasons support this approach. First, this covers elliptic curves over
any field in a uniform way, and second, it gives implementors leeway to optimize
their square-root implementations.<a href="#section-6.4-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="map-exceptions">
<section id="section-6.5">
        <h3 id="name-exceptional-cases">
<a href="#section-6.5" class="section-number selfRef">6.5. </a><a href="#name-exceptional-cases" class="section-name selfRef">Exceptional cases</a>
        </h3>
<p id="section-6.5-1">Mappings may have have exceptional cases, i.e., inputs u
on which the mapping is undefined. These cases must be handled
carefully, especially for constant-time implementations.<a href="#section-6.5-1" class="pilcrow">¶</a></p>
<p id="section-6.5-2">For each mapping in this section, we discuss the exceptional cases and show
how to handle them in constant time. Note that all implementations SHOULD use
inv0 (<a href="#utility" class="xref">Section 4</a>) to compute multiplicative inverses, to avoid exceptional
cases that result from attempting to compute the inverse of 0.<a href="#section-6.5-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="weierstrass">
<section id="section-6.6">
        <h3 id="name-mappings-for-weierstrass-cu">
<a href="#section-6.6" class="section-number selfRef">6.6. </a><a href="#name-mappings-for-weierstrass-cu" class="section-name selfRef">Mappings for Weierstrass curves</a>
        </h3>
<p id="section-6.6-1">The following mappings apply to elliptic curves defined by the equation<a href="#section-6.6-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-6.6-2">
<pre>
    y^2 = g(x) = x^3 + A * x + B
</pre><a href="#section-6.6-2" class="pilcrow">¶</a>
</div>
<p id="section-6.6-3">where 4 * A^3 + 27 * B^2 != 0.<a href="#section-6.6-3" class="pilcrow">¶</a></p>
<div id="svdw">
<section id="section-6.6.1">
          <h4 id="name-shallue-van-de-woestijne-me">
<a href="#section-6.6.1" class="section-number selfRef">6.6.1. </a><a href="#name-shallue-van-de-woestijne-me" class="section-name selfRef">Shallue-van de Woestijne Method</a>
          </h4>
<p id="section-6.6.1-1">Shallue and van de Woestijne <span>[<a href="#SW06" class="xref">SW06</a>]</span> describe a mapping that applies to
essentially any elliptic curve.
(Note, however, that this mapping is more expensive to evaluate than
the other mappings in this document.)<a href="#section-6.6.1-1" class="pilcrow">¶</a></p>
<p id="section-6.6.1-2">The parameterization given below is for Weierstrass curves;
its derivation is detailed in <span>[<a href="#W19" class="xref">W19</a>]</span>.
This parameterization also works for Montgomery (<a href="#montgomery" class="xref">Section 6.7</a>) and
twisted Edwards (<a href="#twisted-edwards" class="xref">Section 6.8</a>) curves via the rational maps
given in <a href="#appx-rational-map" class="xref">Appendix B</a>:
first evaluate the Shallue-van de Woestijne mapping to an equivalent Weierstrass
curve, then map that point to the target Montgomery or twisted Edwards curve
using the corresponding rational map.<a href="#section-6.6.1-2" class="pilcrow">¶</a></p>
<p id="section-6.6.1-3">Preconditions: A Weierstrass curve y^2 = x^3 + A * x + B.<a href="#section-6.6.1-3" class="pilcrow">¶</a></p>
<p id="section-6.6.1-4">Constants:<a href="#section-6.6.1-4" class="pilcrow">¶</a></p>
<ul>
<li id="section-6.6.1-5.1">A and B, the parameter of the Weierstrass curve.<a href="#section-6.6.1-5.1" class="pilcrow">¶</a>
</li>
<li id="section-6.6.1-5.2">
              <p id="section-6.6.1-5.2.1">Z, an element of F meeting the below criteria.
<a href="#svdw-z-code" class="xref">Appendix E.1</a> gives a Sage <span>[<a href="#SAGE" class="xref">SAGE</a>]</span> script that outputs the RECOMMENDED Z.<a href="#section-6.6.1-5.2.1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal" id="section-6.6.1-5.2.2">
                <li id="section-6.6.1-5.2.2.1">g(Z) != 0 in F.<a href="#section-6.6.1-5.2.2.1" class="pilcrow">¶</a>
</li>
<li id="section-6.6.1-5.2.2.2">-(3 * Z^2 + 4 * A) / (4 * g(Z)) != 0 in F.<a href="#section-6.6.1-5.2.2.2" class="pilcrow">¶</a>
</li>
<li id="section-6.6.1-5.2.2.3">-(3 * Z^2 + 4 * A) / (4 * g(Z)) is square in F.<a href="#section-6.6.1-5.2.2.3" class="pilcrow">¶</a>
</li>
<li id="section-6.6.1-5.2.2.4">At least one of g(Z) and g(-Z / 2) is square in F.<a href="#section-6.6.1-5.2.2.4" class="pilcrow">¶</a>
</li>
</ol>
</li>
</ul>
<p id="section-6.6.1-6">Sign of y: Inputs u and -u give the same x-coordinate.
Thus, we set sgn0(y) == sgn0(u).<a href="#section-6.6.1-6" class="pilcrow">¶</a></p>
<p id="section-6.6.1-7">Exceptions: The exceptional cases for u occur when
(1 + u^2 * g(Z)) * (1 - u^2 * g(Z)) == 0.
The restrictions on Z given above ensure that implementations that use inv0
to invert this product are exception free.<a href="#section-6.6.1-7" class="pilcrow">¶</a></p>
<p id="section-6.6.1-8">Operations:<a href="#section-6.6.1-8" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-6.6.1-9">
<pre>
1. tv1 = u^2 * g(Z)
2. tv2 = 1 + tv1
3. tv1 = 1 - tv1
4. tv3 = inv0(tv1 * tv2)
5. tv4 = sqrt(-g(Z) * (3 * Z^2 + 4 * A))
6. tv4 = tv4 * sgn0(tv4)                    # sgn0(tv4) MUST equal 1
7. tv5 = u * tv1 * tv3 * tv4
8.  x1 = -Z / 2 - tv5
9.  x2 = -Z / 2 + tv5
10. x3 = Z - 4 * g(Z) * (tv2^2 * tv3)^2 / (3 * Z^2 + 4 * A)
11. If is_square(g(x1)), set x = x1 and y = sqrt(g(x1))
12. Else If is_square(g(x2)), set x = x2 and y = sqrt(g(x2))
13. Else set x = x3 and y = sqrt(g(x3))
14. If sgn0(u) != sgn0(y), set y = -y
15. return (x, y)
</pre><a href="#section-6.6.1-9" class="pilcrow">¶</a>
</div>
<div id="implementation">
<section id="section-6.6.1.1">
            <h5 id="name-implementation-2">
<a href="#section-6.6.1.1" class="section-number selfRef">6.6.1.1. </a><a href="#name-implementation-2" class="section-name selfRef">Implementation</a>
            </h5>
<p id="section-6.6.1.1-1">The following procedure implements the Shallue and van de Woestijne method in a
straight-line fashion.<a href="#section-6.6.1.1-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-6.6.1.1-2">
<pre>
map_to_curve_svdw(u)
Input: u, an element of F.
Output: (x, y), a point on E.

Constants:
1. c1 = g(Z)
2. c2 = -Z / 2
3. c3 = sqrt(-g(Z) * (3 * Z^2 + 4 * A))     # sgn0(c3) MUST equal 1
4. c4 = -4 * g(Z) / (3 * Z^2 + 4 * A)

Steps:
1.  tv1 = u^2
2.  tv1 = tv1 * c1
3.  tv2 = 1 + tv1
4.  tv1 = 1 - tv1
5.  tv3 = tv1 * tv2
6.  tv3 = inv0(tv3)
7.  tv4 = u * tv1
8.  tv4 = tv4 * tv3
9.  tv4 = tv4 * c3
10.  x1 = c2 - tv4
11. gx1 = x1^2
12. gx1 = gx1 + A
13. gx1 = gx1 * x1
14. gx1 = gx1 + B
15.  e1 = is_square(gx1)
16.  x2 = c2 + tv4
17. gx2 = x2^2
18. gx2 = gx2 + A
19. gx2 = gx2 * x2
20. gx2 = gx2 + B
21.  e2 = is_square(gx2) AND NOT e1     # Avoid short-circuit logic ops
22.  x3 = tv2^2
23.  x3 = x3 * tv3
24.  x3 = x3^2
25.  x3 = x3 * c4
26.  x3 = x3 + Z
27.   x = CMOV(x3, x1, e1)      # x = x1 if gx1 is square, else x = x3
28.   x = CMOV(x, x2, e2)       # x = x2 if gx2 is square and gx1 is not
29.  gx = x^2
30.  gx = gx + A
31.  gx = gx * x
32.  gx = gx + B
33.   y = sqrt(gx)
34.  e3 = sgn0(u) == sgn0(y)
35.   y = CMOV(-y, y, e3)       # Select correct sign of y
36. return (x, y)
</pre><a href="#section-6.6.1.1-2" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="simple-swu">
<section id="section-6.6.2">
          <h4 id="name-simplified-shallue-van-de-w">
<a href="#section-6.6.2" class="section-number selfRef">6.6.2. </a><a href="#name-simplified-shallue-van-de-w" class="section-name selfRef">Simplified Shallue-van de Woestijne-Ulas Method</a>
          </h4>
<p id="section-6.6.2-1">The function map_to_curve_simple_swu(u) implements a simplification
of the Shallue-van de Woestijne-Ulas mapping <span>[<a href="#U07" class="xref">U07</a>]</span> described by Brier et
al. <span>[<a href="#BCIMRT10" class="xref">BCIMRT10</a>]</span>, which they call the "simplified SWU" map. Wahby and Boneh
<span>[<a href="#WB19" class="xref">WB19</a>]</span> generalize and optimize this mapping.<a href="#section-6.6.2-1" class="pilcrow">¶</a></p>
<p id="section-6.6.2-2">Preconditions: A Weierstrass curve y^2 = x^3 + A * x + B where A != 0 and B != 0.<a href="#section-6.6.2-2" class="pilcrow">¶</a></p>
<p id="section-6.6.2-3">Constants:<a href="#section-6.6.2-3" class="pilcrow">¶</a></p>
<ul>
<li id="section-6.6.2-4.1">A and B, the parameters of the Weierstrass curve.<a href="#section-6.6.2-4.1" class="pilcrow">¶</a>
</li>
<li id="section-6.6.2-4.2">
              <p id="section-6.6.2-4.2.1">Z, an element of F meeting the below criteria.
<a href="#sswu-z-code" class="xref">Appendix E.2</a> gives a Sage <span>[<a href="#SAGE" class="xref">SAGE</a>]</span> script that outputs the RECOMMENDED Z.
The criteria are:<a href="#section-6.6.2-4.2.1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal" id="section-6.6.2-4.2.2">
                <li id="section-6.6.2-4.2.2.1">Z is non-square in F,<a href="#section-6.6.2-4.2.2.1" class="pilcrow">¶</a>
</li>
<li id="section-6.6.2-4.2.2.2">Z != -1 in F,<a href="#section-6.6.2-4.2.2.2" class="pilcrow">¶</a>
</li>
<li id="section-6.6.2-4.2.2.3">the polynomial g(x) - Z is irreducible over F, and<a href="#section-6.6.2-4.2.2.3" class="pilcrow">¶</a>
</li>
<li id="section-6.6.2-4.2.2.4">g(B / (Z * A)) is square in F.<a href="#section-6.6.2-4.2.2.4" class="pilcrow">¶</a>
</li>
</ol>
</li>
</ul>
<p id="section-6.6.2-5">Sign of y: Inputs u and -u give the same x-coordinate.
Thus, we set sgn0(y) == sgn0(u).<a href="#section-6.6.2-5" class="pilcrow">¶</a></p>
<p id="section-6.6.2-6">Exceptions: The exceptional cases are values of u such that
Z^2 * u^4 + Z * u^2 == 0. This includes u == 0, and may include
other values depending on Z. Implementations must detect
this case and set x1 = B / (Z * A), which guarantees that g(x1)
is square by the condition on Z given above.<a href="#section-6.6.2-6" class="pilcrow">¶</a></p>
<p id="section-6.6.2-7">Operations:<a href="#section-6.6.2-7" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-6.6.2-8">
<pre>
1. tv1 = inv0(Z^2 * u^4 + Z * u^2)
2.  x1 = (-B / A) * (1 + tv1)
3.  If tv1 == 0, set x1 = B / (Z * A)
4. gx1 = x1^3 + A * x1 + B
5.  x2 = Z * u^2 * x1
6. gx2 = x2^3 + A * x2 + B
7.  If is_square(gx1), set x = x1 and y = sqrt(gx1)
8.  Else set x = x2 and y = sqrt(gx2)
9.  If sgn0(u) != sgn0(y), set y = -y
10. return (x, y)
</pre><a href="#section-6.6.2-8" class="pilcrow">¶</a>
</div>
<div id="implementation-1">
<section id="section-6.6.2.1">
            <h5 id="name-implementation-3">
<a href="#section-6.6.2.1" class="section-number selfRef">6.6.2.1. </a><a href="#name-implementation-3" class="section-name selfRef">Implementation</a>
            </h5>
<p id="section-6.6.2.1-1">The following procedure implements the simplified SWU mapping in a straight-line fashion.
<a href="#samplecode" class="xref">Appendix D</a> gives an optimized straight-line procedure for P-256 <span>[<a href="#FIPS186-4" class="xref">FIPS186-4</a>]</span>.
For more information on optimizing this mapping, see
<span>[<a href="#WB19" class="xref">WB19</a>]</span> Section 4 or the example code found at <span>[<a href="#hash2curve-repo" class="xref">hash2curve-repo</a>]</span>.<a href="#section-6.6.2.1-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-6.6.2.1-2">
<pre>
map_to_curve_simple_swu(u)
Input: u, an element of F.
Output: (x, y), a point on E.

Constants:
1.  c1 = -B / A
2.  c2 = -1 / Z

Steps:
1.  tv1 = Z * u^2
2.  tv2 = tv1^2
3.   x1 = tv1 + tv2
4.   x1 = inv0(x1)
5.   e1 = x1 == 0
6.   x1 = x1 + 1
7.   x1 = CMOV(x1, c2, e1)    # If (tv1 + tv2) == 0, set x1 = -1 / Z
8.   x1 = x1 * c1      # x1 = (-B / A) * (1 + (1 / (Z^2 * u^4 + Z * u^2)))
9.  gx1 = x1^2
10. gx1 = gx1 + A
11. gx1 = gx1 * x1
12. gx1 = gx1 + B             # gx1 = g(x1) = x1^3 + A * x1 + B
13.  x2 = tv1 * x1            # x2 = Z * u^2 * x1
14. tv2 = tv1 * tv2
15. gx2 = gx1 * tv2           # gx2 = (Z * u^2)^3 * gx1
16.  e2 = is_square(gx1)
17.   x = CMOV(x2, x1, e2)    # If is_square(gx1), x = x1, else x = x2
18.  y2 = CMOV(gx2, gx1, e2)  # If is_square(gx1), y2 = gx1, else y2 = gx2
19.   y = sqrt(y2)
20.  e3 = sgn0(u) == sgn0(y)  # Fix sign of y
21.   y = CMOV(-y, y, e3)
22. return (x, y)
</pre><a href="#section-6.6.2.1-2" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="simple-swu-AB0">
<section id="section-6.6.3">
          <h4 id="name-simplified-swu-for-ab-0">
<a href="#section-6.6.3" class="section-number selfRef">6.6.3. </a><a href="#name-simplified-swu-for-ab-0" class="section-name selfRef">Simplified SWU for AB == 0</a>
          </h4>
<p id="section-6.6.3-1">Wahby and Boneh <span>[<a href="#WB19" class="xref">WB19</a>]</span> show how to adapt the simplified SWU mapping to
Weierstrass curves having A == 0 or B == 0, which the mapping of
<a href="#simple-swu" class="xref">Section 6.6.2</a> does not support.
(The case A == B == 0 is excluded because y^2 = x^3 is not an elliptic curve.)<a href="#section-6.6.3-1" class="pilcrow">¶</a></p>
<p id="section-6.6.3-2">This method applies to curves like secp256k1 <span>[<a href="#SEC2" class="xref">SEC2</a>]</span> and to pairing-friendly
curves in the Barreto-Lynn-Scott <span>[<a href="#BLS03" class="xref">BLS03</a>]</span>, Barreto-Naehrig <span>[<a href="#BN05" class="xref">BN05</a>]</span>, and other families.<a href="#section-6.6.3-2" class="pilcrow">¶</a></p>
<p id="section-6.6.3-3">This method requires finding another elliptic curve E' given by the equation<a href="#section-6.6.3-3" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-6.6.3-4">
<pre>
    y'^2 = g'(x') = x'^3 + A' * x' + B'
</pre><a href="#section-6.6.3-4" class="pilcrow">¶</a>
</div>
<p id="section-6.6.3-5">that is isogenous to E and has A' != 0 and B' != 0.
(One might do this, for example, using <span>[<a href="#SAGE" class="xref">SAGE</a>]</span>; for details, see <span>[<a href="#WB19" class="xref">WB19</a>]</span>, Appendix A.)
This isogeny defines a map iso_map(x', y') that takes as input a point
on E' and produces as output a point on E.<a href="#section-6.6.3-5" class="pilcrow">¶</a></p>
<p id="section-6.6.3-6">Once E' and iso_map are identified, this mapping works as follows: on input
u, first apply the simplified SWU mapping to get a point on E', then apply
the isogeny map to that point to get a point on E.<a href="#section-6.6.3-6" class="pilcrow">¶</a></p>
<p id="section-6.6.3-7">Note that iso_map is a group homomorphism, meaning that point addition
commutes with iso_map.
Thus, when using this mapping in the hash_to_curve construction of <a href="#roadmap" class="xref">Section 3</a>,
one can effect a small optimization by first mapping u0 and u1 to E', adding
the resulting points on E', and then applying iso_map to the sum.
This gives the same result while requiring only one evaluation of iso_map.<a href="#section-6.6.3-7" class="pilcrow">¶</a></p>
<p id="section-6.6.3-8">Preconditions: An elliptic curve E' with A' != 0 and B' != 0 that is
isogenous to the target curve E with isogeny map iso_map from
E' to E.<a href="#section-6.6.3-8" class="pilcrow">¶</a></p>
<p id="section-6.6.3-9">Helper functions:<a href="#section-6.6.3-9" class="pilcrow">¶</a></p>
<ul>
<li id="section-6.6.3-10.1">map_to_curve_simple_swu is the mapping of <a href="#simple-swu" class="xref">Section 6.6.2</a> to E'<a href="#section-6.6.3-10.1" class="pilcrow">¶</a>
</li>
<li id="section-6.6.3-10.2">iso_map is the isogeny map from E' to E<a href="#section-6.6.3-10.2" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-6.6.3-11">Sign of y: for this map, the sign is determined by map_to_curve_simple_swu.
No further sign adjustments are necessary.<a href="#section-6.6.3-11" class="pilcrow">¶</a></p>
<p id="section-6.6.3-12">Exceptions: map_to_curve_simple_swu handles its exceptional cases.
Exceptional cases of iso_map MUST return the identity point on E.<a href="#section-6.6.3-12" class="pilcrow">¶</a></p>
<p id="section-6.6.3-13">Operations:<a href="#section-6.6.3-13" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-6.6.3-14">
<pre>
1. (x', y') = map_to_curve_simple_swu(u)    # (x', y') is on E'
2.   (x, y) = iso_map(x', y')               # (x, y) is on E
3. return (x, y)
</pre><a href="#section-6.6.3-14" class="pilcrow">¶</a>
</div>
<p id="section-6.6.3-15">See <span>[<a href="#hash2curve-repo" class="xref">hash2curve-repo</a>]</span> or <span>[<a href="#WB19" class="xref">WB19</a>]</span>, Section 4.3 for details on implementing the isogeny map.<a href="#section-6.6.3-15" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="montgomery">
<section id="section-6.7">
        <h3 id="name-mappings-for-montgomery-cur">
<a href="#section-6.7" class="section-number selfRef">6.7. </a><a href="#name-mappings-for-montgomery-cur" class="section-name selfRef">Mappings for Montgomery curves</a>
        </h3>
<p id="section-6.7-1">The mapping defined in <a href="#elligator2" class="xref">Section 6.7.1</a> implements Elligator 2 <span>[<a href="#BHKL13" class="xref">BHKL13</a>]</span> for
curves defined by the Weierstrass equation<a href="#section-6.7-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-6.7-2">
<pre>
    Y^2 = X^3 + C * X^2 + D * X
</pre><a href="#section-6.7-2" class="pilcrow">¶</a>
</div>
<p id="section-6.7-3">(Note that this equation is different from the one used in <a href="#weierstrass" class="xref">Section 6.6</a>.)
This Weierstrass curve is equivalent to the Montgomery curve<a href="#section-6.7-3" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-6.7-4">
<pre>
    K * t^2 = s^3 + J * s^2 + s
</pre><a href="#section-6.7-4" class="pilcrow">¶</a>
</div>
<p id="section-6.7-5">by the following change of variables:<a href="#section-6.7-5" class="pilcrow">¶</a></p>
<ul>
<li id="section-6.7-6.1">C = J / K<a href="#section-6.7-6.1" class="pilcrow">¶</a>
</li>
<li id="section-6.7-6.2">D = 1 / K^2<a href="#section-6.7-6.2" class="pilcrow">¶</a>
</li>
<li id="section-6.7-6.3">X = s / K<a href="#section-6.7-6.3" class="pilcrow">¶</a>
</li>
<li id="section-6.7-6.4">Y = t / K<a href="#section-6.7-6.4" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-6.7-7">The Elligator 2 mapping given below returns a point (X, Y) on the
Weierstrass curve defined above.
This point can be converted to a point (s, t) on the equivalent
Montgomery curve by computing<a href="#section-6.7-7" class="pilcrow">¶</a></p>
<ul>
<li id="section-6.7-8.1">s = K * X<a href="#section-6.7-8.1" class="pilcrow">¶</a>
</li>
<li id="section-6.7-8.2">t = K * Y<a href="#section-6.7-8.2" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-6.7-9">Note that when D == K == 1, the above two curve equations
are identical and no conversion is necessary.
This is the case, for example, for Curve25519 and Curve448 <span>[<a href="#RFC7748" class="xref">RFC7748</a>]</span>.<a href="#section-6.7-9" class="pilcrow">¶</a></p>
<div id="elligator2">
<section id="section-6.7.1">
          <h4 id="name-elligator-2-method">
<a href="#section-6.7.1" class="section-number selfRef">6.7.1. </a><a href="#name-elligator-2-method" class="section-name selfRef">Elligator 2 Method</a>
          </h4>
<p id="section-6.7.1-1">Preconditions: A Weierstrass curve Y^2 = X^3 + C * X^2 + D * X
where C != 0, D != 0, and C^2 - 4 * D is non-zero and non-square in F.<a href="#section-6.7.1-1" class="pilcrow">¶</a></p>
<p id="section-6.7.1-2">Constants:<a href="#section-6.7.1-2" class="pilcrow">¶</a></p>
<ul>
<li id="section-6.7.1-3.1">C and D, the parameters of the elliptic curve.<a href="#section-6.7.1-3.1" class="pilcrow">¶</a>
</li>
<li id="section-6.7.1-3.2">Z, a non-square element of F.
<a href="#elligator-z-code" class="xref">Appendix E.3</a> gives a Sage <span>[<a href="#SAGE" class="xref">SAGE</a>]</span> script that outputs the RECOMMENDED Z.<a href="#section-6.7.1-3.2" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-6.7.1-4">Sign of Y: Inputs u and -u give the same X-coordinate.
Thus, we set sgn0(Y) == sgn0(u).<a href="#section-6.7.1-4" class="pilcrow">¶</a></p>
<p id="section-6.7.1-5">Exceptions: The exceptional case is Z * u^2 == -1, i.e., 1 + Z * u^2 == 0.
Implementations must detect this case and set X1 = -C.
Note that this can only happen when q = 3 (mod 4).<a href="#section-6.7.1-5" class="pilcrow">¶</a></p>
<p id="section-6.7.1-6">Operations:<a href="#section-6.7.1-6" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-6.7.1-7">
<pre>
1.  X1 = -C * inv0(1 + Z * u^2)
2.  If X1 == 0, set X1 = -C
3. gX1 = X1^3 + C * X1^2 + D * X1
4.  X2 = -X1 - C
5. gX2 = X2^3 + C * X2^2 + D * X2
6.  If is_square(gX1), set X = X1 and Y = sqrt(gX1)
7.  Else set X = X2 and Y = sqrt(gX2)
8.  If sgn0(u) != sgn0(Y), set Y = -Y
9.  return (X, Y)
</pre><a href="#section-6.7.1-7" class="pilcrow">¶</a>
</div>
<div id="implementation-2">
<section id="section-6.7.1.1">
            <h5 id="name-implementation-4">
<a href="#section-6.7.1.1" class="section-number selfRef">6.7.1.1. </a><a href="#name-implementation-4" class="section-name selfRef">Implementation</a>
            </h5>
<p id="section-6.7.1.1-1">The following procedure implements Elligator 2 in a straight-line fashion.
<a href="#samplecode" class="xref">Appendix D</a> gives optimized straight-line procedures for curve25519 and
curve448 <span>[<a href="#RFC7748" class="xref">RFC7748</a>]</span>.<a href="#section-6.7.1.1-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-6.7.1.1-2">
<pre>
map_to_curve_elligator2(u)
Input: u, an element of F.
Output: (X, Y), a point on E.

Steps:
1.  tv1 = u^2
2.  tv1 = Z * tv1             # Z * u^2
3.   e1 = tv1 == -1           # exceptional case: Z * u^2 == -1
4.  tv1 = CMOV(tv1, 0, e1)    # if tv1 == -1, set tv1 = 0
5.   X1 = tv1 + 1
6.   X1 = inv0(X1)
7.   X1 = -C * X1             # X1 = -C / (1 + Z * u^2)
8.  gX1 = X1 + C
9.  gX1 = gX1 * X1
10. gX1 = gX1 + D
11. gX1 = gX1 * X1            # gX1 = X1^3 + C * X1^2 + D * X1
12.  X2 = -X1 - C
13. gX2 = tv1 * gX1
14.  e2 = is_square(gX1)
15.   X = CMOV(X2, X1, e2)    # If is_square(gX1), X = X1, else X = X2
16.  Y2 = CMOV(gX2, gX1, e2)  # If is_square(gX1), Y2 = gX1, else Y2 = gX2
17.   Y = sqrt(Y2)
18.  e3 = sgn0(u) == sgn0(Y)  # Fix sign of Y
19.   Y = CMOV(-Y, Y, e3)
20. return (X, Y)
</pre><a href="#section-6.7.1.1-2" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="twisted-edwards">
<section id="section-6.8">
        <h3 id="name-mappings-for-twisted-edward">
<a href="#section-6.8" class="section-number selfRef">6.8. </a><a href="#name-mappings-for-twisted-edward" class="section-name selfRef">Mappings for Twisted Edwards curves</a>
        </h3>
<p id="section-6.8-1">Twisted Edwards curves (a class of curves that includes Edwards curves)
are given by the equation<a href="#section-6.8-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-6.8-2">
<pre>
    a * v^2 + w^2 = 1 + d * v^2 * w^2
</pre><a href="#section-6.8-2" class="pilcrow">¶</a>
</div>
<p id="section-6.8-3">with a != 0, d != 0, and a != d <span>[<a href="#BBJLP08" class="xref">BBJLP08</a>]</span>.<a href="#section-6.8-3" class="pilcrow">¶</a></p>
<p id="section-6.8-4">These curves are closely related to Montgomery
curves (<a href="#montgomery" class="xref">Section 6.7</a>): every twisted Edwards curve is birationally equivalent
to a Montgomery curve (<span>[<a href="#BBJLP08" class="xref">BBJLP08</a>]</span>, Theorem 3.2).
This equivalence yields an efficient way of hashing to a twisted Edwards curve:
first, hash to an equivalent Montgomery curve, then transform the
result into a point on the twisted Edwards curve via a rational map.
This method of hashing to a twisted Edwards curve thus requires identifying a
corresponding Montgomery curve and rational map.
We describe how to identify such a curve and map immediately below.<a href="#section-6.8-4" class="pilcrow">¶</a></p>
<div id="rational-map">
<section id="section-6.8.1">
          <h4 id="name-rational-maps-from-montgome">
<a href="#section-6.8.1" class="section-number selfRef">6.8.1. </a><a href="#name-rational-maps-from-montgome" class="section-name selfRef">Rational maps from Montgomery to twisted Edwards curves</a>
          </h4>
<p id="section-6.8.1-1">There are two ways to identify the correct Montgomery curve and
rational map for use when hashing to a given twisted Edwards curve.<a href="#section-6.8.1-1" class="pilcrow">¶</a></p>
<p id="section-6.8.1-2">When hashing to a standardized twisted Edwards curve for which a corresponding
Montgomery form and rational map are also standardized, the standard
Montgomery form and rational map MUST be used to ensure compatibility
with existing software.
Two such standardized curves are the edwards25519 and edwards448 curves,
which correspond to the Montgomery curves curve25519 and curve448, respectively.
For both of these curves, <span>[<a href="#RFC7748" class="xref">RFC7748</a>]</span> lists both the Montgomery and twisted Edwards
forms and gives the corresponding rational maps.<a href="#section-6.8.1-2" class="pilcrow">¶</a></p>
<p id="section-6.8.1-3">The rational map for edwards25519 (<span>[<a href="#RFC7748" class="xref">RFC7748</a>]</span>, Section 4.1)
uses the constant sqrt_neg_486664 = sqrt(-486664) (mod 2^255 - 19).
To ensure compatibility, this constant MUST be chosen such that
sgn0(sqrt_neg_486664) == 1.
Analogous ambiguities in other standardized rational maps MUST be
resolved in the same way: for any constant k whose sign is ambiguous,
k MUST be chosen such that sgn0(k) == 1.<a href="#section-6.8.1-3" class="pilcrow">¶</a></p>
<p id="section-6.8.1-4">The 4-isogeny map from curve448 to edwards448 (<span>[<a href="#RFC7748" class="xref">RFC7748</a>]</span>, Section 4.2)
is unambiguous with respect to sign.<a href="#section-6.8.1-4" class="pilcrow">¶</a></p>
<p id="section-6.8.1-5">When defining new twisted Edwards curves, a Montgomery equivalent and rational
map SHOULD be specified, and the sign of the rational map SHOULD be stated
unambiguously.<a href="#section-6.8.1-5" class="pilcrow">¶</a></p>
<p id="section-6.8.1-6">When hashing to a twisted Edwards curve that does not have a standardized
Montgomery form or rational map, the following procedure MUST be
used to derive them.
For a twisted Edwards curve given by<a href="#section-6.8.1-6" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-6.8.1-7">
<pre>
    a * v^2 + w^2 = 1 + d * v^2 * w^2
</pre><a href="#section-6.8.1-7" class="pilcrow">¶</a>
</div>
<p id="section-6.8.1-8">first compute C and D, the parameters of the equivalent Weierstrass
curve given by<a href="#section-6.8.1-8" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-6.8.1-9">
<pre>
    Y^2 = X^3 + C * X^2 + D * X
</pre><a href="#section-6.8.1-9" class="pilcrow">¶</a>
</div>
<p id="section-6.8.1-10">as follows:<a href="#section-6.8.1-10" class="pilcrow">¶</a></p>
<ul>
<li id="section-6.8.1-11.1">C = (a + d) / 2<a href="#section-6.8.1-11.1" class="pilcrow">¶</a>
</li>
<li id="section-6.8.1-11.2">D = (a - d)^2 / 16<a href="#section-6.8.1-11.2" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-6.8.1-12">(Note that the above curve is given in the Weierstrass form required
by the Elligator 2 mapping of <a href="#elligator2" class="xref">Section 6.7.1</a>.)
The rational map from the point (X, Y) on this Weierstrass curve
to the point (v, w) on the twisted Edwards curve is given by<a href="#section-6.8.1-12" class="pilcrow">¶</a></p>
<ul>
<li id="section-6.8.1-13.1">invSqrtD = 4 / (a - d)<a href="#section-6.8.1-13.1" class="pilcrow">¶</a>
</li>
<li id="section-6.8.1-13.2">v = X / Y<a href="#section-6.8.1-13.2" class="pilcrow">¶</a>
</li>
<li id="section-6.8.1-13.3">w = (invSqrtD * X - 1) / (invSqrtD * X + 1)<a href="#section-6.8.1-13.3" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-6.8.1-14">(For completeness, we give the inverse map in <a href="#appx-rational-map-edw" class="xref">Appendix B.1</a>.
Note that the inverse map is not used when hashing to a twisted Edwards curve.)<a href="#section-6.8.1-14" class="pilcrow">¶</a></p>
<p id="section-6.8.1-15">Rational maps may be undefined on certain inputs, e.g., when the
denominator of one of the rational functions is zero.
In the map described above, the exceptional cases are Y == 0 or invSqrtD * X == -1.
Implementations MUST detect exceptional cases and return the value
(v, w) = (0, 1), which is the identity point
on all twisted Edwards curves.<a href="#section-6.8.1-15" class="pilcrow">¶</a></p>
<p id="section-6.8.1-16">The following straight-line implementation of the above rational map
handles the exceptional cases.
Implementations of other rational maps (e.g., the ones give in <span>[<a href="#RFC7748" class="xref">RFC7748</a>]</span>)
are analogous.<a href="#section-6.8.1-16" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-6.8.1-17">
<pre>
rational_map(X, Y)
Input: (X, Y), a point on the curve Y^2 = X^3 + C * X^2 + D * X.
Output: (v, w), a point on an equivalent twisted Edwards curve.

1. tv1 = X * invSqrtD
2. tv2 = tv1 + 1
3. tv3 = Y * tv2
4. tv3 = inv0(tv3)
5.   v = tv2 * tv3
6.   v = v * X
7.   w = tv1 - 1
8.   w = w * Y
9.   w = w * tv3
10.  e = w == 0
11.  w = CMOV(w, 1, e)
12. return (v, w)
</pre><a href="#section-6.8.1-17" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="ell2edwards">
<section id="section-6.8.2">
          <h4 id="name-elligator-2-method-2">
<a href="#section-6.8.2" class="section-number selfRef">6.8.2. </a><a href="#name-elligator-2-method-2" class="section-name selfRef">Elligator 2 Method</a>
          </h4>
<p id="section-6.8.2-1">Preconditions: A twisted Edwards curve E and an equivalent curve M
meeting the requirements in <a href="#rational-map" class="xref">Section 6.8.1</a>.<a href="#section-6.8.2-1" class="pilcrow">¶</a></p>
<p id="section-6.8.2-2">Helper functions:<a href="#section-6.8.2-2" class="pilcrow">¶</a></p>
<ul>
<li id="section-6.8.2-3.1">map_to_curve_elligator2 is the mapping of <a href="#elligator2" class="xref">Section 6.7.1</a> to the curve M.<a href="#section-6.8.2-3.1" class="pilcrow">¶</a>
</li>
<li id="section-6.8.2-3.2">rational_map is a function that takes a point (X, Y) on M and
returns a point (v, w) on E, as defined in <a href="#rational-map" class="xref">Section 6.8.1</a>.<a href="#section-6.8.2-3.2" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-6.8.2-4">Sign of Y (and v): for this map, the sign is determined by map_to_curve_elligator2.
No further sign adjustments are required.<a href="#section-6.8.2-4" class="pilcrow">¶</a></p>
<p id="section-6.8.2-5">Exceptions: The exceptions for the Elligator 2 mapping are as given in
<a href="#elligator2" class="xref">Section 6.7.1</a>.
The exceptions for the rational map are as given in <a href="#rational-map" class="xref">Section 6.8.1</a>.
No other exceptions are possible.<a href="#section-6.8.2-5" class="pilcrow">¶</a></p>
<p id="section-6.8.2-6">The following procedure implements the Elligator 2 mapping for a twisted
Edwards curve.
(Note that the output point is denoted (v, w) because it is a point on
the target twisted Edwards curve.)<a href="#section-6.8.2-6" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-6.8.2-7">
<pre>
map_to_curve_elligator2_edwards(u)
Input: u, an element of F.
Output: (v, w), a point on E.

1. (X, Y) = map_to_curve_elligator2(u)      # (X, Y) is on M
2. (v, w) = rational_map(X, Y)              # (v, w) is on E
3. return (v, w)
</pre><a href="#section-6.8.2-7" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="cofactor-clearing">
<section id="section-7">
      <h2 id="name-clearing-the-cofactor">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-clearing-the-cofactor" class="section-name selfRef">Clearing the cofactor</a>
      </h2>
<p id="section-7-1">The mappings of <a href="#mappings" class="xref">Section 6</a> always output a point on the elliptic curve,
i.e., a point in a group of order h * r (<a href="#bg-curves" class="xref">Section 2.1</a>). Obtaining a point in G
may require a final operation commonly called "clearing the cofactor," which
takes as input any point on the curve.<a href="#section-7-1" class="pilcrow">¶</a></p>
<p id="section-7-2">The cofactor can always be cleared via scalar multiplication by h.
For elliptic curves where h = 1, i.e., the curves with a prime number of points,
no operation is required. This applies, for example, to the NIST curves P-256,
P-384, and P-521 <span>[<a href="#FIPS186-4" class="xref">FIPS186-4</a>]</span>.<a href="#section-7-2" class="pilcrow">¶</a></p>
<p id="section-7-3">In some cases, it is possible to clear the cofactor via a faster method than
scalar multiplication by h.
These methods are equivalent to (but usually faster than) multiplication by
some scalar h_eff whose value is determined by the method and the curve.
Examples of fast cofactor clearing methods include the following:<a href="#section-7-3" class="pilcrow">¶</a></p>
<ul>
<li id="section-7-4.1">For certain pairing-friendly curves having subgroup G2 over an extension
field, Scott et al. <span>[<a href="#SBCDK09" class="xref">SBCDK09</a>]</span> describe a method for fast cofactor clearing
that exploits an efficiently-computable endomorphism. Fuentes-Castaneda
et al. <span>[<a href="#FKR11" class="xref">FKR11</a>]</span> propose an alternative method that is sometimes more efficient.
Budroni and Pintore <span>[<a href="#BP18" class="xref">BP18</a>]</span> give concrete instantiations of these methods
for Barreto-Lynn-Scott pairing-friendly curves <span>[<a href="#BLS03" class="xref">BLS03</a>]</span>.<a href="#section-7-4.1" class="pilcrow">¶</a>
</li>
<li id="section-7-4.2">Wahby and Boneh (<span>[<a href="#WB19" class="xref">WB19</a>]</span>, Section 5) describe a trick due to Scott for
fast cofactor clearing on any elliptic curve for which the prime
factorization of h and the structure of the elliptic curve group meet
certain conditions.<a href="#section-7-4.2" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-7-5">The clear_cofactor function is parameterized by a scalar h_eff.
Specifically,<a href="#section-7-5" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-7-6">
<pre>
    clear_cofactor(P) := h_eff * P
</pre><a href="#section-7-6" class="pilcrow">¶</a>
</div>
<p id="section-7-7">where * represents scalar multiplication.
When a curve does not support a fast cofactor clearing method, h_eff = h
and the cofactor MUST be cleared via scalar multiplication.<a href="#section-7-7" class="pilcrow">¶</a></p>
<p id="section-7-8">When a curve admits a fast cofactor clearing method, clear_cofactor
MAY be evaluated either via that method or via scalar multiplication
by the equivalent h_eff; these two methods give the same result.
Note that in this case scalar multiplication by the cofactor h does not
generally give the same result as the fast method, and SHOULD NOT be used.<a href="#section-7-8" class="pilcrow">¶</a></p>
</section>
</div>
<div id="suites">
<section id="section-8">
      <h2 id="name-suites-for-hashing">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-suites-for-hashing" class="section-name selfRef">Suites for Hashing</a>
      </h2>
<p id="section-8-1">This section lists recommended suites for hashing to standard elliptic curves.<a href="#section-8-1" class="pilcrow">¶</a></p>
<p id="section-8-2">A suite fully specifies the procedure for hashing bit strings to
points on a specific elliptic curve group.
Each suite comprises the following parameters:<a href="#section-8-2" class="pilcrow">¶</a></p>
<ul>
<li id="section-8-3.1">Suite ID, a short name used to refer to a given suite.
The ID also indicates whether a suite is a random oracle or nonuniform
encoding (<a href="#term-rom" class="xref">Section 2.2.3</a>, <a href="#roadmap" class="xref">Section 3</a>).
<a href="#suiteIDformat" class="xref">Section 8.2</a> discusses the naming conventions for suite IDs.<a href="#section-8-3.1" class="pilcrow">¶</a>
</li>
<li id="section-8-3.2">E, the target elliptic curve over a field F.<a href="#section-8-3.2" class="pilcrow">¶</a>
</li>
<li id="section-8-3.3">p, the characteristic of the field F.<a href="#section-8-3.3" class="pilcrow">¶</a>
</li>
<li id="section-8-3.4">m, the extension degree of the field F.<a href="#section-8-3.4" class="pilcrow">¶</a>
</li>
<li id="section-8-3.5">sgn0, one of the variants specified in <a href="#sgn0-variants" class="xref">Section 4.1</a>.<a href="#section-8-3.5" class="pilcrow">¶</a>
</li>
<li id="section-8-3.6">H, the hash function used by hash_to_base (<a href="#hashtobase-sec" class="xref">Section 5.1</a>).<a href="#section-8-3.6" class="pilcrow">¶</a>
</li>
<li id="section-8-3.7">L, the length of HKDF-Expand output in hash_to_base (<a href="#hashtobase-sec" class="xref">Section 5.1</a>).<a href="#section-8-3.7" class="pilcrow">¶</a>
</li>
<li id="section-8-3.8">f, a mapping function from <a href="#mappings" class="xref">Section 6</a>.<a href="#section-8-3.8" class="pilcrow">¶</a>
</li>
<li id="section-8-3.9">h_eff, the scalar parameter for clear_cofactor (<a href="#cofactor-clearing" class="xref">Section 7</a>).<a href="#section-8-3.9" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-8-4">In addition to the above parameters, the mapping f may require
additional parameters Z, M, rational_map, E', and/or iso_map.
These MUST be specified when applicable.<a href="#section-8-4" class="pilcrow">¶</a></p>
<p id="section-8-5">All applications MUST choose a domain separation tag (DST)
for use with hash_to_base (<a href="#hashtobase" class="xref">Section 5</a>), in accordance with the
guidelines of <a href="#domain-separation" class="xref">Section 3.1</a>.
In addition, applications whose security requires a random oracle MUST use
a suite specifying hash_to_curve (<a href="#roadmap" class="xref">Section 3</a>); see <a href="#suiteIDformat" class="xref">Section 8.2</a>.<a href="#section-8-5" class="pilcrow">¶</a></p>
<p id="section-8-6">The below table lists the curves for which suites are defined and
the subsection that gives the corresponding parameters.<a href="#section-8-6" class="pilcrow">¶</a></p>
<table class="center" id="table-2">
        <caption><a href="#table-2" class="selfRef">Table 2</a></caption>
<thead>
          <tr>
            <th class="text-left" rowspan="1" colspan="1">E</th>
            <th class="text-left" rowspan="1" colspan="1">Section</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">NIST P-256</td>
            <td class="text-left" rowspan="1" colspan="1">
              <a href="#suites-p256" class="xref">Section 8.3</a>
</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">NIST P-384</td>
            <td class="text-left" rowspan="1" colspan="1">
              <a href="#suites-p384" class="xref">Section 8.4</a>
</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">NIST P-521</td>
            <td class="text-left" rowspan="1" colspan="1">
              <a href="#suites-p521" class="xref">Section 8.5</a>
</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">curve25519 / edwards25519</td>
            <td class="text-left" rowspan="1" colspan="1">
              <a href="#suites-25519" class="xref">Section 8.6</a>
</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">curve448 / edwards448</td>
            <td class="text-left" rowspan="1" colspan="1">
              <a href="#suites-448" class="xref">Section 8.7</a>
</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">secp256k1</td>
            <td class="text-left" rowspan="1" colspan="1">
              <a href="#suites-secp256k1" class="xref">Section 8.8</a>
</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">BLS12-381</td>
            <td class="text-left" rowspan="1" colspan="1">
              <a href="#suites-bls12381" class="xref">Section 8.9</a>
</td>
          </tr>
        </tbody>
      </table>
<div id="new-suite">
<section id="section-8.1">
        <h3 id="name-defining-a-new-hash-to-curv">
<a href="#section-8.1" class="section-number selfRef">8.1. </a><a href="#name-defining-a-new-hash-to-curv" class="section-name selfRef">Defining a new hash-to-curve suite</a>
        </h3>
<p id="section-8.1-1">The RECOMMENDED way to define a new hash-to-curve suite is:<a href="#section-8.1-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal" id="section-8.1-2">
          <li id="section-8.1-2.1">E, F, p, and m are determined by the elliptic curve and the field.<a href="#section-8.1-2.1" class="pilcrow">¶</a>
</li>
<li id="section-8.1-2.2">Choose a sgn0 variant following the guidelines in <a href="#sgn0-variants" class="xref">Section 4.1</a>.<a href="#section-8.1-2.2" class="pilcrow">¶</a>
</li>
<li id="section-8.1-2.3">Choose a hash function H meeting the requirements in <a href="#hashtobase-sec" class="xref">Section 5.1</a>,
and compute L as described in that section.<a href="#section-8.1-2.3" class="pilcrow">¶</a>
</li>
<li id="section-8.1-2.4">Choose a mapping following the guidelines in <a href="#choosing-mapping" class="xref">Section 6.1</a>,
and select any required parameters for that mapping.<a href="#section-8.1-2.4" class="pilcrow">¶</a>
</li>
<li id="section-8.1-2.5">Choose h_eff to be either the cofactor of E or, if a fast cofactor
clearing method is to be used, a value appropriate to that method
as discussed in <a href="#cofactor-clearing" class="xref">Section 7</a>.<a href="#section-8.1-2.5" class="pilcrow">¶</a>
</li>
<li id="section-8.1-2.6">Construct a Suite ID following the guidelines in <a href="#suiteIDformat" class="xref">Section 8.2</a>.<a href="#section-8.1-2.6" class="pilcrow">¶</a>
</li>
</ol>
<p id="section-8.1-3">When hashing to an elliptic curve not listed in this section, corresponding
hash-to-curve suites SHOULD be specified as described in this section.<a href="#section-8.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="suiteIDformat">
<section id="section-8.2">
        <h3 id="name-suite-id-naming-conventions">
<a href="#section-8.2" class="section-number selfRef">8.2. </a><a href="#name-suite-id-naming-conventions" class="section-name selfRef">Suite ID naming conventions</a>
        </h3>
<p id="section-8.2-1">Suite IDs MUST be constructed as follows:<a href="#section-8.2-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-8.2-2">
<pre>
CURVE_ID || "-" || HASH_ID || "-" || MAP_ID || "-" || ENC_VAR || "-"
</pre><a href="#section-8.2-2" class="pilcrow">¶</a>
</div>
<p id="section-8.2-3">The fields CURVE_ID, HASH_ID, MAP_ID, and ENC_VAR are
ASCII-encoded strings of at most 64 characters each.
Fields can contain only ASCII characters between 0x21 and 0x7E (inclusive)
other than hyphen and underscore (i.e., 0x2d, and 0x5f).
As indicated above, each field (including the last) is followed by a hyphen
("-", ASCII 0x2d); this helps to ensure that Suite IDs are prefix free.<a href="#section-8.2-3" class="pilcrow">¶</a></p>
<p id="section-8.2-4">Fields MUST be chosen as follows:<a href="#section-8.2-4" class="pilcrow">¶</a></p>
<ul>
<li id="section-8.2-5.1">CURVE_ID: a human-readable representation of the target elliptic curve.<a href="#section-8.2-5.1" class="pilcrow">¶</a>
</li>
<li id="section-8.2-5.2">
            <p id="section-8.2-5.2.1">HASH_ID: a human-readable representation of the hash function used in
hash_to_base (<a href="#hashtobase" class="xref">Section 5</a>).<a href="#section-8.2-5.2.1" class="pilcrow">¶</a></p>
<p id="section-8.2-5.2.2">
If a suite uses an alternative hash_to_base function (<a href="#hashtobase-alt" class="xref">Section 5.4</a>),
a short descriptive name MUST be chosen for that function using only the
allowed characters listed above.
That name MUST be appended to the HASH_ID field, separated by a colon.
For example, a hash_to_base function based on KMAC128 <span>[<a href="#SP.800-185" class="xref">SP.800-185</a>]</span> might
use the short name "h2b/kmac128", and a reasonable value for the HASH_ID field
would be "SHA3:h2b/kmac128".<a href="#section-8.2-5.2.2" class="pilcrow">¶</a></p>
</li>
<li id="section-8.2-5.3">MAP_ID: a human-readable representation of the map_to_curve function
(<a href="#mappings" class="xref">Section 6</a>).<a href="#section-8.2-5.3" class="pilcrow">¶</a>
</li>
<li id="section-8.2-5.4">
            <p id="section-8.2-5.4.1">ENC_VAR: a string indicating the encoding type and other information.
The first two characters of this string indicate whether the suite
represents a hash_to_curve or an encode_to_curve operation
(<a href="#roadmap" class="xref">Section 3</a>), as follows:<a href="#section-8.2-5.4.1" class="pilcrow">¶</a></p>
<ul>
<li id="section-8.2-5.4.2.1">If ENC_VAR begins with "RO", the suite uses hash_to_curve.<a href="#section-8.2-5.4.2.1" class="pilcrow">¶</a>
</li>
<li id="section-8.2-5.4.2.2">If ENC_VAR begins with "NU", the suite uses encode_to_curve.<a href="#section-8.2-5.4.2.2" class="pilcrow">¶</a>
</li>
<li id="section-8.2-5.4.2.3">ENC_VAR MUST NOT begin with any other string.<a href="#section-8.2-5.4.2.3" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-8.2-5.4.3">
ENC_VAR MAY also be used to encode other information used to identify
  variants, for example, a version number.
  The RECOMMENDED way to do so is to add one or more subfields separated
  by colons.
  For example, "RO:V02" is an appropriate ENC_VAR value for the second
  version of a random-oracle suite, while "RO:V02:FOO01:BAR17" might be
  used to indicate a variant of that suite.<a href="#section-8.2-5.4.3" class="pilcrow">¶</a></p>
</li>
</ul>
</section>
</div>
<div id="suites-p256">
<section id="section-8.3">
        <h3 id="name-suites-for-nist-p-256">
<a href="#section-8.3" class="section-number selfRef">8.3. </a><a href="#name-suites-for-nist-p-256" class="section-name selfRef">Suites for NIST P-256</a>
        </h3>
<p id="section-8.3-1">This section defines ciphersuites for the NIST P-256 elliptic curve <span>[<a href="#FIPS186-4" class="xref">FIPS186-4</a>]</span>.<a href="#section-8.3-1" class="pilcrow">¶</a></p>
<p id="section-8.3-2">The suites P256-SHA256-SSWU-RO- and P256-SHA256-SSWU-NU-
share the following parameters, in addition to the common parameters below.<a href="#section-8.3-2" class="pilcrow">¶</a></p>
<ul>
<li id="section-8.3-3.1">f: Simplified SWU method, <a href="#simple-swu" class="xref">Section 6.6.2</a><a href="#section-8.3-3.1" class="pilcrow">¶</a>
</li>
<li id="section-8.3-3.2">Z: -10<a href="#section-8.3-3.2" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-8.3-4">The suites P256-SHA256-SVDW-RO- and P256-SHA256-SVDW-NU-
share the following parameters, in addition to the common parameters below.<a href="#section-8.3-4" class="pilcrow">¶</a></p>
<ul>
<li id="section-8.3-5.1">f: Shallue-van de Woestijne method, <a href="#svdw" class="xref">Section 6.6.1</a><a href="#section-8.3-5.1" class="pilcrow">¶</a>
</li>
<li id="section-8.3-5.2">Z: -3<a href="#section-8.3-5.2" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-8.3-6">The common parameters for the above suites are:<a href="#section-8.3-6" class="pilcrow">¶</a></p>
<ul>
<li id="section-8.3-7.1">
            <p id="section-8.3-7.1.1">E: y^2 = x^3 + A * x + B, where<a href="#section-8.3-7.1.1" class="pilcrow">¶</a></p>
<ul>
<li id="section-8.3-7.1.2.1">A = -3<a href="#section-8.3-7.1.2.1" class="pilcrow">¶</a>
</li>
<li id="section-8.3-7.1.2.2">B = 0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b<a href="#section-8.3-7.1.2.2" class="pilcrow">¶</a>
</li>
</ul>
</li>
<li id="section-8.3-7.2">p: 2^256 - 2^224 + 2^192 + 2^96 - 1<a href="#section-8.3-7.2" class="pilcrow">¶</a>
</li>
<li id="section-8.3-7.3">m: 1<a href="#section-8.3-7.3" class="pilcrow">¶</a>
</li>
<li id="section-8.3-7.4">sgn0: sgn0_le (<a href="#sgn0-le" class="xref">Section 4.1.2</a>)<a href="#section-8.3-7.4" class="pilcrow">¶</a>
</li>
<li id="section-8.3-7.5">H: SHA-256<a href="#section-8.3-7.5" class="pilcrow">¶</a>
</li>
<li id="section-8.3-7.6">L: 48<a href="#section-8.3-7.6" class="pilcrow">¶</a>
</li>
<li id="section-8.3-7.7">h_eff: 1<a href="#section-8.3-7.7" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-8.3-8">An optimized example implementation of the Simplified SWU mapping
to P-256 is given in <a href="#sswu-map-to-3mod4" class="xref">Appendix D.2</a>.<a href="#section-8.3-8" class="pilcrow">¶</a></p>
</section>
</div>
<div id="suites-p384">
<section id="section-8.4">
        <h3 id="name-suites-for-nist-p-384">
<a href="#section-8.4" class="section-number selfRef">8.4. </a><a href="#name-suites-for-nist-p-384" class="section-name selfRef">Suites for NIST P-384</a>
        </h3>
<p id="section-8.4-1">This section defines ciphersuites for the NIST P-384 elliptic curve <span>[<a href="#FIPS186-4" class="xref">FIPS186-4</a>]</span>.<a href="#section-8.4-1" class="pilcrow">¶</a></p>
<p id="section-8.4-2">The suites P384-SHA512-SSWU-RO- and P384-SHA512-SSWU-NU-
share the following parameters, in addition to the common parameters below.<a href="#section-8.4-2" class="pilcrow">¶</a></p>
<ul>
<li id="section-8.4-3.1">f: Simplified SWU method, <a href="#simple-swu" class="xref">Section 6.6.2</a><a href="#section-8.4-3.1" class="pilcrow">¶</a>
</li>
<li id="section-8.4-3.2">Z: -12<a href="#section-8.4-3.2" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-8.4-4">The suites P384-SHA512-SVDW-RO- and P384-SHA512-SVDW-NU-
share the following parameters, in addition to the common parameters below.<a href="#section-8.4-4" class="pilcrow">¶</a></p>
<ul>
<li id="section-8.4-5.1">f: Shallue-van de Woestijne method, <a href="#svdw" class="xref">Section 6.6.1</a><a href="#section-8.4-5.1" class="pilcrow">¶</a>
</li>
<li id="section-8.4-5.2">Z: -1<a href="#section-8.4-5.2" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-8.4-6">The common parameters for the above suites are:<a href="#section-8.4-6" class="pilcrow">¶</a></p>
<ul>
<li id="section-8.4-7.1">
            <p id="section-8.4-7.1.1">E: y^2 = x^3 + A * x + B, where<a href="#section-8.4-7.1.1" class="pilcrow">¶</a></p>
<ul>
<li id="section-8.4-7.1.2.1">A = -3<a href="#section-8.4-7.1.2.1" class="pilcrow">¶</a>
</li>
<li id="section-8.4-7.1.2.2">B = 0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef<a href="#section-8.4-7.1.2.2" class="pilcrow">¶</a>
</li>
</ul>
</li>
<li id="section-8.4-7.2">p: 2^384 - 2^128 - 2^96 + 2^32 - 1<a href="#section-8.4-7.2" class="pilcrow">¶</a>
</li>
<li id="section-8.4-7.3">m: 1<a href="#section-8.4-7.3" class="pilcrow">¶</a>
</li>
<li id="section-8.4-7.4">sgn0: sgn0_le (<a href="#sgn0-le" class="xref">Section 4.1.2</a>)<a href="#section-8.4-7.4" class="pilcrow">¶</a>
</li>
<li id="section-8.4-7.5">H: SHA-512<a href="#section-8.4-7.5" class="pilcrow">¶</a>
</li>
<li id="section-8.4-7.6">L: 72<a href="#section-8.4-7.6" class="pilcrow">¶</a>
</li>
<li id="section-8.4-7.7">h_eff: 1<a href="#section-8.4-7.7" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-8.4-8">An optimized example implementation of the Simplified SWU mapping
to P-384 is given in <a href="#sswu-map-to-3mod4" class="xref">Appendix D.2</a>.<a href="#section-8.4-8" class="pilcrow">¶</a></p>
</section>
</div>
<div id="suites-p521">
<section id="section-8.5">
        <h3 id="name-suites-for-nist-p-521">
<a href="#section-8.5" class="section-number selfRef">8.5. </a><a href="#name-suites-for-nist-p-521" class="section-name selfRef">Suites for NIST P-521</a>
        </h3>
<p id="section-8.5-1">This section defines ciphersuites for the NIST P-521 elliptic curve <span>[<a href="#FIPS186-4" class="xref">FIPS186-4</a>]</span>.<a href="#section-8.5-1" class="pilcrow">¶</a></p>
<p id="section-8.5-2">The suites P521-SHA512-SSWU-RO- and P521-SHA512-SSWU-NU-
share the following parameters, in addition to the common parameters below.<a href="#section-8.5-2" class="pilcrow">¶</a></p>
<ul>
<li id="section-8.5-3.1">f: Simplified SWU method, <a href="#simple-swu" class="xref">Section 6.6.2</a><a href="#section-8.5-3.1" class="pilcrow">¶</a>
</li>
<li id="section-8.5-3.2">Z: -4<a href="#section-8.5-3.2" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-8.5-4">The suites P521-SHA512-SVDW-RO- and P521-SHA512-SVDW-NU-
share the following parameters, in addition to the common parameters below.<a href="#section-8.5-4" class="pilcrow">¶</a></p>
<ul>
<li id="section-8.5-5.1">f: Shallue-van de Woestijne method, <a href="#svdw" class="xref">Section 6.6.1</a><a href="#section-8.5-5.1" class="pilcrow">¶</a>
</li>
<li id="section-8.5-5.2">Z: 1<a href="#section-8.5-5.2" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-8.5-6">The common parameters for the above suites are:<a href="#section-8.5-6" class="pilcrow">¶</a></p>
<ul>
<li id="section-8.5-7.1">
            <p id="section-8.5-7.1.1">E: y^2 = x^3 + A * x + B, where<a href="#section-8.5-7.1.1" class="pilcrow">¶</a></p>
<ul>
<li id="section-8.5-7.1.2.1">A = -3<a href="#section-8.5-7.1.2.1" class="pilcrow">¶</a>
</li>
<li id="section-8.5-7.1.2.2">B = 0x51953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00<a href="#section-8.5-7.1.2.2" class="pilcrow">¶</a>
</li>
</ul>
</li>
<li id="section-8.5-7.2">p: 2^521 - 1<a href="#section-8.5-7.2" class="pilcrow">¶</a>
</li>
<li id="section-8.5-7.3">m: 1<a href="#section-8.5-7.3" class="pilcrow">¶</a>
</li>
<li id="section-8.5-7.4">sgn0: sgn0_le (<a href="#sgn0-le" class="xref">Section 4.1.2</a>)<a href="#section-8.5-7.4" class="pilcrow">¶</a>
</li>
<li id="section-8.5-7.5">H: SHA-512<a href="#section-8.5-7.5" class="pilcrow">¶</a>
</li>
<li id="section-8.5-7.6">L: 96<a href="#section-8.5-7.6" class="pilcrow">¶</a>
</li>
<li id="section-8.5-7.7">h_eff: 1<a href="#section-8.5-7.7" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-8.5-8">An optimized example implementation of the Simplified SWU mapping
to P-521 is given in <a href="#sswu-map-to-3mod4" class="xref">Appendix D.2</a>.<a href="#section-8.5-8" class="pilcrow">¶</a></p>
</section>
</div>
<div id="suites-25519">
<section id="section-8.6">
        <h3 id="name-suites-for-curve25519-and-e">
<a href="#section-8.6" class="section-number selfRef">8.6. </a><a href="#name-suites-for-curve25519-and-e" class="section-name selfRef">Suites for curve25519 and edwards25519</a>
        </h3>
<p id="section-8.6-1">This section defines ciphersuites for curve25519 and edwards25519 <span>[<a href="#RFC7748" class="xref">RFC7748</a>]</span>.<a href="#section-8.6-1" class="pilcrow">¶</a></p>
<p id="section-8.6-2">The suites curve25519-SHA256-ELL2-RO- and curve25519-SHA256-ELL2-NU-
share the following parameters, in addition to the common parameters below.<a href="#section-8.6-2" class="pilcrow">¶</a></p>
<ul>
<li id="section-8.6-3.1">
            <p id="section-8.6-3.1.1">E: K * t^2 = s^3 + J * s^2 + s, where<a href="#section-8.6-3.1.1" class="pilcrow">¶</a></p>
<ul>
<li id="section-8.6-3.1.2.1">J = 486662<a href="#section-8.6-3.1.2.1" class="pilcrow">¶</a>
</li>
<li id="section-8.6-3.1.2.2">K = 1<a href="#section-8.6-3.1.2.2" class="pilcrow">¶</a>
</li>
</ul>
</li>
<li id="section-8.6-3.2">f: Elligator 2 method, <a href="#elligator2" class="xref">Section 6.7.1</a><a href="#section-8.6-3.2" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-8.6-4">The suites edwards25519-SHA256-EDELL2-RO- and edwards25519-SHA256-EDELL2-NU-
share the following parameters, in addition to the common parameters below.<a href="#section-8.6-4" class="pilcrow">¶</a></p>
<ul>
<li id="section-8.6-5.1">
            <p id="section-8.6-5.1.1">E: a * v^2 + w^2 = 1 + d * v^2 * w^2, where<a href="#section-8.6-5.1.1" class="pilcrow">¶</a></p>
<ul>
<li id="section-8.6-5.1.2.1">a = -1<a href="#section-8.6-5.1.2.1" class="pilcrow">¶</a>
</li>
<li id="section-8.6-5.1.2.2">d = 0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3<a href="#section-8.6-5.1.2.2" class="pilcrow">¶</a>
</li>
</ul>
</li>
<li id="section-8.6-5.2">f: Twisted Edwards Elligator 2 method, <a href="#ell2edwards" class="xref">Section 6.8.2</a><a href="#section-8.6-5.2" class="pilcrow">¶</a>
</li>
<li id="section-8.6-5.3">M: curve25519 defined in <span>[<a href="#RFC7748" class="xref">RFC7748</a>]</span>, Section 4.1<a href="#section-8.6-5.3" class="pilcrow">¶</a>
</li>
<li id="section-8.6-5.4">rational_map: the birational map defined in <span>[<a href="#RFC7748" class="xref">RFC7748</a>]</span>, Section 4.1<a href="#section-8.6-5.4" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-8.6-6">The common parameters for all of the above suites are:<a href="#section-8.6-6" class="pilcrow">¶</a></p>
<ul>
<li id="section-8.6-7.1">p: 2^255 - 19<a href="#section-8.6-7.1" class="pilcrow">¶</a>
</li>
<li id="section-8.6-7.2">m: 1<a href="#section-8.6-7.2" class="pilcrow">¶</a>
</li>
<li id="section-8.6-7.3">sgn0: sgn0_le (<a href="#sgn0-le" class="xref">Section 4.1.2</a>)<a href="#section-8.6-7.3" class="pilcrow">¶</a>
</li>
<li id="section-8.6-7.4">H: SHA-256<a href="#section-8.6-7.4" class="pilcrow">¶</a>
</li>
<li id="section-8.6-7.5">L: 48<a href="#section-8.6-7.5" class="pilcrow">¶</a>
</li>
<li id="section-8.6-7.6">Z: 2<a href="#section-8.6-7.6" class="pilcrow">¶</a>
</li>
<li id="section-8.6-7.7">h_eff: 8<a href="#section-8.6-7.7" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-8.6-8">The suites curve25519-SHA512-ELL2-RO-, curve25519-SHA512-ELL2-NU-,
edwards25519-SHA512-EDELL2-RO-, and edwards25519-SHA512-EDELL2-NU-
are identical to the correspondingly named suites defined above,
except that H is SHA-512.<a href="#section-8.6-8" class="pilcrow">¶</a></p>
<p id="section-8.6-9">Optimized example implementations of the above mappings are given in
<a href="#map-to-curve25519" class="xref">Appendix D.3</a> and <a href="#map-to-edwards25519" class="xref">Appendix D.4</a>.<a href="#section-8.6-9" class="pilcrow">¶</a></p>
</section>
</div>
<div id="suites-448">
<section id="section-8.7">
        <h3 id="name-suites-for-curve448-and-edw">
<a href="#section-8.7" class="section-number selfRef">8.7. </a><a href="#name-suites-for-curve448-and-edw" class="section-name selfRef">Suites for curve448 and edwards448</a>
        </h3>
<p id="section-8.7-1">This section defines ciphersuites for curve448 and edwards448 <span>[<a href="#RFC7748" class="xref">RFC7748</a>]</span>.<a href="#section-8.7-1" class="pilcrow">¶</a></p>
<p id="section-8.7-2">The suites curve448-SHA512-ELL2-RO- and curve448-SHA512-ELL2-NU-
share the following parameters, in addition to the common parameters below.<a href="#section-8.7-2" class="pilcrow">¶</a></p>
<ul>
<li id="section-8.7-3.1">
            <p id="section-8.7-3.1.1">E: K * t^2 = s^3 + J * s^2 + s, where<a href="#section-8.7-3.1.1" class="pilcrow">¶</a></p>
<ul>
<li id="section-8.7-3.1.2.1">J = 156326<a href="#section-8.7-3.1.2.1" class="pilcrow">¶</a>
</li>
<li id="section-8.7-3.1.2.2">K = 1<a href="#section-8.7-3.1.2.2" class="pilcrow">¶</a>
</li>
</ul>
</li>
<li id="section-8.7-3.2">f: Elligator 2 method, <a href="#elligator2" class="xref">Section 6.7.1</a><a href="#section-8.7-3.2" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-8.7-4">The suites edwards448-SHA512-EDELL2-RO- and edwards448-SHA512-EDELL2-NU-
share the following parameters, in addition to the common parameters below.<a href="#section-8.7-4" class="pilcrow">¶</a></p>
<ul>
<li id="section-8.7-5.1">
            <p id="section-8.7-5.1.1">E: a * v^2 + w^2 = 1 + d * v^2 * w^2, where<a href="#section-8.7-5.1.1" class="pilcrow">¶</a></p>
<ul>
<li id="section-8.7-5.1.2.1">a = 1<a href="#section-8.7-5.1.2.1" class="pilcrow">¶</a>
</li>
<li id="section-8.7-5.1.2.2">d = -39081<a href="#section-8.7-5.1.2.2" class="pilcrow">¶</a>
</li>
</ul>
</li>
<li id="section-8.7-5.2">f: Twisted Edwards Elligator 2 method, <a href="#ell2edwards" class="xref">Section 6.8.2</a><a href="#section-8.7-5.2" class="pilcrow">¶</a>
</li>
<li id="section-8.7-5.3">M: curve448, defined in <span>[<a href="#RFC7748" class="xref">RFC7748</a>]</span>, Section 4.2<a href="#section-8.7-5.3" class="pilcrow">¶</a>
</li>
<li id="section-8.7-5.4">rational_map: the 4-isogeny map defined in <span>[<a href="#RFC7748" class="xref">RFC7748</a>]</span>, Section 4.2<a href="#section-8.7-5.4" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-8.7-6">The common parameters for all of the above suites are:<a href="#section-8.7-6" class="pilcrow">¶</a></p>
<ul>
<li id="section-8.7-7.1">p: 2^448 - 2^224 - 1<a href="#section-8.7-7.1" class="pilcrow">¶</a>
</li>
<li id="section-8.7-7.2">m: 1<a href="#section-8.7-7.2" class="pilcrow">¶</a>
</li>
<li id="section-8.7-7.3">sgn0: sgn0_le (<a href="#sgn0-le" class="xref">Section 4.1.2</a>)<a href="#section-8.7-7.3" class="pilcrow">¶</a>
</li>
<li id="section-8.7-7.4">H: SHA-512<a href="#section-8.7-7.4" class="pilcrow">¶</a>
</li>
<li id="section-8.7-7.5">L: 84<a href="#section-8.7-7.5" class="pilcrow">¶</a>
</li>
<li id="section-8.7-7.6">Z: -1<a href="#section-8.7-7.6" class="pilcrow">¶</a>
</li>
<li id="section-8.7-7.7">h_eff: 4<a href="#section-8.7-7.7" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-8.7-8">Optimized example implementations of the above mappings are given in
<a href="#map-to-curve448" class="xref">Appendix D.5</a> and <a href="#map-to-edwards448" class="xref">Appendix D.6</a>.<a href="#section-8.7-8" class="pilcrow">¶</a></p>
</section>
</div>
<div id="suites-secp256k1">
<section id="section-8.8">
        <h3 id="name-suites-for-secp256k1">
<a href="#section-8.8" class="section-number selfRef">8.8. </a><a href="#name-suites-for-secp256k1" class="section-name selfRef">Suites for secp256k1</a>
        </h3>
<p id="section-8.8-1">This section defines ciphersuites for the secp256k1 elliptic curve <span>[<a href="#SEC2" class="xref">SEC2</a>]</span>.<a href="#section-8.8-1" class="pilcrow">¶</a></p>
<p id="section-8.8-2">The suites secp256k1-SHA256-SSWU-RO- and secp256k1-SHA256-SSWU-NU-
share the following parameters, in addition to the common parameters below.<a href="#section-8.8-2" class="pilcrow">¶</a></p>
<ul>
<li id="section-8.8-3.1">f: Simplified SWU for AB == 0, <a href="#simple-swu-AB0" class="xref">Section 6.6.3</a><a href="#section-8.8-3.1" class="pilcrow">¶</a>
</li>
<li id="section-8.8-3.2">Z: -11<a href="#section-8.8-3.2" class="pilcrow">¶</a>
</li>
<li id="section-8.8-3.3">
            <p id="section-8.8-3.3.1">E': y'^2 = x'^3 + A' * x' + B', where<a href="#section-8.8-3.3.1" class="pilcrow">¶</a></p>
<ul>
<li id="section-8.8-3.3.2.1">A': 0x3f8731abdd661adca08a5558f0f5d272e953d363cb6f0e5d405447c01a444533<a href="#section-8.8-3.3.2.1" class="pilcrow">¶</a>
</li>
<li id="section-8.8-3.3.2.2">B': 1771<a href="#section-8.8-3.3.2.2" class="pilcrow">¶</a>
</li>
</ul>
</li>
<li id="section-8.8-3.4">iso_map: the 3-isogeny map from E' to E given in <a href="#appx-iso-secp256k1" class="xref">Appendix C.1</a><a href="#section-8.8-3.4" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-8.8-4">The suites secp256k1-SHA256-SVDW-RO- and secp256k1-SHA256-SVDW-NU-
share the following parameters, in addition to the common parameters below.<a href="#section-8.8-4" class="pilcrow">¶</a></p>
<ul>
<li id="section-8.8-5.1">f: Shallue-van de Woestijne method, <a href="#svdw" class="xref">Section 6.6.1</a><a href="#section-8.8-5.1" class="pilcrow">¶</a>
</li>
<li id="section-8.8-5.2">Z: 1<a href="#section-8.8-5.2" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-8.8-6">The common parameters for all of the above suites are:<a href="#section-8.8-6" class="pilcrow">¶</a></p>
<ul>
<li id="section-8.8-7.1">E: y^2 = x^3 + 7<a href="#section-8.8-7.1" class="pilcrow">¶</a>
</li>
<li id="section-8.8-7.2">p: 2^256 - 2^32 - 2^9 - 2^8 - 2^7 - 2^6 - 2^4 - 1<a href="#section-8.8-7.2" class="pilcrow">¶</a>
</li>
<li id="section-8.8-7.3">m: 1<a href="#section-8.8-7.3" class="pilcrow">¶</a>
</li>
<li id="section-8.8-7.4">sgn0: sgn0_le (<a href="#sgn0-le" class="xref">Section 4.1.2</a>)<a href="#section-8.8-7.4" class="pilcrow">¶</a>
</li>
<li id="section-8.8-7.5">H: SHA-256<a href="#section-8.8-7.5" class="pilcrow">¶</a>
</li>
<li id="section-8.8-7.6">L: 48<a href="#section-8.8-7.6" class="pilcrow">¶</a>
</li>
<li id="section-8.8-7.7">h_eff: 1<a href="#section-8.8-7.7" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-8.8-8">An optimized example implementation of the Simplified SWU mapping
to the curve E' isogenous to secp256k1 is given in <a href="#sswu-map-to-3mod4" class="xref">Appendix D.2</a>.<a href="#section-8.8-8" class="pilcrow">¶</a></p>
</section>
</div>
<div id="suites-bls12381">
<section id="section-8.9">
        <h3 id="name-suites-for-bls12-381">
<a href="#section-8.9" class="section-number selfRef">8.9. </a><a href="#name-suites-for-bls12-381" class="section-name selfRef">Suites for BLS12-381</a>
        </h3>
<p id="section-8.9-1">This section defines ciphersuites for groups G1 and G2 of
the BLS12-381 elliptic curve <span>[<a href="#BLS12-381" class="xref">BLS12-381</a>]</span>.<a href="#section-8.9-1" class="pilcrow">¶</a></p>
<div id="suites-bls12381-g1">
<section id="section-8.9.1">
          <h4 id="name-bls12-381-g1">
<a href="#section-8.9.1" class="section-number selfRef">8.9.1. </a><a href="#name-bls12-381-g1" class="section-name selfRef">BLS12-381 G1</a>
          </h4>
<p id="section-8.9.1-1">The suites BLS12381G1-SHA256-SSWU-RO- and BLS12381G1-SHA256-SSWU-NU-
share the following parameters, in addition to the common parameters below.<a href="#section-8.9.1-1" class="pilcrow">¶</a></p>
<ul>
<li id="section-8.9.1-2.1">f: Simplified SWU for AB == 0, <a href="#simple-swu-AB0" class="xref">Section 6.6.3</a><a href="#section-8.9.1-2.1" class="pilcrow">¶</a>
</li>
<li id="section-8.9.1-2.2">Z: 11<a href="#section-8.9.1-2.2" class="pilcrow">¶</a>
</li>
<li id="section-8.9.1-2.3">
              <p id="section-8.9.1-2.3.1">E': y'^2 = x'^3 + A' * x' + B', where<a href="#section-8.9.1-2.3.1" class="pilcrow">¶</a></p>
<ul>
<li id="section-8.9.1-2.3.2.1">A' = 0x144698a3b8e9433d693a02c96d4982b0ea985383ee66a8d8e8981aefd881ac98936f8da0e0f97f5cf428082d584c1d<a href="#section-8.9.1-2.3.2.1" class="pilcrow">¶</a>
</li>
<li id="section-8.9.1-2.3.2.2">B' = 0x12e2908d11688030018b12e8753eee3b2016c1f0f24f4070a0b9c14fcef35ef55a23215a316ceaa5d1cc48e98e172be0<a href="#section-8.9.1-2.3.2.2" class="pilcrow">¶</a>
</li>
</ul>
</li>
<li id="section-8.9.1-2.4">iso_map: the 11-isogeny map from E' to E given in <a href="#appx-iso-bls12381-g1" class="xref">Appendix C.2</a><a href="#section-8.9.1-2.4" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-8.9.1-3">The suites BLS12381G1-SHA256-SVDW-RO- and BLS12381G1-SHA256-SVDW-NU-
share the following parameters, in addition to the common parameters below.<a href="#section-8.9.1-3" class="pilcrow">¶</a></p>
<ul>
<li id="section-8.9.1-4.1">f: Shallue-van de Woestijne method, <a href="#svdw" class="xref">Section 6.6.1</a><a href="#section-8.9.1-4.1" class="pilcrow">¶</a>
</li>
<li id="section-8.9.1-4.2">Z: -3<a href="#section-8.9.1-4.2" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-8.9.1-5">The common parameters for the above suites are:<a href="#section-8.9.1-5" class="pilcrow">¶</a></p>
<ul>
<li id="section-8.9.1-6.1">E: y^2 = x^3 + 4<a href="#section-8.9.1-6.1" class="pilcrow">¶</a>
</li>
<li id="section-8.9.1-6.2">p: 0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaaab<a href="#section-8.9.1-6.2" class="pilcrow">¶</a>
</li>
<li id="section-8.9.1-6.3">m: 1<a href="#section-8.9.1-6.3" class="pilcrow">¶</a>
</li>
<li id="section-8.9.1-6.4">sgn0: sgn0_be (<a href="#sgn0-be" class="xref">Section 4.1.1</a>)<a href="#section-8.9.1-6.4" class="pilcrow">¶</a>
</li>
<li id="section-8.9.1-6.5">H: SHA-256<a href="#section-8.9.1-6.5" class="pilcrow">¶</a>
</li>
<li id="section-8.9.1-6.6">L: 64<a href="#section-8.9.1-6.6" class="pilcrow">¶</a>
</li>
<li id="section-8.9.1-6.7">h_eff: 0xd201000000010001<a href="#section-8.9.1-6.7" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-8.9.1-7">Note that this h_eff value is chosen for compatibility
with the fast cofactor clearing method described by Scott (<span>[<a href="#WB19" class="xref">WB19</a>]</span> Section 5).<a href="#section-8.9.1-7" class="pilcrow">¶</a></p>
<p id="section-8.9.1-8">An optimized example implementation of the Simplified SWU mapping
to the curve E' isogenous to BLS12-381 G1 is given in <a href="#sswu-map-to-3mod4" class="xref">Appendix D.2</a>.<a href="#section-8.9.1-8" class="pilcrow">¶</a></p>
</section>
</div>
<div id="suites-bls12381-g2">
<section id="section-8.9.2">
          <h4 id="name-bls12-381-g2">
<a href="#section-8.9.2" class="section-number selfRef">8.9.2. </a><a href="#name-bls12-381-g2" class="section-name selfRef">BLS12-381 G2</a>
          </h4>
<p id="section-8.9.2-1">Group G2 of BLS12-381 is defined over a field F = GF(p^m) defined as:<a href="#section-8.9.2-1" class="pilcrow">¶</a></p>
<ul>
<li id="section-8.9.2-2.1">p: 0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaaab<a href="#section-8.9.2-2.1" class="pilcrow">¶</a>
</li>
<li id="section-8.9.2-2.2">m: 2<a href="#section-8.9.2-2.2" class="pilcrow">¶</a>
</li>
<li id="section-8.9.2-2.3">(1, I) is the basis for F, where I^2 + 1 == 0 in F<a href="#section-8.9.2-2.3" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-8.9.2-3">The suites BLS12381G2-SHA256-SSWU-RO- and BLS12381G2-SHA256-SSWU-NU-
share the following parameters, in addition to the common parameters below.<a href="#section-8.9.2-3" class="pilcrow">¶</a></p>
<ul>
<li id="section-8.9.2-4.1">f: Simplified SWU for AB == 0, <a href="#simple-swu-AB0" class="xref">Section 6.6.3</a><a href="#section-8.9.2-4.1" class="pilcrow">¶</a>
</li>
<li id="section-8.9.2-4.2">Z: -(2 + I)<a href="#section-8.9.2-4.2" class="pilcrow">¶</a>
</li>
<li id="section-8.9.2-4.3">
              <p id="section-8.9.2-4.3.1">E': y'^2 = x'^3 + A' * x' + B', where<a href="#section-8.9.2-4.3.1" class="pilcrow">¶</a></p>
<ul>
<li id="section-8.9.2-4.3.2.1">A' = 240 * I<a href="#section-8.9.2-4.3.2.1" class="pilcrow">¶</a>
</li>
<li id="section-8.9.2-4.3.2.2">B' = 1012 * (1 + I)<a href="#section-8.9.2-4.3.2.2" class="pilcrow">¶</a>
</li>
</ul>
</li>
<li id="section-8.9.2-4.4">iso_map: the isogeny map from E' to E given in <a href="#appx-iso-bls12381-g2" class="xref">Appendix C.3</a><a href="#section-8.9.2-4.4" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-8.9.2-5">The suites BLS12381G2-SHA256-SVDW-RO- and BLS12381G2-SHA256-SVDW-NU-
share the following parameters, in addition to the common parameters below.<a href="#section-8.9.2-5" class="pilcrow">¶</a></p>
<ul>
<li id="section-8.9.2-6.1">f: Shallue-van de Woestijne method, <a href="#svdw" class="xref">Section 6.6.1</a><a href="#section-8.9.2-6.1" class="pilcrow">¶</a>
</li>
<li id="section-8.9.2-6.2">Z: I<a href="#section-8.9.2-6.2" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-8.9.2-7">The common parameters for the above suites are:<a href="#section-8.9.2-7" class="pilcrow">¶</a></p>
<ul>
<li id="section-8.9.2-8.1">E: y^2 = x^3 + 4 * (1 + I)<a href="#section-8.9.2-8.1" class="pilcrow">¶</a>
</li>
<li id="section-8.9.2-8.2">p, m, F: defined above<a href="#section-8.9.2-8.2" class="pilcrow">¶</a>
</li>
<li id="section-8.9.2-8.3">sgn0: sgn0_be (<a href="#sgn0-be" class="xref">Section 4.1.1</a>)<a href="#section-8.9.2-8.3" class="pilcrow">¶</a>
</li>
<li id="section-8.9.2-8.4">H: SHA-256<a href="#section-8.9.2-8.4" class="pilcrow">¶</a>
</li>
<li id="section-8.9.2-8.5">L: 64<a href="#section-8.9.2-8.5" class="pilcrow">¶</a>
</li>
<li id="section-8.9.2-8.6">h_eff: 0xbc69f08f2ee75b3584c6a0ea91b352888e2a8e9145ad7689986ff031508ffe1329c2f178731db956d82bf015d1212b02ec0ec69d7477c1ae954cbc06689f6a359894c0adebbf6b4e8020005aaa95551<a href="#section-8.9.2-8.6" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-8.9.2-9">Note that this h_eff value is chosen for compatibility
with the fast cofactor clearing method described by
Budroni and Pintore (<span>[<a href="#BP18" class="xref">BP18</a>]</span>, Section 4.1).<a href="#section-8.9.2-9" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="iana-considerations">
<section id="section-9">
      <h2 id="name-iana-considerations">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-9-1">This document has no IANA actions.<a href="#section-9-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="security-considerations">
<section id="section-10">
      <h2 id="name-security-considerations-2">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-security-considerations-2" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-10-1">When constant-time implementations are required, all basic operations and
utility functions must be implemented in constant time, as discussed in
<a href="#utility" class="xref">Section 4</a>.<a href="#section-10-1" class="pilcrow">¶</a></p>
<p id="section-10-2">Each encoding function accepts arbitrary input and maps it to a pseudorandom
point on the curve.
Directly evaluating the mappings of <a href="#mappings" class="xref">Section 6</a> produces an output that is
distinguishable from random.
<a href="#roadmap" class="xref">Section 3</a> shows how to use these mappings to construct a function approximating a
random oracle.<a href="#section-10-2" class="pilcrow">¶</a></p>
<p id="section-10-3"><a href="#domain-separation" class="xref">Section 3.1</a> describes considerations related to domain separation
for random oracle encodings.<a href="#section-10-3" class="pilcrow">¶</a></p>
<p id="section-10-4"><a href="#hashtobase" class="xref">Section 5</a> describes considerations for uniformly hashing to field elements.<a href="#section-10-4" class="pilcrow">¶</a></p>
<p id="section-10-5">When the hash_to_curve function (<a href="#roadmap" class="xref">Section 3</a>) is instantiated
with hash_to_base (<a href="#hashtobase" class="xref">Section 5</a>), the resulting function is
indifferentiable from a random oracle (<span>[<a href="#FFSTV13" class="xref">FFSTV13</a>]</span>, <span>[<a href="#LBB19" class="xref">LBB19</a>]</span>, <span>[<a href="#MRH04" class="xref">MRH04</a>]</span>).
In most cases such a function can be safely used in protocols whose security
analysis assumes a random oracle that outputs points on an elliptic curve.
As Ristenpart et al. discuss in <span>[<a href="#RSS11" class="xref">RSS11</a>]</span>, however, not all security proofs
that rely on random oracles continue to hold when those oracles are replaced
by indifferentiable functionalities.
This limitation should be considered when analyzing the security of protocols
relying on the hash_to_curve function.<a href="#section-10-5" class="pilcrow">¶</a></p>
<p id="section-10-6">When hashing passwords using any function described in this document, an adversary
who learns the output of the hash function (or potentially any intermediate value,
e.g., the output of hash_to_base) may be able to carry out a dictionary attack.
To mitigate such attacks, it is recommended to first execute a more costly key
derivation function (e.g., PBKDF2 <span>[<a href="#RFC2898" class="xref">RFC2898</a>]</span> or scrypt <span>[<a href="#RFC7914" class="xref">RFC7914</a>]</span>) on the password,
then hash the output of that function to the target elliptic curve.
For collision resistance, the hash underlying the key derivation function
should be chosen according to the guidelines listed in <a href="#hashtobase-sec" class="xref">Section 5.1</a>.<a href="#section-10-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="acknowledgements">
<section id="section-11">
      <h2 id="name-acknowledgements">
<a href="#section-11" class="section-number selfRef">11. </a><a href="#name-acknowledgements" class="section-name selfRef">Acknowledgements</a>
      </h2>
<p id="section-11-1">The authors would like to thank Adam Langley for his detailed writeup of Elligator 2 with
Curve25519 <span>[<a href="#L13" class="xref">L13</a>]</span>;
Christopher Patton and Benjamin Lipp for educational discussions; and
Sean Devlin, Justin Drake, Dan Harkins, Thomas Icart, Leonid Reyzin, Michael Scott,
and Mathy Vanhoef for helpful feedback.<a href="#section-11-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="contributors">
<section id="section-12">
      <h2 id="name-contributors">
<a href="#section-12" class="section-number selfRef">12. </a><a href="#name-contributors" class="section-name selfRef">Contributors</a>
      </h2>
<ul>
<li id="section-12-1.1">
          <p id="section-12-1.1.1">Sharon Goldberg<a href="#section-12-1.1.1" class="pilcrow">¶</a></p>
<p id="section-12-1.1.2">
Boston University<a href="#section-12-1.1.2" class="pilcrow">¶</a></p>
<p id="section-12-1.1.3">
goldbe@cs.bu.edu<a href="#section-12-1.1.3" class="pilcrow">¶</a></p>
</li>
<li id="section-12-1.2">
          <p id="section-12-1.2.1">Ela Lee<a href="#section-12-1.2.1" class="pilcrow">¶</a></p>
<p id="section-12-1.2.2">
Royal Holloway, University of London<a href="#section-12-1.2.2" class="pilcrow">¶</a></p>
<p id="section-12-1.2.3">
Ela.Lee.2010@live.rhul.ac.uk<a href="#section-12-1.2.3" class="pilcrow">¶</a></p>
</li>
</ul>
</section>
</div>
<section id="section-13">
      <h2 id="name-references">
<a href="#section-13" class="section-number selfRef">13. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<section id="section-13.1">
        <h3 id="name-normative-references">
<a href="#section-13.1" class="section-number selfRef">13.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="RFC2119">[RFC2119]</dt>
<dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dt id="RFC2898">[RFC2898]</dt>
<dd>
<span class="refAuthor">Kaliski, B.</span>, <span class="refTitle">"PKCS #5: Password-Based Cryptography Specification Version 2.0"</span>, <span class="seriesInfo">RFC 2898</span>, <span class="seriesInfo">DOI 10.17487/RFC2898</span>, <time datetime="2000-09">September 2000</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2898">https://www.rfc-editor.org/info/rfc2898</a>&gt;</span>. </dd>
<dt id="RFC5869">[RFC5869]</dt>
<dd>
<span class="refAuthor">Krawczyk, H.</span><span class="refAuthor"> and P. Eronen</span>, <span class="refTitle">"HMAC-based Extract-and-Expand Key Derivation Function (HKDF)"</span>, <span class="seriesInfo">RFC 5869</span>, <span class="seriesInfo">DOI 10.17487/RFC5869</span>, <time datetime="2010-05">May 2010</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5869">https://www.rfc-editor.org/info/rfc5869</a>&gt;</span>. </dd>
<dt id="RFC7748">[RFC7748]</dt>
<dd>
<span class="refAuthor">Langley, A.</span><span class="refAuthor">, Hamburg, M.</span><span class="refAuthor">, and S. Turner</span>, <span class="refTitle">"Elliptic Curves for Security"</span>, <span class="seriesInfo">RFC 7748</span>, <span class="seriesInfo">DOI 10.17487/RFC7748</span>, <time datetime="2016-01">January 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7748">https://www.rfc-editor.org/info/rfc7748</a>&gt;</span>. </dd>
<dt id="RFC7914">[RFC7914]</dt>
<dd>
<span class="refAuthor">Percival, C.</span><span class="refAuthor"> and S. Josefsson</span>, <span class="refTitle">"The scrypt Password-Based Key Derivation Function"</span>, <span class="seriesInfo">RFC 7914</span>, <span class="seriesInfo">DOI 10.17487/RFC7914</span>, <time datetime="2016-08">August 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7914">https://www.rfc-editor.org/info/rfc7914</a>&gt;</span>. </dd>
<dt id="RFC8017">[RFC8017]</dt>
<dd>
<span class="refAuthor">Moriarty, K., Ed.</span><span class="refAuthor">, Kaliski, B.</span><span class="refAuthor">, Jonsson, J.</span><span class="refAuthor">, and A. Rusch</span>, <span class="refTitle">"PKCS #1: RSA Cryptography Specifications Version 2.2"</span>, <span class="seriesInfo">RFC 8017</span>, <span class="seriesInfo">DOI 10.17487/RFC8017</span>, <time datetime="2016-11">November 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8017">https://www.rfc-editor.org/info/rfc8017</a>&gt;</span>. </dd>
<dt id="RFC8032">[RFC8032]</dt>
<dd>
<span class="refAuthor">Josefsson, S.</span><span class="refAuthor"> and I. Liusvaara</span>, <span class="refTitle">"Edwards-Curve Digital Signature Algorithm (EdDSA)"</span>, <span class="seriesInfo">RFC 8032</span>, <span class="seriesInfo">DOI 10.17487/RFC8032</span>, <time datetime="2017-01">January 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8032">https://www.rfc-editor.org/info/rfc8032</a>&gt;</span>. </dd>
</dl>
</section>
<section id="section-13.2">
        <h3 id="name-informative-references">
<a href="#section-13.2" class="section-number selfRef">13.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="AFQTZ14">[AFQTZ14]</dt>
<dd>
<span class="refAuthor">Aranha, D.F.</span><span class="refAuthor">, Fouque, P.A.</span><span class="refAuthor">, Qian, C.</span><span class="refAuthor">, Tibouchi, M.</span><span class="refAuthor">, and J.C. Zapalowicz</span>, <span class="refTitle">"Binary Elligator squared"</span>, <span class="seriesInfo">DOI 10.1007/978-3-319-13051-4_2</span>, <span class="seriesInfo">pages 20-37</span>, <span class="seriesInfo">In Selected Areas in Cryptography - SAC 2014</span>, <time datetime="2014">2014</time>, <span>&lt;<a href="https://doi.org/10.1007/978-3-319-13051-4_2">https://doi.org/10.1007/978-3-319-13051-4_2</a>&gt;</span>. </dd>
<dt id="AR13">[AR13]</dt>
<dd>
<span class="refAuthor">Adj, G.</span><span class="refAuthor"> and F. Rodriguez-Henriquez</span>, <span class="refTitle">"Square Root Computation over Even Extension Fields"</span>, <span class="seriesInfo">DOI 10.1109/TC.2013.145</span>, <span class="seriesInfo">pages 2829-2841</span>, <span class="seriesInfo">In IEEE Transactions on Computers. vol 63 issue 11</span>, <time datetime="2014-11">November 2014</time>, <span>&lt;<a href="https://doi.org/10.1109/TC.2013.145">https://doi.org/10.1109/TC.2013.145</a>&gt;</span>. </dd>
<dt id="BBJLP08">[BBJLP08]</dt>
<dd>
<span class="refAuthor">Bernstein, D.J.</span><span class="refAuthor">, Birkner, P.</span><span class="refAuthor">, Joye, M.</span><span class="refAuthor">, Lange, T.</span><span class="refAuthor">, and C. Peters</span>, <span class="refTitle">"Twisted Edwards curves"</span>, <span class="seriesInfo">DOI 10.1007/978-3-540-68164-9_26</span>, <span class="seriesInfo">pages 389-405</span>, <span class="seriesInfo">In AFRICACRYPT 2008</span>, <time datetime="2008">2008</time>, <span>&lt;<a href="https://doi.org/10.1007/978-3-540-68164-9_26">https://doi.org/10.1007/978-3-540-68164-9_26</a>&gt;</span>. </dd>
<dt id="BCIMRT10">[BCIMRT10]</dt>
<dd>
<span class="refAuthor">Brier, E.</span><span class="refAuthor">, Coron, J.S.</span><span class="refAuthor">, Icart, T.</span><span class="refAuthor">, Madore, D.</span><span class="refAuthor">, Randriam, H.</span><span class="refAuthor">, and M. Tibouchi</span>, <span class="refTitle">"Efficient Indifferentiable Hashing into Ordinary Elliptic Curves"</span>, <span class="seriesInfo">DOI 10.1007/978-3-642-14623-7_13</span>, <span class="seriesInfo">pages 237-254</span>, <span class="seriesInfo">In Advances in Cryptology - CRYPTO 2010</span>, <time datetime="2010">2010</time>, <span>&lt;<a href="https://doi.org/10.1007/978-3-642-14623-7_13">https://doi.org/10.1007/978-3-642-14623-7_13</a>&gt;</span>. </dd>
<dt id="BF01">[BF01]</dt>
<dd>
<span class="refAuthor">Boneh, D.</span><span class="refAuthor"> and M. Franklin</span>, <span class="refTitle">"Identity-based encryption from the Weil pairing"</span>, <span class="seriesInfo">DOI 10.1007/3-540-44647-8_13</span>, <span class="seriesInfo">pages 213-229</span>, <span class="seriesInfo">In Advances in Cryptology - CRYPTO 2001</span>, <time datetime="2001-08">August 2001</time>, <span>&lt;<a href="https://doi.org/10.1007/3-540-44647-8_13">https://doi.org/10.1007/3-540-44647-8_13</a>&gt;</span>. </dd>
<dt id="BHKL13">[BHKL13]</dt>
<dd>
<span class="refAuthor">Bernstein, D.J.</span><span class="refAuthor">, Hamburg, M.</span><span class="refAuthor">, Krasnova, A.</span><span class="refAuthor">, and T. Lange</span>, <span class="refTitle">"Elligator: elliptic-curve points indistinguishable from uniform random strings"</span>, <span class="seriesInfo">DOI 10.1145/2508859.2516734</span>, <span class="seriesInfo">pages 967-980</span>, <span class="seriesInfo">In Proceedings of the 2013 ACM SIGSAC conference on computer and communications security.</span>, <time datetime="2013-11">November 2013</time>, <span>&lt;<a href="https://doi.org/10.1145/2508859.2516734">https://doi.org/10.1145/2508859.2516734</a>&gt;</span>. </dd>
<dt id="BLAKE2X">[BLAKE2X]</dt>
<dd>
<span class="refAuthor">Aumasson, J-P.</span><span class="refAuthor">, Neves, S.</span><span class="refAuthor">, Wilcox-O'Hearn, Z.</span><span class="refAuthor">, and C. Winnerlein</span>, <span class="refTitle">"BLAKE2X"</span>, <time datetime="2016-12">December 2016</time>, <span>&lt;<a href="https://blake2.net/blake2x.pdf">https://blake2.net/blake2x.pdf</a>&gt;</span>. </dd>
<dt id="BLMP19">[BLMP19]</dt>
<dd>
<span class="refAuthor">Bernstein, D.J.</span><span class="refAuthor">, Lange, T.</span><span class="refAuthor">, Martindale, C.</span><span class="refAuthor">, and L. Panny</span>, <span class="refTitle">"Quantum circuits for the CSIDH: optimizing quantum evaluation of isogenies"</span>, <span class="seriesInfo">DOI 10.1007/978-3-030-17656-3</span>, <span class="seriesInfo">In Advances in Cryptology - EUROCRYPT 2019</span>, <time datetime="2019">2019</time>, <span>&lt;<a href="https://doi.org/10.1007/978-3-030-17656-3">https://doi.org/10.1007/978-3-030-17656-3</a>&gt;</span>. </dd>
<dt id="BLS01">[BLS01]</dt>
<dd>
<span class="refAuthor">Boneh, D.</span><span class="refAuthor">, Lynn, B.</span><span class="refAuthor">, and H. Shacham</span>, <span class="refTitle">"Short signatures from the Weil pairing"</span>, <span class="seriesInfo">DOI 10.1007/s00145-004-0314-9</span>, <span class="seriesInfo">pages 297-319</span>, <span class="seriesInfo">In Journal of Cryptology, vol 17</span>, <time datetime="2004-07">July 2004</time>, <span>&lt;<a href="https://doi.org/10.1007/s00145-004-0314-9">https://doi.org/10.1007/s00145-004-0314-9</a>&gt;</span>. </dd>
<dt id="BLS03">[BLS03]</dt>
<dd>
<span class="refAuthor">Barreto, P.</span><span class="refAuthor">, Lynn, B.</span><span class="refAuthor">, and M. Scott</span>, <span class="refTitle">"Constructing Elliptic Curves with Prescribed Embedding Degrees"</span>, <span class="seriesInfo">DOI 10.1007/3-540-36413-7_19</span>, <span class="seriesInfo">pages 257-267</span>, <span class="seriesInfo">In Security in Communication Networks</span>, <time datetime="2003">2003</time>, <span>&lt;<a href="https://doi.org/10.1007/3-540-36413-7_19">https://doi.org/10.1007/3-540-36413-7_19</a>&gt;</span>. </dd>
<dt id="BLS12-381">[BLS12-381]</dt>
<dd>
<span class="refAuthor">Bowe, S.</span>, <span class="refTitle">"BLS12-381: New zk-SNARK Elliptic Curve Construction"</span>, <time datetime="2017-03">March 2017</time>, <span>&lt;<a href="https://electriccoin.co/blog/new-snark-curve/">https://electriccoin.co/blog/new-snark-curve/</a>&gt;</span>. </dd>
<dt id="BMP00">[BMP00]</dt>
<dd>
<span class="refAuthor">Boyko, V.</span><span class="refAuthor">, MacKenzie, P.D.</span><span class="refAuthor">, and S. Patel</span>, <span class="refTitle">"Provably secure password-authenticated key exchange using Diffie-Hellman"</span>, <span class="seriesInfo">DOI 10.1007/3-540-45539-6_12</span>, <span class="seriesInfo">pages 156-171</span>, <span class="seriesInfo">In Advances in Cryptology - EUROCRYPT 2000</span>, <time datetime="2000-05">May 2000</time>, <span>&lt;<a href="https://doi.org/10.1007/3-540-45539-6_12">https://doi.org/10.1007/3-540-45539-6_12</a>&gt;</span>. </dd>
<dt id="BN05">[BN05]</dt>
<dd>
<span class="refAuthor">Barreto, P.</span><span class="refAuthor"> and M. Naehrig</span>, <span class="refTitle">"Pairing-Friendly Elliptic Curves of Prime Order"</span>, <span class="seriesInfo">DOI 10.1007/11693383_22</span>, <span class="seriesInfo">pages 319-331</span>, <span class="seriesInfo">In Selected Areas in Cryptography 2005</span>, <time datetime="2006">2006</time>, <span>&lt;<a href="https://doi.org/10.1007/11693383_22">https://doi.org/10.1007/11693383_22</a>&gt;</span>. </dd>
<dt id="BP18">[BP18]</dt>
<dd>
<span class="refAuthor">Budroni, A.</span><span class="refAuthor"> and F. Pintore</span>, <span class="refTitle">"Hashing to G2 on BLS pairing-friendly curves"</span>, <span class="seriesInfo">DOI 10.1145/3313880.3313884</span>, <span class="seriesInfo">pages 63-66</span>, <span class="seriesInfo">In ACM Communications in Computer Algebra</span>, <time datetime="2018-09">September 2018</time>, <span>&lt;<a href="https://doi.org/10.1145/3313880.3313884">https://doi.org/10.1145/3313880.3313884</a>&gt;</span>. </dd>
<dt id="C93">[C93]</dt>
<dd>
<span class="refAuthor">Cohen, H.</span>, <span class="refTitle">"A Course in Computational Algebraic Number Theory"</span>, <span class="seriesInfo">ISBN 9783642081422</span>, <span class="seriesInfo">publisher Springer-Verlag</span>, <time datetime="1993">1993</time>, <span>&lt;<a href="https://doi.org/10.1007/978-3-662-02945-9">https://doi.org/10.1007/978-3-662-02945-9</a>&gt;</span>. </dd>
<dt id="CFADLNV05">[CFADLNV05]</dt>
<dd>
<span class="refAuthor">Cohen, H.</span><span class="refAuthor">, Frey, G.</span><span class="refAuthor">, Avanzi, R.</span><span class="refAuthor">, Doche, C.</span><span class="refAuthor">, Lange, T.</span><span class="refAuthor">, Nguyen, K.</span><span class="refAuthor">, and F. Vercauteren</span>, <span class="refTitle">"Handbook of Elliptic and Hyperelliptic Curve Cryptography"</span>, <span class="seriesInfo">ISBN 9781584885184</span>, <span class="seriesInfo">publisher Chapman and Hall / CRC</span>, <time datetime="2005">2005</time>, <span>&lt;<a href="https://www.crcpress.com/9781584885184">https://www.crcpress.com/9781584885184</a>&gt;</span>. </dd>
<dt id="CK11">[CK11]</dt>
<dd>
<span class="refAuthor">Couveignes, J.</span><span class="refAuthor"> and J. Kammerer</span>, <span class="refTitle">"The geometry of flex tangents to a cubic curve and its parameterizations"</span>, <span class="seriesInfo">DOI 10.1016/j.jsc.2011.11.003</span>, <span class="seriesInfo">pages 266-281</span>, <span class="seriesInfo">In Journal of Symbolic Computation, vol 47 issue 3</span>, <time datetime="2012">2012</time>, <span>&lt;<a href="https://doi.org/10.1016/j.jsc.2011.11.003">https://doi.org/10.1016/j.jsc.2011.11.003</a>&gt;</span>. </dd>
<dt id="DRST12">[DRST12]</dt>
<dd>
<span class="refAuthor">Dodis, Y.</span><span class="refAuthor">, Ristenpart, T.</span><span class="refAuthor">, Steinberger, J.</span><span class="refAuthor">, and S. Tessaro</span>, <span class="refTitle">"To hash or not to hash again? (In)differentiability results for H^2 and HMAC"</span>, <span class="seriesInfo">DOI 10.1007/978-3-642-32009-5_21</span>, <span class="seriesInfo">pages 348-366</span>, <span class="seriesInfo">In Advances in Cryptology - CRYPTO 2012</span>, <time datetime="2012-08">August 2012</time>, <span>&lt;<a href="https://doi.org/10.1007/978-3-642-32009-5_21">https://doi.org/10.1007/978-3-642-32009-5_21</a>&gt;</span>. </dd>
<dt id="F11">[F11]</dt>
<dd>
<span class="refAuthor">Farashahi, R.R.</span>, <span class="refTitle">"Hashing into Hessian curves"</span>, <span class="seriesInfo">DOI 10.1007/978-3-642-21969-6_17</span>, <span class="seriesInfo">pages 278-289</span>, <span class="seriesInfo">In AFRICACRYPT 2011</span>, <time datetime="2011">2011</time>, <span>&lt;<a href="https://doi.org/10.1007/978-3-642-21969-6_17">https://doi.org/10.1007/978-3-642-21969-6_17</a>&gt;</span>. </dd>
<dt id="FFSTV13">[FFSTV13]</dt>
<dd>
<span class="refAuthor">Farashahi, R.R.</span><span class="refAuthor">, Fouque, P.A.</span><span class="refAuthor">, Shparlinski, I.E.</span><span class="refAuthor">, Tibouch, M.</span><span class="refAuthor">, and J.F. Voloch</span>, <span class="refTitle">"Indifferentiable deterministic hashing to elliptic and hyperelliptic curves"</span>, <span class="seriesInfo">DOI 10.1090/S0025-5718-2012-02606-8</span>, <span class="seriesInfo">pages 491-512</span>, <span class="seriesInfo">In Math. Comp. vol 82</span>, <time datetime="2013">2013</time>, <span>&lt;<a href="https://doi.org/10.1090/S0025-5718-2012-02606-8">https://doi.org/10.1090/S0025-5718-2012-02606-8</a>&gt;</span>. </dd>
<dt id="FIPS180-4">[FIPS180-4]</dt>
<dd>
<span class="refAuthor">National Institute of Standards and Technology (NIST)</span>, <span class="refTitle">"Secure Hash Standard (SHS)"</span>, <time datetime="2015-08">August 2015</time>, <span>&lt;<a href="https://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.180-4.pdf">https://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.180-4.pdf</a>&gt;</span>. </dd>
<dt id="FIPS186-4">[FIPS186-4]</dt>
<dd>
<span class="refAuthor">National Institute of Standards and Technology (NIST)</span>, <span class="refTitle">"FIPS Publication 186-4: Digital Signature Standard"</span>, <time datetime="2013-07">July 2013</time>, <span>&lt;<a href="https://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.186-4.pdf">https://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.186-4.pdf</a>&gt;</span>. </dd>
<dt id="FIPS202">[FIPS202]</dt>
<dd>
<span class="refAuthor">National Institute of Standards and Technology (NIST)</span>, <span class="refTitle">"SHA-3 Standard: Permutation-Based Hash and Extendable-Output Functions"</span>, <time datetime="2015-08">August 2015</time>, <span>&lt;<a href="https://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.202.pdf">https://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.202.pdf</a>&gt;</span>. </dd>
<dt id="FJT13">[FJT13]</dt>
<dd>
<span class="refAuthor">Fouque, P.</span><span class="refAuthor">, Joux, A.</span><span class="refAuthor">, and M. Tibouchi</span>, <span class="refTitle">"Injective encodings to elliptic curves"</span>, <span class="seriesInfo">DOI 10.1007/978-3-642-39059-3_14</span>, <span class="seriesInfo">pages 203-218</span>, <span class="seriesInfo">In ACISP 2013</span>, <time datetime="2013">2013</time>, <span>&lt;<a href="https://doi.org/10.1007/978-3-642-39059-3_14">https://doi.org/10.1007/978-3-642-39059-3_14</a>&gt;</span>. </dd>
<dt id="FKR11">[FKR11]</dt>
<dd>
<span class="refAuthor">Fuentes-Castaneda, L.</span><span class="refAuthor">, Knapp, E.</span><span class="refAuthor">, and F. Rodriguez-Henriquez</span>, <span class="refTitle">"Fast Hashing to G2 on Pairing-Friendly Curves"</span>, <span class="seriesInfo">DOI 10.1007/978-3-642-28496-0_25</span>, <span class="seriesInfo">pages 412-430</span>, <span class="seriesInfo">In Selected Areas in Cryptography</span>, <time datetime="2011">2011</time>, <span>&lt;<a href="https://doi.org/10.1007/978-3-642-28496-0_25">https://doi.org/10.1007/978-3-642-28496-0_25</a>&gt;</span>. </dd>
<dt id="FSV09">[FSV09]</dt>
<dd>
<span class="refAuthor">Farashahi, R.R.</span><span class="refAuthor">, Shparlinski, I.E.</span><span class="refAuthor">, and J.F. Voloch</span>, <span class="refTitle">"On hashing into elliptic curves"</span>, <span class="seriesInfo">DOI 10.1515/JMC.2009.022</span>, <span class="seriesInfo">pages 353-360</span>, <span class="seriesInfo">In Journal of Mathematical Cryptology, vol 3 no 4</span>, <time datetime="2009">2009</time>, <span>&lt;<a href="https://doi.org/10.1515/JMC.2009.022">https://doi.org/10.1515/JMC.2009.022</a>&gt;</span>. </dd>
<dt id="FT10">[FT10]</dt>
<dd>
<span class="refAuthor">Fouque, P.</span><span class="refAuthor"> and M. Tibouchi</span>, <span class="refTitle">"Estimating the size of the image of deterministic hash functions to elliptic curves."</span>, <span class="seriesInfo">DOI 10.1007/978-3-642-14712-8_5</span>, <span class="seriesInfo">pages 81-91</span>, <span class="seriesInfo">In Progress in Cryptology - LATINCRYPT 2010</span>, <time datetime="2010">2010</time>, <span>&lt;<a href="https://doi.org/10.1007/978-3-642-14712-8_5">https://doi.org/10.1007/978-3-642-14712-8_5</a>&gt;</span>. </dd>
<dt id="FT12">[FT12]</dt>
<dd>
<span class="refAuthor">Fouque, P.</span><span class="refAuthor"> and M. Tibouchi</span>, <span class="refTitle">"Indifferentiable Hashing to Barreto-Naehrig Curves"</span>, <span class="seriesInfo">DOI 10.1007/978-3-642-33481-8_1</span>, <span class="seriesInfo">pages 1-7</span>, <span class="seriesInfo">In Progress in Cryptology - LATINCRYPT 2012</span>, <time datetime="2012">2012</time>, <span>&lt;<a href="https://doi.org/10.1007/978-3-642-33481-8_1">https://doi.org/10.1007/978-3-642-33481-8_1</a>&gt;</span>. </dd>
<dt id="hash2curve-repo">[hash2curve-repo]</dt>
<dd>
<span class="refTitle">"Hashing to Elliptic Curves - GitHub repository"</span>, <time datetime="2019">2019</time>, <span>&lt;<a href="https://github.com/cfrg/draft-irtf-cfrg-hash-to-curve">https://github.com/cfrg/draft-irtf-cfrg-hash-to-curve</a>&gt;</span>. </dd>
<dt id="Icart09">[Icart09]</dt>
<dd>
<span class="refAuthor">Icart, T.</span>, <span class="refTitle">"How to Hash into Elliptic Curves"</span>, <span class="seriesInfo">DOI 10.1007/978-3-642-03356-8_18</span>, <span class="seriesInfo">pages 303-316</span>, <span class="seriesInfo">In Advances in Cryptology - CRYPTO 2009</span>, <time datetime="2009">2009</time>, <span>&lt;<a href="https://doi.org/10.1007/978-3-642-03356-8_18">https://doi.org/10.1007/978-3-642-03356-8_18</a>&gt;</span>. </dd>
<dt id="J96">[J96]</dt>
<dd>
<span class="refAuthor">Jablon, D.P.</span>, <span class="refTitle">"Strong password-only authenticated key exchange"</span>, <span class="seriesInfo">DOI 10.1145/242896.242897</span>, <span class="seriesInfo">pages 5-26</span>, <span class="seriesInfo">In SIGCOMM Computer Communication Review, vol 26 issue 5</span>, <time datetime="1996">1996</time>, <span>&lt;<a href="https://doi.org/10.1145/242896.242897">https://doi.org/10.1145/242896.242897</a>&gt;</span>. </dd>
<dt id="jubjub-fq">[jubjub-fq]</dt>
<dd>
<span class="refTitle">"zkcrypto/jubjub - fq.rs"</span>, <time datetime="2019">2019</time>, <span>&lt;<a href="https://github.com/zkcrypto/jubjub/blob/master/src/fq.rs">https://github.com/zkcrypto/jubjub/blob/master/src/fq.rs</a>&gt;</span>. </dd>
<dt id="KLR10">[KLR10]</dt>
<dd>
<span class="refAuthor">Kammerer, J.</span><span class="refAuthor">, Lercier, R.</span><span class="refAuthor">, and G. Renault</span>, <span class="refTitle">"Encoding points on hyperelliptic curves over finite fields in deterministic polynomial time"</span>, <span class="seriesInfo">DOI 10.1007/978-3-642-17455-1_18</span>, <span class="seriesInfo">pages 278-297</span>, <span class="seriesInfo">In PAIRING 2010</span>, <time datetime="2010">2010</time>, <span>&lt;<a href="https://doi.org/10.1007/978-3-642-17455-1_18">https://doi.org/10.1007/978-3-642-17455-1_18</a>&gt;</span>. </dd>
<dt id="L13">[L13]</dt>
<dd>
<span class="refAuthor">Langley, A.</span>, <span class="refTitle">"Implementing Elligator for Curve25519"</span>, <time datetime="2013">2013</time>, <span>&lt;<a href="https://www.imperialviolet.org/2013/12/25/elligator.html">https://www.imperialviolet.org/2013/12/25/elligator.html</a>&gt;</span>. </dd>
<dt id="LBB19">[LBB19]</dt>
<dd>
<span class="refAuthor">Lipp, B.</span><span class="refAuthor">, Blanchet, B.</span><span class="refAuthor">, and K. Bhargavan</span>, <span class="refTitle">"A Mechanised Proof of the WireGuard Virtual Private Network Protocol"</span>, <span class="seriesInfo">In INRIA Research Report No. 9269</span>, <time datetime="2019-04">April 2019</time>, <span>&lt;<a href="https://hal.inria.fr/hal-02100345/">https://hal.inria.fr/hal-02100345/</a>&gt;</span>. </dd>
<dt id="MRH04">[MRH04]</dt>
<dd>
<span class="refAuthor">Maurer, U.</span><span class="refAuthor">, Renner, R.</span><span class="refAuthor">, and C. Holenstein</span>, <span class="refTitle">"Indifferentiability, impossibility results on reductions, and applications to the random oracle methodology"</span>, <span class="seriesInfo">DOI 10.1007/978-3-540-24638-1_2</span>, <span class="seriesInfo">pages 21-39</span>, <span class="seriesInfo">In TCC 2004: Theory of Cryptography</span>, <time datetime="2004-02">February 2004</time>, <span>&lt;<a href="https://doi.org/10.1007/978-3-540-24638-1_2">https://doi.org/10.1007/978-3-540-24638-1_2</a>&gt;</span>. </dd>
<dt id="p1363a">[p1363a]</dt>
<dd>
<span class="refAuthor">IEEE Computer Society</span>, <span class="refTitle">"IEEE Standard Specifications for Public-Key Cryptography---Amendment 1: Additional Techniques"</span>, <time datetime="2004-03">March 2004</time>, <span>&lt;<a href="https://standards.ieee.org/standard/1363a-2004.html">https://standards.ieee.org/standard/1363a-2004.html</a>&gt;</span>. </dd>
<dt id="RFC7693">[RFC7693]</dt>
<dd>
<span class="refAuthor">Saarinen, M-J., Ed.</span><span class="refAuthor"> and J-P. Aumasson</span>, <span class="refTitle">"The BLAKE2 Cryptographic Hash and Message Authentication Code (MAC)"</span>, <span class="seriesInfo">RFC 7693</span>, <span class="seriesInfo">DOI 10.17487/RFC7693</span>, <time datetime="2015-11">November 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7693">https://www.rfc-editor.org/info/rfc7693</a>&gt;</span>. </dd>
<dt id="RSS11">[RSS11]</dt>
<dd>
<span class="refAuthor">Ristenpart, T.</span><span class="refAuthor">, Shacham, H.</span><span class="refAuthor">, and T. Shrimpton</span>, <span class="refTitle">"Careful with Composition: Limitations of the Indifferentiability Framework"</span>, <span class="seriesInfo">DOI 10.1007/978-3-642-20465-4_27</span>, <span class="seriesInfo">pages 487-506</span>, <span class="seriesInfo">In Advances in Cryptology - EUROCRYPT 2011</span>, <time datetime="2011-05">May 2011</time>, <span>&lt;<a href="https://doi.org/10.1007/978-3-642-20465-4_27">https://doi.org/10.1007/978-3-642-20465-4_27</a>&gt;</span>. </dd>
<dt id="S05">[S05]</dt>
<dd>
<span class="refAuthor">Skalba, M.</span>, <span class="refTitle">"Points on elliptic curves over finite fields"</span>, <span class="seriesInfo">DOI 10.4064/aa117-3-7</span>, <span class="seriesInfo">pages 293-301</span>, <span class="seriesInfo">In Acta Arithmetica, vol 117 no 3</span>, <time datetime="2005">2005</time>, <span>&lt;<a href="https://doi.org/10.4064/aa117-3-7">https://doi.org/10.4064/aa117-3-7</a>&gt;</span>. </dd>
<dt id="S85">[S85]</dt>
<dd>
<span class="refAuthor">Schoof, R.</span>, <span class="refTitle">"Elliptic Curves Over Finite Fields and the Computation of Square Roots mod p"</span>, <span class="seriesInfo">DOI 10.1090/S0025-5718-1985-0777280-6</span>, <span class="seriesInfo">pages 483-494</span>, <span class="seriesInfo">In Mathematics of Computation vol 44 issue 170</span>, <time datetime="1985-04">April 1985</time>, <span>&lt;<a href="https://doi.org/10.1090/S0025-5718-1985-0777280-6">https://doi.org/10.1090/S0025-5718-1985-0777280-6</a>&gt;</span>. </dd>
<dt id="SAGE">[SAGE]</dt>
<dd>
<span class="refAuthor">The Sage Developers</span>, <span class="refTitle">"SageMath, the Sage Mathematics Software System"</span>, <time datetime="2019">2019</time>, <span>&lt;<a href="https://www.sagemath.org">https://www.sagemath.org</a>&gt;</span>. </dd>
<dt id="SBCDK09">[SBCDK09]</dt>
<dd>
<span class="refAuthor">Scott, M.</span><span class="refAuthor">, Benger, N.</span><span class="refAuthor">, Charlemagne, M.</span><span class="refAuthor">, Dominguez Perez, L.J.</span><span class="refAuthor">, and E.J. Kachisa</span>, <span class="refTitle">"Fast Hashing to G2 on Pairing-Friendly Curves"</span>, <span class="seriesInfo">DOI 10.1007/978-3-642-03298-1_8</span>, <span class="seriesInfo">pages 102-113</span>, <span class="seriesInfo">In Pairing-Based Cryptography - Pairing 2009</span>, <time datetime="2009">2009</time>, <span>&lt;<a href="https://doi.org/10.1007/978-3-642-03298-1_8">https://doi.org/10.1007/978-3-642-03298-1_8</a>&gt;</span>. </dd>
<dt id="SEC1">[SEC1]</dt>
<dd>
<span class="refAuthor">Standards for Efficient Cryptography Group (SECG)</span>, <span class="refTitle">"SEC 1: Elliptic Curve Cryptography"</span>, <time datetime="2009-05">May 2009</time>, <span>&lt;<a href="http://www.secg.org/sec1-v2.pdf">http://www.secg.org/sec1-v2.pdf</a>&gt;</span>. </dd>
<dt id="SEC2">[SEC2]</dt>
<dd>
<span class="refAuthor">Standards for Efficient Cryptography Group (SECG)</span>, <span class="refTitle">"SEC 2: Recommended Elliptic Curve Domain Parameters"</span>, <time datetime="2010-01">January 2010</time>, <span>&lt;<a href="http://www.secg.org/sec2-v2.pdf">http://www.secg.org/sec2-v2.pdf</a>&gt;</span>. </dd>
<dt id="SP.800-185">[SP.800-185]</dt>
<dd>
<span class="refAuthor">Kelsey, J.</span><span class="refAuthor">, Chang, S.</span><span class="refAuthor">, and R. Perlner</span>, <span class="refTitle">"SHA-3 Derived Functions: cSHAKE, KMAC, TupleHash and ParallelHash"</span>, <time datetime="2016-12">December 2016</time>, <span>&lt;<a href="https://doi.org/10.6028/NIST.SP.800-185">https://doi.org/10.6028/NIST.SP.800-185</a>&gt;</span>. </dd>
<dt id="SS04">[SS04]</dt>
<dd>
<span class="refAuthor">Schinzel, A.</span><span class="refAuthor"> and M. Skalba</span>, <span class="refTitle">"On equations y^2 = x^n + k in a finite field."</span>, <span class="seriesInfo">DOI 10.4064/ba52-3-1</span>, <span class="seriesInfo">pages 223-226</span>, <span class="seriesInfo">In Bulletin Polish Acad. Sci. Math. vol 52, no 3</span>, <time datetime="2004">2004</time>, <span>&lt;<a href="https://doi.org/10.4064/ba52-3-1">https://doi.org/10.4064/ba52-3-1</a>&gt;</span>. </dd>
<dt id="SW06">[SW06]</dt>
<dd>
<span class="refAuthor">Shallue, A.</span><span class="refAuthor"> and C. van de Woestijne</span>, <span class="refTitle">"Construction of rational points on elliptic curves over finite fields"</span>, <span class="seriesInfo">DOI 10.1007/11792086_36</span>, <span class="seriesInfo">pages 510-524</span>, <span class="seriesInfo">In Algorithmic Number Theory. ANTS 2006.</span>, <time datetime="2006">2006</time>, <span>&lt;<a href="https://doi.org/10.1007/11792086_36">https://doi.org/10.1007/11792086_36</a>&gt;</span>. </dd>
<dt id="T14">[T14]</dt>
<dd>
<span class="refAuthor">Tibouchi, M.</span>, <span class="refTitle">"Elligator squared: Uniform points on elliptic curves of prime order as uniform random strings"</span>, <span class="seriesInfo">DOI 10.1007/978-3-662-45472-5_10</span>, <span class="seriesInfo">pages 139-156</span>, <span class="seriesInfo">In Financial Cryptography and Data Security - FC 2014</span>, <time datetime="2014">2014</time>, <span>&lt;<a href="https://doi.org/10.1007/978-3-662-45472-5_10">https://doi.org/10.1007/978-3-662-45472-5_10</a>&gt;</span>. </dd>
<dt id="TK17">[TK17]</dt>
<dd>
<span class="refAuthor">Tibouchi, M.</span><span class="refAuthor"> and T. Kim</span>, <span class="refTitle">"Improved elliptic curve hashing and point representation"</span>, <span class="seriesInfo">DOI 10.1007/s10623-016-0288-2</span>, <span class="seriesInfo">pages 161-177</span>, <span class="seriesInfo">In Designs, Codes, and Cryptography, vol 82</span>, <time datetime="2017">2017</time>, <span>&lt;<a href="https://doi.org/10.1007/s10623-016-0288-2">https://doi.org/10.1007/s10623-016-0288-2</a>&gt;</span>. </dd>
<dt id="U07">[U07]</dt>
<dd>
<span class="refAuthor">Ulas, M.</span>, <span class="refTitle">"Rational points on certain hyperelliptic curves over finite fields"</span>, <span class="seriesInfo">DOI 10.4064/ba55-2-1</span>, <span class="seriesInfo">pages 97-104</span>, <span class="seriesInfo">In Bulletin Polish Acad. Sci. Math. vol 55, no 2</span>, <time datetime="2007">2007</time>, <span>&lt;<a href="https://doi.org/10.4064/ba55-2-1">https://doi.org/10.4064/ba55-2-1</a>&gt;</span>. </dd>
<dt id="W08">[W08]</dt>
<dd>
<span class="refAuthor">Washington, L.C.</span>, <span class="refTitle">"Elliptic curves: Number theory and cryptography"</span>, <span class="seriesInfo">ISBN 9781420071467</span>, <span class="seriesInfo">publisher Chapman and Hall / CRC</span>, <span class="seriesInfo">edition 2nd</span>, <time datetime="2008">2008</time>, <span>&lt;<a href="https://www.crcpress.com/9781420071467">https://www.crcpress.com/9781420071467</a>&gt;</span>. </dd>
<dt id="W19">[W19]</dt>
<dd>
<span class="refAuthor">Wahby, R.S.</span>, <span class="refTitle">"An explicit, generic parameterization for the Shallue--van de Woestijne map"</span>, <time datetime="2019">2019</time>, <span>&lt;<a href="https://github.com/cfrg/draft-irtf-cfrg-hash-to-curve/doc/svdw_params.pdf">https://github.com/cfrg/draft-irtf-cfrg-hash-to-curve/doc/svdw_params.pdf</a>&gt;</span>. </dd>
<dt id="WB19">[WB19]</dt>
<dd>
<span class="refAuthor">Wahby, R.S.</span><span class="refAuthor"> and D. Boneh</span>, <span class="refTitle">"Fast and simple constant-time hashing to the BLS12-381 elliptic curve"</span>, <span class="seriesInfo">DOI 10.13154/tches.v2019.i4.154-179</span>, <span class="seriesInfo">ePrint 2019/403</span>, <span class="seriesInfo">issue 4</span>, <span class="seriesInfo">volume 2019</span>, <span class="seriesInfo">In IACR Trans. CHES</span>, <time datetime="2019-08">August 2019</time>, <span>&lt;<a href="https://eprint.iacr.org/2019/403">https://eprint.iacr.org/2019/403</a>&gt;</span>. </dd>
<dt id="x9.62">[x9.62]</dt>
<dd>
<span class="refAuthor">ANSI</span>, <span class="refTitle">"Public Key Cryptography for the Financial Services Industry: the Elliptic Curve Digital Signature Algorithm (ECDSA)"</span>, <span class="seriesInfo">ANSI X9.62-1998</span>, <time datetime="1998-09">September 1998</time>. </dd>
</dl>
</section>
</section>
<div id="related">
<section id="section-appendix.a">
      <h2 id="name-related-work">
<a href="#section-appendix.a" class="section-number selfRef">Appendix A. </a><a href="#name-related-work" class="section-name selfRef">Related Work</a>
      </h2>
<p id="section-appendix.a-1">The problem of mapping arbitrary bit strings to elliptic curve points
has been the subject of both practical and theoretical research.
This section briefly describes the background and research results
that underly the recommendations in this document.
This section is provided for informational purposes only.<a href="#section-appendix.a-1" class="pilcrow">¶</a></p>
<p id="section-appendix.a-2">A naive but generally insecure method of mapping a string alpha to
a point on an elliptic curve E having n points is to first fix a point P that
generates the elliptic curve group, and a hash function Hn from bit strings
to integers less than n; then compute Hn(alpha) * P, where the * operator
represents scalar multiplication. The reason this approach is insecure is
that the resulting point has a known discrete log relationship to P.
Thus, except in cases where this method is specified by the protocol,
it must not be used; doing so risks catastrophic security failures.<a href="#section-appendix.a-2" class="pilcrow">¶</a></p>
<p id="section-appendix.a-3">Boneh et al. <span>[<a href="#BLS01" class="xref">BLS01</a>]</span> describe an encoding method they call MapToGroup,
which works roughly as follows: first, use the input string to initialize a
pseudorandom number generator, then use the generator to produce a pseudorandom
value x in F.
If x is the x-coordinate of a point on the elliptic curve, output that
point. Otherwise, generate a new pseudorandom value x in F and try again.
Since a random value x in F has probability about 1/2 of corresponding to
a point on the curve, the expected number of tries is just two.
However, the running time of this method depends on the input string,
which means that it is not safe to use in protocols sensitive to timing
side channels.<a href="#section-appendix.a-3" class="pilcrow">¶</a></p>
<p id="section-appendix.a-4">Schinzel and Skalba <span>[<a href="#SS04" class="xref">SS04</a>]</span> introduce a method of constructing
elliptic curve points deterministically, for a restricted class of curves
and a very small number of points.
Skalba <span>[<a href="#S05" class="xref">S05</a>]</span> generalizes this construction to more curves and more points
on those curves.
Shallue and van de Woestijne <span>[<a href="#SW06" class="xref">SW06</a>]</span> further generalize and simplify
Skalba's construction, yielding concretely efficient maps to a constant
fraction of the points on almost any curve.
Fouque and Tibouchi <span>[<a href="#FT12" class="xref">FT12</a>]</span> give a parameterization of this mapping
for Barreto-Naehrig pairing-friendly curves <span>[<a href="#BN05" class="xref">BN05</a>]</span>.<a href="#section-appendix.a-4" class="pilcrow">¶</a></p>
<p id="section-appendix.a-5">Ulas <span>[<a href="#U07" class="xref">U07</a>]</span> describes a simpler version of the Shallue-van de Woestijne map,
and Brier et al. <span>[<a href="#BCIMRT10" class="xref">BCIMRT10</a>]</span> give a further simplification, which the authors
call the "simplified SWU" map.
That simplified map applies only to fields of characteristic p = 3 (mod 4);
Wahby and Boneh <span>[<a href="#WB19" class="xref">WB19</a>]</span> generalize to fields of any characteristic, and
give further optimizations.<a href="#section-appendix.a-5" class="pilcrow">¶</a></p>
<p id="section-appendix.a-6">Boneh and Franklin give a deterministic algorithm mapping to certain
supersingular curves over fields of characteristic p = 2 (mod 3) <span>[<a href="#BF01" class="xref">BF01</a>]</span>.
Icart gives another deterministic algorithm which maps to any curve
over a field of characteristic p = 2 (mod 3) <span>[<a href="#Icart09" class="xref">Icart09</a>]</span>.
Several extensions and generalizations follow this work, including
<span>[<a href="#FSV09" class="xref">FSV09</a>]</span>, <span>[<a href="#FT10" class="xref">FT10</a>]</span>, <span>[<a href="#KLR10" class="xref">KLR10</a>]</span>, <span>[<a href="#F11" class="xref">F11</a>]</span>, and <span>[<a href="#CK11" class="xref">CK11</a>]</span>.<a href="#section-appendix.a-6" class="pilcrow">¶</a></p>
<p id="section-appendix.a-7">Following the work of Farashahi <span>[<a href="#F11" class="xref">F11</a>]</span>, Fouque et al. <span>[<a href="#FJT13" class="xref">FJT13</a>]</span> describe a
mapping to curves over fields of characteristic p = 3 (mod 4) having a number of points
divisible by 4.  Bernstein et al. <span>[<a href="#BHKL13" class="xref">BHKL13</a>]</span> optimize this mapping and
describe a related mapping that they call "Elligator 2," which applies to
any curve over a field of odd characteristic having a point of order 2.
This includes Curve25519 and Curve448, both of which are CFRG-recommended
curves <span>[<a href="#RFC7748" class="xref">RFC7748</a>]</span>. Bernstein et al. <span>[<a href="#BLMP19" class="xref">BLMP19</a>]</span> extend the Elligator 2 map
to a class of supersingular curves over fields of characteristic p = 3 (mod 4).<a href="#section-appendix.a-7" class="pilcrow">¶</a></p>
<p id="section-appendix.a-8">An important caveat regarding all of the above deterministic mapping
functions is that none of them map to the entire curve, but rather to some
fraction of the points. This means that they cannot be used directly to
construct a random oracle that outputs points on the curve.<a href="#section-appendix.a-8" class="pilcrow">¶</a></p>
<p id="section-appendix.a-9">Brier et al. <span>[<a href="#BCIMRT10" class="xref">BCIMRT10</a>]</span> give two solutions to this problem.
The first, which Brier et al. prove applies to Icart's method,
computes f(H0(msg)) + f(H1(msg)) for two distinct hash functions
H0 and H1 from bit strings to F and a mapping f from F to the elliptic curve E.
The second, which applies to essentially all deterministic mappings but
is more costly, computes f(H0(msg)) + H2(msg) * P, for P a generator of the
elliptic curve group and H2 a hash from bit strings to integers modulo r,
the order of the elliptic curve group.
Farashahi et al. <span>[<a href="#FFSTV13" class="xref">FFSTV13</a>]</span> improve the analysis of the first method,
showing that it applies to essentially all deterministic mappings.
Tibouchi and Kim <span>[<a href="#TK17" class="xref">TK17</a>]</span> further refine the analysis and describe additional
optimizations.<a href="#section-appendix.a-9" class="pilcrow">¶</a></p>
<p id="section-appendix.a-10">Complementary to the problem of mapping from bit strings to elliptic curve
points, Bernstein et al. <span>[<a href="#BHKL13" class="xref">BHKL13</a>]</span> study the problem of mapping from elliptic
curve points to uniformly random bit strings, giving solutions for a class of
curves including Montgomery and twisted Edwards curves.
Tibouchi <span>[<a href="#T14" class="xref">T14</a>]</span> and Aranha et al. <span>[<a href="#AFQTZ14" class="xref">AFQTZ14</a>]</span> generalize these results.
This document does not deal with this complementary problem.<a href="#section-appendix.a-10" class="pilcrow">¶</a></p>
</section>
</div>
<div id="appx-rational-map">
<section id="section-appendix.b">
      <h2 id="name-rational-maps">
<a href="#section-appendix.b" class="section-number selfRef">Appendix B. </a><a href="#name-rational-maps" class="section-name selfRef">Rational maps</a>
      </h2>
<p id="section-appendix.b-1">This section gives several useful rational maps.<a href="#section-appendix.b-1" class="pilcrow">¶</a></p>
<div id="appx-rational-map-edw">
<section id="section-b.1">
        <h2 id="name-twisted-edwards-to-weierstr">
<a href="#section-b.1" class="section-number selfRef">B.1. </a><a href="#name-twisted-edwards-to-weierstr" class="section-name selfRef">Twisted Edwards to Weierstrass and Montgomery curves</a>
        </h2>
<p id="section-b.1-1">The inverse of the rational map specified in <a href="#rational-map" class="xref">Section 6.8.1</a>, i.e.,
the map from the point (v, w) on the twisted Edwards curve<a href="#section-b.1-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1-2">
<pre>
    a * v^2 + w^2 = 1 + d * v^2 * w^2
</pre><a href="#section-b.1-2" class="pilcrow">¶</a>
</div>
<p id="section-b.1-3">to the point (X, Y) on the Weierstrass curve<a href="#section-b.1-3" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1-4">
<pre>
    Y^2 = X^3 + C * X^2 + D * X
</pre><a href="#section-b.1-4" class="pilcrow">¶</a>
</div>
<p id="section-b.1-5">is given by:<a href="#section-b.1-5" class="pilcrow">¶</a></p>
<ul>
<li id="section-b.1-6.1">C = (a + d) / 2<a href="#section-b.1-6.1" class="pilcrow">¶</a>
</li>
<li id="section-b.1-6.2">D = (a - d)^2 / 16<a href="#section-b.1-6.2" class="pilcrow">¶</a>
</li>
<li id="section-b.1-6.3">invSqrtD = 4 / (a - d)<a href="#section-b.1-6.3" class="pilcrow">¶</a>
</li>
<li id="section-b.1-6.4">X = (1 + w) / (invSqrtD * (1 - w))<a href="#section-b.1-6.4" class="pilcrow">¶</a>
</li>
<li id="section-b.1-6.5">Y = (1 + w) / (invSqrtD * v * (1 - w))<a href="#section-b.1-6.5" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-b.1-7">This map is undefined when v == 0 or w == 1.
If (v, w) = (0, -1), return the point (X, Y) = (0, 0).
Otherwise, return the identity point on the Weierstrass curve.
(This follows from <span>[<a href="#BBJLP08" class="xref">BBJLP08</a>]</span>, Section 3.)<a href="#section-b.1-7" class="pilcrow">¶</a></p>
<p id="section-b.1-8">It may also be useful to map to a Montgomery curve
of the form<a href="#section-b.1-8" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.1-9">
<pre>
    K * t^2 = s^3 + J * s^2 + s
</pre><a href="#section-b.1-9" class="pilcrow">¶</a>
</div>
<p id="section-b.1-10">This curve is equivalent to the twisted Edwards curve above via the
following rational map (<span>[<a href="#BBJLP08" class="xref">BBJLP08</a>]</span>, Theorem 3.2):<a href="#section-b.1-10" class="pilcrow">¶</a></p>
<ul>
<li id="section-b.1-11.1">J = 2 * (a + d) / (a - d)<a href="#section-b.1-11.1" class="pilcrow">¶</a>
</li>
<li id="section-b.1-11.2">K = 4 / (a - d)<a href="#section-b.1-11.2" class="pilcrow">¶</a>
</li>
<li id="section-b.1-11.3">s = (1 + w) / (1 - w)<a href="#section-b.1-11.3" class="pilcrow">¶</a>
</li>
<li id="section-b.1-11.4">t = (1 + w) / (v * (1 - w))<a href="#section-b.1-11.4" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-b.1-12">whose inverse is given by:<a href="#section-b.1-12" class="pilcrow">¶</a></p>
<ul>
<li id="section-b.1-13.1">a = (J + 2) / K<a href="#section-b.1-13.1" class="pilcrow">¶</a>
</li>
<li id="section-b.1-13.2">d = (J - 2) / K<a href="#section-b.1-13.2" class="pilcrow">¶</a>
</li>
<li id="section-b.1-13.3">v = s / t<a href="#section-b.1-13.3" class="pilcrow">¶</a>
</li>
<li id="section-b.1-13.4">w = (s - 1) / (s + 1)<a href="#section-b.1-13.4" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-b.1-14">Composing the mapping immediately above with the mapping from
Montgomery to Weierstrass curves in <a href="#appx-rational-map-mont" class="xref">Appendix B.2</a>
yields a mapping from twisted Edwards curves to Weierstrass curves
of the form required by the mappings in <a href="#weierstrass" class="xref">Section 6.6</a>.
This mapping can be used to apply the Shallue-van de Woestijne method
(<a href="#svdw" class="xref">Section 6.6.1</a>) to twisted Edwards curves.<a href="#section-b.1-14" class="pilcrow">¶</a></p>
</section>
</div>
<div id="appx-rational-map-mont">
<section id="section-b.2">
        <h2 id="name-montgomery-to-weierstrass-c">
<a href="#section-b.2" class="section-number selfRef">B.2. </a><a href="#name-montgomery-to-weierstrass-c" class="section-name selfRef">Montgomery to Weierstrass curves</a>
        </h2>
<p id="section-b.2-1">The rational map from the point (s, t) on the Montgomery curve<a href="#section-b.2-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2-2">
<pre>
    K * t^2 = s^3 + J * s^2 + s
</pre><a href="#section-b.2-2" class="pilcrow">¶</a>
</div>
<p id="section-b.2-3">to the point (x, y) on the equivalent Weierstrass curve<a href="#section-b.2-3" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-b.2-4">
<pre>
    y^2 = x^3 + A * x + B
</pre><a href="#section-b.2-4" class="pilcrow">¶</a>
</div>
<p id="section-b.2-5">is given by:<a href="#section-b.2-5" class="pilcrow">¶</a></p>
<ul>
<li id="section-b.2-6.1">A = (3 - J^2) / (3 * K^2)<a href="#section-b.2-6.1" class="pilcrow">¶</a>
</li>
<li id="section-b.2-6.2">B = (2 * J^3 - 9 * J) / (27 * K^3)<a href="#section-b.2-6.2" class="pilcrow">¶</a>
</li>
<li id="section-b.2-6.3">x = (3 * s + J) / (3 * K)<a href="#section-b.2-6.3" class="pilcrow">¶</a>
</li>
<li id="section-b.2-6.4">y = t / K<a href="#section-b.2-6.4" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-b.2-7">The inverse map, from the point (x, y) to the point (s, t), is given by<a href="#section-b.2-7" class="pilcrow">¶</a></p>
<ul>
<li id="section-b.2-8.1">s = (3 * K * x - J) / 3<a href="#section-b.2-8.1" class="pilcrow">¶</a>
</li>
<li id="section-b.2-8.2">t = y * K<a href="#section-b.2-8.2" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-b.2-9">This mapping can be used to apply the Shallue-van de Woestijne method
(<a href="#svdw" class="xref">Section 6.6.1</a>) to Montgomery curves.<a href="#section-b.2-9" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="appx-iso">
<section id="section-appendix.c">
      <h2 id="name-isogeny-maps-for-suites">
<a href="#section-appendix.c" class="section-number selfRef">Appendix C. </a><a href="#name-isogeny-maps-for-suites" class="section-name selfRef">Isogeny maps for Suites</a>
      </h2>
<p id="section-appendix.c-1">This section specifies the isogeny maps for the secp256k1 and BLS12-381
suites listed in <a href="#suites" class="xref">Section 8</a>.<a href="#section-appendix.c-1" class="pilcrow">¶</a></p>
<p id="section-appendix.c-2">These maps are given in terms of affine coordinates.
Wahby and Boneh (<span>[<a href="#WB19" class="xref">WB19</a>]</span>, Section 4.3) show how to evaluate these maps
in a projective coordinate system (<a href="#projective-coords" class="xref">Appendix D.1</a>), which avoids
modular inversions.<a href="#section-appendix.c-2" class="pilcrow">¶</a></p>
<p id="section-appendix.c-3">Refer to the draft repository <span>[<a href="#hash2curve-repo" class="xref">hash2curve-repo</a>]</span> for a Sage <span>[<a href="#SAGE" class="xref">SAGE</a>]</span> script
that constructs these isogenies.<a href="#section-appendix.c-3" class="pilcrow">¶</a></p>
<div id="appx-iso-secp256k1">
<section id="section-c.1">
        <h2 id="name-3-isogeny-map-for-secp256k1">
<a href="#section-c.1" class="section-number selfRef">C.1. </a><a href="#name-3-isogeny-map-for-secp256k1" class="section-name selfRef">3-isogeny map for secp256k1</a>
        </h2>
<p id="section-c.1-1">This section specifies the isogeny map for the secp256k1 suite listed in <a href="#suites-secp256k1" class="xref">Section 8.8</a>.<a href="#section-c.1-1" class="pilcrow">¶</a></p>
<p id="section-c.1-2">The 3-isogeny map from (x', y') on E' to (x, y) on E is given by the following rational functions:<a href="#section-c.1-2" class="pilcrow">¶</a></p>
<ul>
<li id="section-c.1-3.1">
            <p id="section-c.1-3.1.1">x = x_num / x_den, where<a href="#section-c.1-3.1.1" class="pilcrow">¶</a></p>
<ul>
<li id="section-c.1-3.1.2.1">x_num = k_(1,3) * x'^3 + k_(1,2) * x'^2 + k_(1,1) * x' + k_(1,0)<a href="#section-c.1-3.1.2.1" class="pilcrow">¶</a>
</li>
<li id="section-c.1-3.1.2.2">x_den = x'^2 + k_(2,1) * x' + k_(2,0)<a href="#section-c.1-3.1.2.2" class="pilcrow">¶</a>
</li>
</ul>
</li>
<li id="section-c.1-3.2">
            <p id="section-c.1-3.2.1">y = y' * y_num / y_den, where<a href="#section-c.1-3.2.1" class="pilcrow">¶</a></p>
<ul>
<li id="section-c.1-3.2.2.1">y_num = k_(3,3) * x'^3 + k_(3,2) * x'^2 + k_(3,1) * x' + k_(3,0)<a href="#section-c.1-3.2.2.1" class="pilcrow">¶</a>
</li>
<li id="section-c.1-3.2.2.2">y_den = x'^3 + k_(4,2) * x'^2 + k_(4,1) * x' + k_(4,0)<a href="#section-c.1-3.2.2.2" class="pilcrow">¶</a>
</li>
</ul>
</li>
</ul>
<p id="section-c.1-4">The constants used to compute x_num are as follows:<a href="#section-c.1-4" class="pilcrow">¶</a></p>
<ul>
<li id="section-c.1-5.1">k_(1,0) = 0x8e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38daaaaa8c7<a href="#section-c.1-5.1" class="pilcrow">¶</a>
</li>
<li id="section-c.1-5.2">k_(1,1) = 0x7d3d4c80bc321d5b9f315cea7fd44c5d595d2fc0bf63b92dfff1044f17c6581<a href="#section-c.1-5.2" class="pilcrow">¶</a>
</li>
<li id="section-c.1-5.3">k_(1,2) = 0x534c328d23f234e6e2a413deca25caece4506144037c40314ecbd0b53d9dd262<a href="#section-c.1-5.3" class="pilcrow">¶</a>
</li>
<li id="section-c.1-5.4">k_(1,3) = 0x8e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38daaaaa88c<a href="#section-c.1-5.4" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-c.1-6">The constants used to compute x_den are as follows:<a href="#section-c.1-6" class="pilcrow">¶</a></p>
<ul>
<li id="section-c.1-7.1">k_(2,0) = 0xd35771193d94918a9ca34ccbb7b640dd86cd409542f8487d9fe6b745781eb49b<a href="#section-c.1-7.1" class="pilcrow">¶</a>
</li>
<li id="section-c.1-7.2">k_(2,1) = 0xedadc6f64383dc1df7c4b2d51b54225406d36b641f5e41bbc52a56612a8c6d14<a href="#section-c.1-7.2" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-c.1-8">The constants used to compute y_num are as follows:<a href="#section-c.1-8" class="pilcrow">¶</a></p>
<ul>
<li id="section-c.1-9.1">k_(3,0) = 0x4bda12f684bda12f684bda12f684bda12f684bda12f684bda12f684b8e38e23c<a href="#section-c.1-9.1" class="pilcrow">¶</a>
</li>
<li id="section-c.1-9.2">k_(3,1) = 0xc75e0c32d5cb7c0fa9d0a54b12a0a6d5647ab046d686da6fdffc90fc201d71a3<a href="#section-c.1-9.2" class="pilcrow">¶</a>
</li>
<li id="section-c.1-9.3">k_(3,2) = 0x29a6194691f91a73715209ef6512e576722830a201be2018a765e85a9ecee931<a href="#section-c.1-9.3" class="pilcrow">¶</a>
</li>
<li id="section-c.1-9.4">k_(3,3) = 0x2f684bda12f684bda12f684bda12f684bda12f684bda12f684bda12f38e38d84<a href="#section-c.1-9.4" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-c.1-10">The constants used to compute y_den are as follows:<a href="#section-c.1-10" class="pilcrow">¶</a></p>
<ul>
<li id="section-c.1-11.1">k_(4,0) = 0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffff93b<a href="#section-c.1-11.1" class="pilcrow">¶</a>
</li>
<li id="section-c.1-11.2">k_(4,1) = 0x7a06534bb8bdb49fd5e9e6632722c2989467c1bfc8e8d978dfb425d2685c2573<a href="#section-c.1-11.2" class="pilcrow">¶</a>
</li>
<li id="section-c.1-11.3">k_(4,2) = 0x6484aa716545ca2cf3a70c3fa8fe337e0a3d21162f0d6299a7bf8192bfd2a76f<a href="#section-c.1-11.3" class="pilcrow">¶</a>
</li>
</ul>
</section>
</div>
<div id="appx-iso-bls12381-g1">
<section id="section-c.2">
        <h2 id="name-11-isogeny-map-for-bls12-38">
<a href="#section-c.2" class="section-number selfRef">C.2. </a><a href="#name-11-isogeny-map-for-bls12-38" class="section-name selfRef">11-isogeny map for BLS12-381 G1</a>
        </h2>
<p id="section-c.2-1">The 11-isogeny map from (x', y') on E' to (x, y) on E is given by the following rational functions:<a href="#section-c.2-1" class="pilcrow">¶</a></p>
<ul>
<li id="section-c.2-2.1">
            <p id="section-c.2-2.1.1">x = x_num / x_den, where<a href="#section-c.2-2.1.1" class="pilcrow">¶</a></p>
<ul>
<li id="section-c.2-2.1.2.1">x_num = k_(1,11) * x'^11 + k_(1,10) * x'^10 + k_(1,9) * x'^9 + ... + k_(1,0)<a href="#section-c.2-2.1.2.1" class="pilcrow">¶</a>
</li>
<li id="section-c.2-2.1.2.2">x_den = x'^10 + k_(2,9) * x'^9 + k_(2,8) * x'^8 + ... + k_(2,0)<a href="#section-c.2-2.1.2.2" class="pilcrow">¶</a>
</li>
</ul>
</li>
<li id="section-c.2-2.2">
            <p id="section-c.2-2.2.1">y = y' * y_num / y_den, where<a href="#section-c.2-2.2.1" class="pilcrow">¶</a></p>
<ul>
<li id="section-c.2-2.2.2.1">y_num = k_(3,15) * x'^15 + k_(3,14) * x'^14 + k_(3,13) * x'^13 + ... + k_(3,0)<a href="#section-c.2-2.2.2.1" class="pilcrow">¶</a>
</li>
<li id="section-c.2-2.2.2.2">y_den = x'^15 + k_(4,14) * x'^14 + k_(4,13) * x'^13 + ... + k_(4,0)<a href="#section-c.2-2.2.2.2" class="pilcrow">¶</a>
</li>
</ul>
</li>
</ul>
<p id="section-c.2-3">The constants used to compute x_num are as follows:<a href="#section-c.2-3" class="pilcrow">¶</a></p>
<ul>
<li id="section-c.2-4.1">k_(1,0) = 0x11a05f2b1e833340b809101dd99815856b303e88a2d7005ff2627b56cdb4e2c85610c2d5f2e62d6eaeac1662734649b7<a href="#section-c.2-4.1" class="pilcrow">¶</a>
</li>
<li id="section-c.2-4.2">k_(1,1) = 0x17294ed3e943ab2f0588bab22147a81c7c17e75b2f6a8417f565e33c70d1e86b4838f2a6f318c356e834eef1b3cb83bb<a href="#section-c.2-4.2" class="pilcrow">¶</a>
</li>
<li id="section-c.2-4.3">k_(1,2) = 0xd54005db97678ec1d1048c5d10a9a1bce032473295983e56878e501ec68e25c958c3e3d2a09729fe0179f9dac9edcb0<a href="#section-c.2-4.3" class="pilcrow">¶</a>
</li>
<li id="section-c.2-4.4">k_(1,3) = 0x1778e7166fcc6db74e0609d307e55412d7f5e4656a8dbf25f1b33289f1b330835336e25ce3107193c5b388641d9b6861<a href="#section-c.2-4.4" class="pilcrow">¶</a>
</li>
<li id="section-c.2-4.5">k_(1,4) = 0xe99726a3199f4436642b4b3e4118e5499db995a1257fb3f086eeb65982fac18985a286f301e77c451154ce9ac8895d9<a href="#section-c.2-4.5" class="pilcrow">¶</a>
</li>
<li id="section-c.2-4.6">k_(1,5) = 0x1630c3250d7313ff01d1201bf7a74ab5db3cb17dd952799b9ed3ab9097e68f90a0870d2dcae73d19cd13c1c66f652983<a href="#section-c.2-4.6" class="pilcrow">¶</a>
</li>
<li id="section-c.2-4.7">k_(1,6) = 0xd6ed6553fe44d296a3726c38ae652bfb11586264f0f8ce19008e218f9c86b2a8da25128c1052ecaddd7f225a139ed84<a href="#section-c.2-4.7" class="pilcrow">¶</a>
</li>
<li id="section-c.2-4.8">k_(1,7) = 0x17b81e7701abdbe2e8743884d1117e53356de5ab275b4db1a682c62ef0f2753339b7c8f8c8f475af9ccb5618e3f0c88e<a href="#section-c.2-4.8" class="pilcrow">¶</a>
</li>
<li id="section-c.2-4.9">k_(1,8) = 0x80d3cf1f9a78fc47b90b33563be990dc43b756ce79f5574a2c596c928c5d1de4fa295f296b74e956d71986a8497e317<a href="#section-c.2-4.9" class="pilcrow">¶</a>
</li>
<li id="section-c.2-4.10">k_(1,9) = 0x169b1f8e1bcfa7c42e0c37515d138f22dd2ecb803a0c5c99676314baf4bb1b7fa3190b2edc0327797f241067be390c9e<a href="#section-c.2-4.10" class="pilcrow">¶</a>
</li>
<li id="section-c.2-4.11">k_(1,10) = 0x10321da079ce07e272d8ec09d2565b0dfa7dccdde6787f96d50af36003b14866f69b771f8c285decca67df3f1605fb7b<a href="#section-c.2-4.11" class="pilcrow">¶</a>
</li>
<li id="section-c.2-4.12">k_(1,11) = 0x6e08c248e260e70bd1e962381edee3d31d79d7e22c837bc23c0bf1bc24c6b68c24b1b80b64d391fa9c8ba2e8ba2d229<a href="#section-c.2-4.12" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-c.2-5">The constants used to compute x_den are as follows:<a href="#section-c.2-5" class="pilcrow">¶</a></p>
<ul>
<li id="section-c.2-6.1">k_(2,0) = 0x8ca8d548cff19ae18b2e62f4bd3fa6f01d5ef4ba35b48ba9c9588617fc8ac62b558d681be343df8993cf9fa40d21b1c<a href="#section-c.2-6.1" class="pilcrow">¶</a>
</li>
<li id="section-c.2-6.2">k_(2,1) = 0x12561a5deb559c4348b4711298e536367041e8ca0cf0800c0126c2588c48bf5713daa8846cb026e9e5c8276ec82b3bff<a href="#section-c.2-6.2" class="pilcrow">¶</a>
</li>
<li id="section-c.2-6.3">k_(2,2) = 0xb2962fe57a3225e8137e629bff2991f6f89416f5a718cd1fca64e00b11aceacd6a3d0967c94fedcfcc239ba5cb83e19<a href="#section-c.2-6.3" class="pilcrow">¶</a>
</li>
<li id="section-c.2-6.4">k_(2,3) = 0x3425581a58ae2fec83aafef7c40eb545b08243f16b1655154cca8abc28d6fd04976d5243eecf5c4130de8938dc62cd8<a href="#section-c.2-6.4" class="pilcrow">¶</a>
</li>
<li id="section-c.2-6.5">k_(2,4) = 0x13a8e162022914a80a6f1d5f43e7a07dffdfc759a12062bb8d6b44e833b306da9bd29ba81f35781d539d395b3532a21e<a href="#section-c.2-6.5" class="pilcrow">¶</a>
</li>
<li id="section-c.2-6.6">k_(2,5) = 0xe7355f8e4e667b955390f7f0506c6e9395735e9ce9cad4d0a43bcef24b8982f7400d24bc4228f11c02df9a29f6304a5<a href="#section-c.2-6.6" class="pilcrow">¶</a>
</li>
<li id="section-c.2-6.7">k_(2,6) = 0x772caacf16936190f3e0c63e0596721570f5799af53a1894e2e073062aede9cea73b3538f0de06cec2574496ee84a3a<a href="#section-c.2-6.7" class="pilcrow">¶</a>
</li>
<li id="section-c.2-6.8">k_(2,7) = 0x14a7ac2a9d64a8b230b3f5b074cf01996e7f63c21bca68a81996e1cdf9822c580fa5b9489d11e2d311f7d99bbdcc5a5e<a href="#section-c.2-6.8" class="pilcrow">¶</a>
</li>
<li id="section-c.2-6.9">k_(2,8) = 0xa10ecf6ada54f825e920b3dafc7a3cce07f8d1d7161366b74100da67f39883503826692abba43704776ec3a79a1d641<a href="#section-c.2-6.9" class="pilcrow">¶</a>
</li>
<li id="section-c.2-6.10">k_(2,9) = 0x95fc13ab9e92ad4476d6e3eb3a56680f682b4ee96f7d03776df533978f31c1593174e4b4b7865002d6384d168ecdd0a<a href="#section-c.2-6.10" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-c.2-7">The constants used to compute y_num are as follows:<a href="#section-c.2-7" class="pilcrow">¶</a></p>
<ul>
<li id="section-c.2-8.1">k_(3,0) = 0x90d97c81ba24ee0259d1f094980dcfa11ad138e48a869522b52af6c956543d3cd0c7aee9b3ba3c2be9845719707bb33<a href="#section-c.2-8.1" class="pilcrow">¶</a>
</li>
<li id="section-c.2-8.2">k_(3,1) = 0x134996a104ee5811d51036d776fb46831223e96c254f383d0f906343eb67ad34d6c56711962fa8bfe097e75a2e41c696<a href="#section-c.2-8.2" class="pilcrow">¶</a>
</li>
<li id="section-c.2-8.3">k_(3,2) = 0xcc786baa966e66f4a384c86a3b49942552e2d658a31ce2c344be4b91400da7d26d521628b00523b8dfe240c72de1f6<a href="#section-c.2-8.3" class="pilcrow">¶</a>
</li>
<li id="section-c.2-8.4">k_(3,3) = 0x1f86376e8981c217898751ad8746757d42aa7b90eeb791c09e4a3ec03251cf9de405aba9ec61deca6355c77b0e5f4cb<a href="#section-c.2-8.4" class="pilcrow">¶</a>
</li>
<li id="section-c.2-8.5">k_(3,4) = 0x8cc03fdefe0ff135caf4fe2a21529c4195536fbe3ce50b879833fd221351adc2ee7f8dc099040a841b6daecf2e8fedb<a href="#section-c.2-8.5" class="pilcrow">¶</a>
</li>
<li id="section-c.2-8.6">k_(3,5) = 0x16603fca40634b6a2211e11db8f0a6a074a7d0d4afadb7bd76505c3d3ad5544e203f6326c95a807299b23ab13633a5f0<a href="#section-c.2-8.6" class="pilcrow">¶</a>
</li>
<li id="section-c.2-8.7">k_(3,6) = 0x4ab0b9bcfac1bbcb2c977d027796b3ce75bb8ca2be184cb5231413c4d634f3747a87ac2460f415ec961f8855fe9d6f2<a href="#section-c.2-8.7" class="pilcrow">¶</a>
</li>
<li id="section-c.2-8.8">k_(3,7) = 0x987c8d5333ab86fde9926bd2ca6c674170a05bfe3bdd81ffd038da6c26c842642f64550fedfe935a15e4ca31870fb29<a href="#section-c.2-8.8" class="pilcrow">¶</a>
</li>
<li id="section-c.2-8.9">k_(3,8) = 0x9fc4018bd96684be88c9e221e4da1bb8f3abd16679dc26c1e8b6e6a1f20cabe69d65201c78607a360370e577bdba587<a href="#section-c.2-8.9" class="pilcrow">¶</a>
</li>
<li id="section-c.2-8.10">k_(3,9) = 0xe1bba7a1186bdb5223abde7ada14a23c42a0ca7915af6fe06985e7ed1e4d43b9b3f7055dd4eba6f2bafaaebca731c30<a href="#section-c.2-8.10" class="pilcrow">¶</a>
</li>
<li id="section-c.2-8.11">k_(3,10) = 0x19713e47937cd1be0dfd0b8f1d43fb93cd2fcbcb6caf493fd1183e416389e61031bf3a5cce3fbafce813711ad011c132<a href="#section-c.2-8.11" class="pilcrow">¶</a>
</li>
<li id="section-c.2-8.12">k_(3,11) = 0x18b46a908f36f6deb918c143fed2edcc523559b8aaf0c2462e6bfe7f911f643249d9cdf41b44d606ce07c8a4d0074d8e<a href="#section-c.2-8.12" class="pilcrow">¶</a>
</li>
<li id="section-c.2-8.13">k_(3,12) = 0xb182cac101b9399d155096004f53f447aa7b12a3426b08ec02710e807b4633f06c851c1919211f20d4c04f00b971ef8<a href="#section-c.2-8.13" class="pilcrow">¶</a>
</li>
<li id="section-c.2-8.14">k_(3,13) = 0x245a394ad1eca9b72fc00ae7be315dc757b3b080d4c158013e6632d3c40659cc6cf90ad1c232a6442d9d3f5db980133<a href="#section-c.2-8.14" class="pilcrow">¶</a>
</li>
<li id="section-c.2-8.15">k_(3,14) = 0x5c129645e44cf1102a159f748c4a3fc5e673d81d7e86568d9ab0f5d396a7ce46ba1049b6579afb7866b1e715475224b<a href="#section-c.2-8.15" class="pilcrow">¶</a>
</li>
<li id="section-c.2-8.16">k_(3,15) = 0x15e6be4e990f03ce4ea50b3b42df2eb5cb181d8f84965a3957add4fa95af01b2b665027efec01c7704b456be69c8b604<a href="#section-c.2-8.16" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-c.2-9">The constants used to compute y_den are as follows:<a href="#section-c.2-9" class="pilcrow">¶</a></p>
<ul>
<li id="section-c.2-10.1">k_(4,0) = 0x16112c4c3a9c98b252181140fad0eae9601a6de578980be6eec3232b5be72e7a07f3688ef60c206d01479253b03663c1<a href="#section-c.2-10.1" class="pilcrow">¶</a>
</li>
<li id="section-c.2-10.2">k_(4,1) = 0x1962d75c2381201e1a0cbd6c43c348b885c84ff731c4d59ca4a10356f453e01f78a4260763529e3532f6102c2e49a03d<a href="#section-c.2-10.2" class="pilcrow">¶</a>
</li>
<li id="section-c.2-10.3">k_(4,2) = 0x58df3306640da276faaae7d6e8eb15778c4855551ae7f310c35a5dd279cd2eca6757cd636f96f891e2538b53dbf67f2<a href="#section-c.2-10.3" class="pilcrow">¶</a>
</li>
<li id="section-c.2-10.4">k_(4,3) = 0x16b7d288798e5395f20d23bf89edb4d1d115c5dbddbcd30e123da489e726af41727364f2c28297ada8d26d98445f5416<a href="#section-c.2-10.4" class="pilcrow">¶</a>
</li>
<li id="section-c.2-10.5">k_(4,4) = 0xbe0e079545f43e4b00cc912f8228ddcc6d19c9f0f69bbb0542eda0fc9dec916a20b15dc0fd2ededda39142311a5001d<a href="#section-c.2-10.5" class="pilcrow">¶</a>
</li>
<li id="section-c.2-10.6">k_(4,5) = 0x8d9e5297186db2d9fb266eaac783182b70152c65550d881c5ecd87b6f0f5a6449f38db9dfa9cce202c6477faaf9b7ac<a href="#section-c.2-10.6" class="pilcrow">¶</a>
</li>
<li id="section-c.2-10.7">k_(4,6) = 0x166007c08a99db2fc3ba8734ace9824b5eecfdfa8d0cf8ef5dd365bc400a0051d5fa9c01a58b1fb93d1a1399126a775c<a href="#section-c.2-10.7" class="pilcrow">¶</a>
</li>
<li id="section-c.2-10.8">k_(4,7) = 0x16a3ef08be3ea7ea03bcddfabba6ff6ee5a4375efa1f4fd7feb34fd206357132b920f5b00801dee460ee415a15812ed9<a href="#section-c.2-10.8" class="pilcrow">¶</a>
</li>
<li id="section-c.2-10.9">k_(4,8) = 0x1866c8ed336c61231a1be54fd1d74cc4f9fb0ce4c6af5920abc5750c4bf39b4852cfe2f7bb9248836b233d9d55535d4a<a href="#section-c.2-10.9" class="pilcrow">¶</a>
</li>
<li id="section-c.2-10.10">k_(4,9) = 0x167a55cda70a6e1cea820597d94a84903216f763e13d87bb5308592e7ea7d4fbc7385ea3d529b35e346ef48bb8913f55<a href="#section-c.2-10.10" class="pilcrow">¶</a>
</li>
<li id="section-c.2-10.11">k_(4,10) = 0x4d2f259eea405bd48f010a01ad2911d9c6dd039bb61a6290e591b36e636a5c871a5c29f4f83060400f8b49cba8f6aa8<a href="#section-c.2-10.11" class="pilcrow">¶</a>
</li>
<li id="section-c.2-10.12">k_(4,11) = 0xaccbb67481d033ff5852c1e48c50c477f94ff8aefce42d28c0f9a88cea7913516f968986f7ebbea9684b529e2561092<a href="#section-c.2-10.12" class="pilcrow">¶</a>
</li>
<li id="section-c.2-10.13">k_(4,12) = 0xad6b9514c767fe3c3613144b45f1496543346d98adf02267d5ceef9a00d9b8693000763e3b90ac11e99b138573345cc<a href="#section-c.2-10.13" class="pilcrow">¶</a>
</li>
<li id="section-c.2-10.14">k_(4,13) = 0x2660400eb2e4f3b628bdd0d53cd76f2bf565b94e72927c1cb748df27942480e420517bd8714cc80d1fadc1326ed06f7<a href="#section-c.2-10.14" class="pilcrow">¶</a>
</li>
<li id="section-c.2-10.15">k_(4,14) = 0xe0fa1d816ddc03e6b24255e0d7819c171c40f65e273b853324efcd6356caa205ca2f570f13497804415473a1d634b8f<a href="#section-c.2-10.15" class="pilcrow">¶</a>
</li>
</ul>
</section>
</div>
<div id="appx-iso-bls12381-g2">
<section id="section-c.3">
        <h2 id="name-3-isogeny-map-for-bls12-381">
<a href="#section-c.3" class="section-number selfRef">C.3. </a><a href="#name-3-isogeny-map-for-bls12-381" class="section-name selfRef">3-isogeny map for BLS12-381 G2</a>
        </h2>
<p id="section-c.3-1">The 3-isogeny map from (x', y') on E' to (x, y) on E is given by the following rational functions:<a href="#section-c.3-1" class="pilcrow">¶</a></p>
<ul>
<li id="section-c.3-2.1">
            <p id="section-c.3-2.1.1">x = x_num / x_den, where<a href="#section-c.3-2.1.1" class="pilcrow">¶</a></p>
<ul>
<li id="section-c.3-2.1.2.1">x_num = k_(1,3) * x'^3 + k_(1,2) * x'^2 + k_(1,1) * x' + k_(1,0)<a href="#section-c.3-2.1.2.1" class="pilcrow">¶</a>
</li>
<li id="section-c.3-2.1.2.2">x_den = x'^2 + k_(2,1) * x' + k_(2,0)<a href="#section-c.3-2.1.2.2" class="pilcrow">¶</a>
</li>
</ul>
</li>
<li id="section-c.3-2.2">
            <p id="section-c.3-2.2.1">y = y' * y_num / y_den, where<a href="#section-c.3-2.2.1" class="pilcrow">¶</a></p>
<ul>
<li id="section-c.3-2.2.2.1">y_num = k_(3,3) * x'^3 + k_(3,2) * x'^2 + k_(3,1) * x' + k_(3,0)<a href="#section-c.3-2.2.2.1" class="pilcrow">¶</a>
</li>
<li id="section-c.3-2.2.2.2">y_den = x'^3 + k_(4,2) * x'^2 + k_(4,1) * x' + k_(4,0)<a href="#section-c.3-2.2.2.2" class="pilcrow">¶</a>
</li>
</ul>
</li>
</ul>
<p id="section-c.3-3">The constants used to compute x_num are as follows:<a href="#section-c.3-3" class="pilcrow">¶</a></p>
<ul>
<li id="section-c.3-4.1">k_(1,0) = 0x5c759507e8e333ebb5b7a9a47d7ed8532c52d39fd3a042a88b58423c50ae15d5c2638e343d9c71c6238aaaaaaaa97d6 + 0x5c759507e8e333ebb5b7a9a47d7ed8532c52d39fd3a042a88b58423c50ae15d5c2638e343d9c71c6238aaaaaaaa97d6 * I<a href="#section-c.3-4.1" class="pilcrow">¶</a>
</li>
<li id="section-c.3-4.2">k_(1,1) = 0x11560bf17baa99bc32126fced787c88f984f87adf7ae0c7f9a208c6b4f20a4181472aaa9cb8d555526a9ffffffffc71a * I<a href="#section-c.3-4.2" class="pilcrow">¶</a>
</li>
<li id="section-c.3-4.3">k_(1,2) = 0x11560bf17baa99bc32126fced787c88f984f87adf7ae0c7f9a208c6b4f20a4181472aaa9cb8d555526a9ffffffffc71e + 0x8ab05f8bdd54cde190937e76bc3e447cc27c3d6fbd7063fcd104635a790520c0a395554e5c6aaaa9354ffffffffe38d * I<a href="#section-c.3-4.3" class="pilcrow">¶</a>
</li>
<li id="section-c.3-4.4">k_(1,3) = 0x171d6541fa38ccfaed6dea691f5fb614cb14b4e7f4e810aa22d6108f142b85757098e38d0f671c7188e2aaaaaaaa5ed1<a href="#section-c.3-4.4" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-c.3-5">The constants used to compute x_den are as follows:<a href="#section-c.3-5" class="pilcrow">¶</a></p>
<ul>
<li id="section-c.3-6.1">k_(2,0) = 0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaa63 * I<a href="#section-c.3-6.1" class="pilcrow">¶</a>
</li>
<li id="section-c.3-6.2">k_(2,1) = 0xc + 0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaa9f * I<a href="#section-c.3-6.2" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-c.3-7">The constants used to compute y_num are as follows:<a href="#section-c.3-7" class="pilcrow">¶</a></p>
<ul>
<li id="section-c.3-8.1">k_(3,0) = 0x1530477c7ab4113b59a4c18b076d11930f7da5d4a07f649bf54439d87d27e500fc8c25ebf8c92f6812cfc71c71c6d706 + 0x1530477c7ab4113b59a4c18b076d11930f7da5d4a07f649bf54439d87d27e500fc8c25ebf8c92f6812cfc71c71c6d706 * I<a href="#section-c.3-8.1" class="pilcrow">¶</a>
</li>
<li id="section-c.3-8.2">k_(3,1) = 0x5c759507e8e333ebb5b7a9a47d7ed8532c52d39fd3a042a88b58423c50ae15d5c2638e343d9c71c6238aaaaaaaa97be * I<a href="#section-c.3-8.2" class="pilcrow">¶</a>
</li>
<li id="section-c.3-8.3">k_(3,2) = 0x11560bf17baa99bc32126fced787c88f984f87adf7ae0c7f9a208c6b4f20a4181472aaa9cb8d555526a9ffffffffc71c + 0x8ab05f8bdd54cde190937e76bc3e447cc27c3d6fbd7063fcd104635a790520c0a395554e5c6aaaa9354ffffffffe38f * I<a href="#section-c.3-8.3" class="pilcrow">¶</a>
</li>
<li id="section-c.3-8.4">k_(3,3) = 0x124c9ad43b6cf79bfbf7043de3811ad0761b0f37a1e26286b0e977c69aa274524e79097a56dc4bd9e1b371c71c718b10<a href="#section-c.3-8.4" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-c.3-9">The constants used to compute y_den are as follows:<a href="#section-c.3-9" class="pilcrow">¶</a></p>
<ul>
<li id="section-c.3-10.1">k_(4,0) = 0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffa8fb + 0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffa8fb * I<a href="#section-c.3-10.1" class="pilcrow">¶</a>
</li>
<li id="section-c.3-10.2">k_(4,1) = 0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffa9d3 * I<a href="#section-c.3-10.2" class="pilcrow">¶</a>
</li>
<li id="section-c.3-10.3">k_(4,2) = 0x12 + 0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaa99 * I<a href="#section-c.3-10.3" class="pilcrow">¶</a>
</li>
</ul>
</section>
</div>
</section>
</div>
<div id="samplecode">
<section id="section-appendix.d">
      <h2 id="name-sample-code">
<a href="#section-appendix.d" class="section-number selfRef">Appendix D. </a><a href="#name-sample-code" class="section-name selfRef">Sample Code</a>
      </h2>
<p id="section-appendix.d-1">This section gives sample implementations optimized for some of the
elliptic curves listed in <a href="#suites" class="xref">Section 8</a>.
A future version of this document will include all listed curves, plus
accompanying test vectors.
Sample Sage <span>[<a href="#SAGE" class="xref">SAGE</a>]</span> code for each algorithm can also be found in the
draft repository <span>[<a href="#hash2curve-repo" class="xref">hash2curve-repo</a>]</span>.<a href="#section-appendix.d-1" class="pilcrow">¶</a></p>
<div id="projective-coords">
<section id="section-d.1">
        <h2 id="name-interface-and-projective-co">
<a href="#section-d.1" class="section-number selfRef">D.1. </a><a href="#name-interface-and-projective-co" class="section-name selfRef">Interface and projective coordinate systems</a>
        </h2>
<p id="section-d.1-1">The sample code in this section uses a different interface than
the mappings of <a href="#mappings" class="xref">Section 6</a>.
Specifically, each mapping function in this section has the following
signature:<a href="#section-d.1-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-d.1-2">
<pre>
    (xn, xd, yn, yd) = map_to_curve(u)
</pre><a href="#section-d.1-2" class="pilcrow">¶</a>
</div>
<p id="section-d.1-3">The resulting point (x, y) is given by (xn / xd, yn / yd).<a href="#section-d.1-3" class="pilcrow">¶</a></p>
<p id="section-d.1-4">The reason for this modified interface is that it enables further
optimizations when working with points in a projective coordinate
system.
This is desirable, for example, when the resulting point will be
immediately multiplied by a scalar, since most scalar multiplication
algorithms operate on projective points.<a href="#section-d.1-4" class="pilcrow">¶</a></p>
<p id="section-d.1-5">The following are two commonly used projective coordinate systems
and the corresponding conversions:<a href="#section-d.1-5" class="pilcrow">¶</a></p>
<ul>
<li id="section-d.1-6.1">A point (X, Y, Z) in homogeneous projective coordinates corresponds
to the affine point (x, y) = (X / Z, Y / Z);
the inverse conversion is given by (X, Y, Z) = (x, y, 1).
To convert (xn, xd, yn, yd) to homogeneous projective coordinates,
compute (X, Y, Z) = (xn * yd, yn * xd, xd * yd).<a href="#section-d.1-6.1" class="pilcrow">¶</a>
</li>
<li id="section-d.1-6.2">A point (X', Y', Z') in Jacobian projective coordinates corresponds
to the affine point (x, y) = (X' / Z'^2, Y' / Z'^3);
the inverse conversion is given by (X', Y', Z') = (x, y, 1).
To convert (xn, xd, yn, yd) to Jacobian projective coordinates,
compute (X', Y', Z') = (xn * xd * yd^2, yn * yd^2 * xd^3, xd * yd).<a href="#section-d.1-6.2" class="pilcrow">¶</a>
</li>
</ul>
</section>
</div>
<div id="sswu-map-to-3mod4">
<section id="section-d.2">
        <h2 id="name-simplified-swu-for-p-3-mod-">
<a href="#section-d.2" class="section-number selfRef">D.2. </a><a href="#name-simplified-swu-for-p-3-mod-" class="section-name selfRef">Simplified SWU for p = 3 (mod 4)</a>
        </h2>
<p id="section-d.2-1">The following is a straight-line implementation of the Simplified SWU
mapping that applies to any curve over GF(p) for p = 3 (mod 4).
This includes the ciphersuites for NIST curves P-256, P-384, and P-521 <span>[<a href="#FIPS186-4" class="xref">FIPS186-4</a>]</span> given in <a href="#suites" class="xref">Section 8</a>.
It also includes the curves isogenous to secp256k1 (<a href="#suites-secp256k1" class="xref">Section 8.8</a>) and BLS12-381 G1 (<a href="#suites-bls12381-g1" class="xref">Section 8.9.1</a>).<a href="#section-d.2-1" class="pilcrow">¶</a></p>
<p id="section-d.2-2">The implementations for these curves differ only in the constants
and the base field.
The constant definitions below are given in terms of the parameters for the
Simplified SWU mapping; for parameter values for the curves listed above, see
<a href="#suites-p256" class="xref">Section 8.3</a> (P-256),
<a href="#suites-p384" class="xref">Section 8.4</a> (P-384),
<a href="#suites-p521" class="xref">Section 8.5</a> (P-521),
<a href="#suites-secp256k1" class="xref">Section 8.8</a> (E' isogenous to secp256k1), and
<a href="#suites-bls12381-g1" class="xref">Section 8.9.1</a> (E' isogenous to BLS12-381 G1).<a href="#section-d.2-2" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-d.2-3">
<pre>
map_to_curve_simple_swu_3mod4(u)

Input: u, an element of F.
Output: (xn, xd, yn, yd) such that (xn / xd, yn / yd) is a
        point on the target curve.

Constants: defined per curve; see above.
1.  c1 = (p - 3) / 4           # Integer arithmetic
2.  c2 = sqrt(-Z^3)

Steps:
1.  tv1 = u^2
2.  tv3 = Z * tv1
3.  tv2 = tv3^2
4.   xd = tv2 + tv3
5.  x1n = xd + 1
6.  x1n = x1n * B
7.   xd = -A * xd
8.   e1 = xd == 0
9.   xd = CMOV(xd, Z * A, e1)  # If xd == 0, set xd = Z * A
10. tv2 = xd^2
11. gxd = tv2 * xd             # gxd == xd^3
12. tv2 = A * tv2
13. gx1 = x1n^2
14. gx1 = gx1 + tv2            # x1n^2 + A * xd^2
15. gx1 = gx1 * x1n            # x1n^3 + A * x1n * xd^2
16. tv2 = B * gxd
17. gx1 = gx1 + tv2            # x1n^3 + A * x1n * xd^2 + B * xd^3
18. tv4 = gxd^2
19. tv2 = gx1 * gxd
20. tv4 = tv4 * tv2            # gx1 * gxd^3
21.  y1 = tv4^c1               # (gx1 * gxd^3)^((p - 3) / 4)
22.  y1 = y1 * tv2             # gx1 * gxd * (gx1 * gxd^3)^((p - 3) / 4)
23. x2n = tv3 * x1n            # x2 = x2n / xd = -10 * u^2 * x1n / xd
24.  y2 = y1 * c2              # y2 = y1 * sqrt(-Z^3)
25.  y2 = y2 * tv1
26.  y2 = y2 * u
27. tv2 = y1^2
28. tv2 = tv2 * gxd
29.  e2 = tv2 == gx1
30.  xn = CMOV(x2n, x1n, e2)   # If e2, x = x1, else x = x2
31.   y = CMOV(y2, y1, e2)     # If e2, y = y1, else y = y2
32.  e3 = sgn0(u) == sgn0(y)   # Fix sign of y
33.   y = CMOV(-y, y, e3)
34. return (xn, xd, y, 1)
</pre><a href="#section-d.2-3" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="map-to-curve25519">
<section id="section-d.3">
        <h2 id="name-curve25519-elligator-2">
<a href="#section-d.3" class="section-number selfRef">D.3. </a><a href="#name-curve25519-elligator-2" class="section-name selfRef">curve25519 (Elligator 2)</a>
        </h2>
<p id="section-d.3-1">The following is a straight-line implementation of Elligator 2
for curve25519 <span>[<a href="#RFC7748" class="xref">RFC7748</a>]</span> as specified in <a href="#suites-25519" class="xref">Section 8.6</a>.<a href="#section-d.3-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-d.3-2">
<pre>
map_to_curve_elligator2_curve25519(u)

Input: u, an element of F.
Output: (xn, xd, yn, yd) such that (xn / xd, yn / yd) is a
        point on curve25519.

Constants:
1. c1 = (p + 3) / 8           # Integer arithmetic
2. c2 = 2^c1
3. c3 = sqrt(-1)
4. c4 = (p - 5) / 8           # Integer arithmetic

Steps:
1.  tv1 = u^2
2.  tv1 = 2 * tv1
3.   xd = tv1 + 1             # Nonzero: -1 is square (mod p), tv1 is not
4.  x1n = -486662             # x1 = x1n / xd = -486662 / (1 + 2 * u^2)
5.  tv2 = xd^2
6.  gxd = tv2 * xd            # gxd = xd^3
7.  gx1 = 486662 * xd         # 486662 * xd
8.  gx1 = gx1 + x1n           # x1n + 486662 * xd
9.  gx1 = gx1 * x1n           # x1n^2 + 486662 * x1n * xd
10. gx1 = gx1 + tv2           # x1n^2 + 486662 * x1n * xd + xd^2
11. gx1 = gx1 * x1n           # x1n^3 + 486662 * x1n^2 * xd + x1n * xd^2
12. tv3 = gxd^2
13. tv2 = tv3^2               # gxd^4
14. tv3 = tv3 * gxd           # gxd^3
15. tv3 = tv3 * gx1           # gx1 * gxd^3
16. tv2 = tv2 * tv3           # gx1 * gxd^7
17. y11 = tv2^c4              # (gx1 * gxd^7)^((p - 5) / 8)
18. y11 = y11 * tv3           # gx1 * gxd^3 * (gx1 * gxd^7)^((p - 5) / 8)
19. y12 = y11 * c3
20. tv2 = y11^2
21. tv2 = tv2 * gxd
22.  e1 = tv2 == gx1
23.  y1 = CMOV(y12, y11, e1)  # If g(x1) is square, this is its sqrt
24. x2n = x1n * tv1           # x2 = x2n / xd = 2 * u^2 * x1n / xd
25. y21 = y11 * u
26. y21 = y21 * c2
27. y22 = y21 * c3
28. gx2 = gx1 * tv1           # g(x2) = gx2 / gxd = 2 * u^2 * g(x1)
29. tv2 = y21^2
30. tv2 = tv2 * gxd
31.  e2 = tv2 == gx2
32.  y2 = CMOV(y22, y21, e2)  # If g(x2) is square, this is its sqrt
33. tv2 = y1^2
34. tv2 = tv2 * gxd
35.  e3 = tv2 == gx1
36.  xn = CMOV(x2n, x1n, e3)  # If e3, x = x1, else x = x2
37.   y = CMOV(y2, y1, e3)    # If e3, y = y1, else y = y2
38.  e4 = sgn0(u) == sgn0(y)  # Fix sign of y
39.   y = CMOV(-y, y, e4)
40. return (xn, xd, y, 1)
</pre><a href="#section-d.3-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="map-to-edwards25519">
<section id="section-d.4">
        <h2 id="name-edwards25519-elligator-2">
<a href="#section-d.4" class="section-number selfRef">D.4. </a><a href="#name-edwards25519-elligator-2" class="section-name selfRef">edwards25519 (Elligator 2)</a>
        </h2>
<p id="section-d.4-1">The following is a straight-line implementation of Elligator 2
for edwards25519 <span>[<a href="#RFC7748" class="xref">RFC7748</a>]</span> as specified in <a href="#suites-25519" class="xref">Section 8.6</a>.
The subroutine map_to_curve_elligator2_curve25519
is defined in <a href="#map-to-curve25519" class="xref">Appendix D.3</a>.<a href="#section-d.4-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-d.4-2">
<pre>
map_to_curve_elligator2_edwards25519(u)

Input: u, an element of F.
Output: (xn, xd, yn, yd) such that (xn / xd, yn / yd) is a
        point on edwards25519.

Constants:
1. c1 = sqrt(-486664)    # sgn0(c1) MUST equal 1

Steps:
1.  (xMn, xMd, yMn, yMd) = map_to_curve_elligator2_curve25519(u)
2.  xn = xMn * yMd
3.  xn = xn * c1
4.  xd = xMd * yMn       # xn / xd = c1 * xM / yM
5.  yn = xMn - xMd
6.  yd = xMn + xMd       # (n / d - 1) / (n / d + 1) = (n - d) / (n + d)
7. tv1 = xd * yd
8.   e = tv1 == 0
9.  xn = CMOV(xn, 0, e)
10. xd = CMOV(xd, 1, e)
11. yn = CMOV(yn, 1, e)
12. yd = CMOV(yd, 1, e)
13. return (xn, xd, yn, yd)
</pre><a href="#section-d.4-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="map-to-curve448">
<section id="section-d.5">
        <h2 id="name-curve448-elligator-2">
<a href="#section-d.5" class="section-number selfRef">D.5. </a><a href="#name-curve448-elligator-2" class="section-name selfRef">curve448 (Elligator 2)</a>
        </h2>
<p id="section-d.5-1">The following is a straight-line implementation of Elligator 2
for curve448 <span>[<a href="#RFC7748" class="xref">RFC7748</a>]</span> as specified in <a href="#suites-448" class="xref">Section 8.7</a>.<a href="#section-d.5-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-d.5-2">
<pre>
map_to_curve_elligator2_curve448(u)

Input: u, an element of F.
Output: (xn, xd, yn, yd) such that (xn / xd, yn / yd) is a
        point on curve448.

Constants:
1. c1 = (p - 3) / 4           # Integer arithmetic

Steps:
1.  tv1 = u^2
2.   e1 = tv1 == 1
3.  tv1 = CMOV(tv1, 0, e1)    # If Z * u^2 == -1, set tv1 = 0
4.   xd = 1 - tv1
5.  x1n = -156326
6.  tv2 = xd^2
7.  gxd = tv2 * xd            # gxd = xd^3
8.  gx1 = 156326 * xd         # 156326 * xd
9.  gx1 = gx1 + x1n           # x1n + 156326 * xd
10. gx1 = gx1 * x1n           # x1n^2 + 156326 * x1n * xd
11. gx1 = gx1 + tv2           # x1n^2 + 156326 * x1n * xd + xd^2
12. gx1 = gx1 * x1n           # x1n^3 + 156326 * x1n^2 * xd + x1n * xd^2
13. tv3 = gxd^2
14. tv2 = gx1 * gxd           # gx1 * gxd
15. tv3 = tv3 * tv2           # gx1 * gxd^3
16.  y1 = tv3^c1              # (gx1 * gxd^3)^((p - 3) / 4)
17.  y1 = y1 * tv2            # gx1 * gxd * (gx1 * gxd^3)^((p - 3) / 4)
18. x2n = -tv1 * x1n          # x2 = x2n / xd = -1 * u^2 * x1n / xd
19.  y2 = y1 * u
20.  y2 = CMOV(y2, 0, e1)
21. tv2 = y1^2
22. tv2 = tv2 * gxd
23.  e2 = tv2 == gx1
24.  xn = CMOV(x2n, x1n, e2)  # If e2, x = x1, else x = x2
25.   y = CMOV(y2, y1, e2)    # If e2, y = y1, else y = y2
26.  e3 = sgn0(u) == sgn0(y)  # Fix sign of y
27.   y = CMOV(-y, y, e3)
28. return (xn, xd, y, 1)
</pre><a href="#section-d.5-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="map-to-edwards448">
<section id="section-d.6">
        <h2 id="name-edwards448-elligator-2">
<a href="#section-d.6" class="section-number selfRef">D.6. </a><a href="#name-edwards448-elligator-2" class="section-name selfRef">edwards448 (Elligator 2)</a>
        </h2>
<p id="section-d.6-1">The following is a straight-line implementation of Elligator 2
for edwards448 <span>[<a href="#RFC7748" class="xref">RFC7748</a>]</span> as specified in <a href="#suites-448" class="xref">Section 8.7</a>.
The subroutine map_to_curve_elligator2_curve448
is defined in <a href="#map-to-curve448" class="xref">Appendix D.5</a>.<a href="#section-d.6-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-d.6-2">
<pre>
map_to_curve_elligator2_edwards448(u)

Input: u, an element of F.
Output: (xn, xd, yn, yd) such that (xn / xd, yn / yd) is a
        point on edwards448.

Steps:
1. (xn, xd, yn, yd) = map_to_curve_elligator2_curve448(u)
2.  xn2 = xn^2
3.  xd2 = xd^2
4.  xd4 = xd2^2
5.  yn2 = yn^2
6.  yd2 = yd^2
7.  xEn = xn2 - xd2
8.  tv2 = xEn - xd2
9.  xEn = xEn * xd2
10. xEn = xEn * yd
11. xEn = xEn * yn
12. xEn = xEn * 4
13. tv2 = tv2 * xn2
14. tv2 = tv2 * yd2
15. tv3 = 4 * yn2
16. tv1 = tv3 + yd2
17. tv1 = tv1 * xd4
18. xEd = tv1 + tv2
19. tv2 = tv2 * xn
20. tv4 = xn * xd4
21. yEn = tv3 - yd2
22. yEn = yEn * tv4
23. yEn = yEn - tv2
24. tv1 = xn2 + xd2
25. tv1 = tv1 * xd2
26. tv1 = tv1 * xd
27. tv1 = tv1 * yn2
28. tv1 = -2 * tv1
29. yEd = tv2 + tv1
30. tv4 = tv4 * yd2
31. yEd = yEd + tv4
32. tv1 = xEd * yEd
33.   e = tv1 == 0
34. xEn = CMOV(xEn, 0, e)
35. xEd = CMOV(xEd, 1, e)
36. yEn = CMOV(yEn, 1, e)
37. yEd = CMOV(yEd, 1, e)
38. return (xEn, xEd, yEn, yEd)
</pre><a href="#section-d.6-2" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="paramgen">
<section id="section-appendix.e">
      <h2 id="name-scripts-for-parameter-gener">
<a href="#section-appendix.e" class="section-number selfRef">Appendix E. </a><a href="#name-scripts-for-parameter-gener" class="section-name selfRef">Scripts for parameter generation</a>
      </h2>
<p id="section-appendix.e-1">This section gives Sage <span>[<a href="#SAGE" class="xref">SAGE</a>]</span> scripts used to generate parameters for the mappings of <a href="#mappings" class="xref">Section 6</a>.<a href="#section-appendix.e-1" class="pilcrow">¶</a></p>
<div id="svdw-z-code">
<section id="section-e.1">
        <h2 id="name-finding-z-for-the-shallue-a">
<a href="#section-e.1" class="section-number selfRef">E.1. </a><a href="#name-finding-z-for-the-shallue-a" class="section-name selfRef">Finding Z for the Shallue and van de Woestijne map</a>
        </h2>
<p id="section-e.1-1">The below function outputs an appropriate Z for the Shallue and van de Woestijne map (<a href="#svdw" class="xref">Section 6.6.1</a>).<a href="#section-e.1-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft art-sage" id="section-e.1-2">
<pre>
# Arguments:
# - F, a field object, e.g., F = GF(2^521 - 1)
# - A and B, the coefficients of the curve equation y^2 = x^3 + A * x + B
def find_z_svdw(F, A, B):
    g = lambda x: F(x)^3 + F(A) * F(x) + F(B)
    h = lambda Z: -(F(3) * Z^2 + F(4) * A) / (F(4) * g(Z))
    ctr = F.gen()
    while True:
        for Z_cand in (F(ctr), F(-ctr)):
            if g(Z_cand) == F(0):
                # Criterion 1: g(Z) != 0 in F.
                continue
            if h(Z_cand) == F(0):
                # Criterion 2: -(3 * Z^2 + 4 * A) / (4 * g(Z)) != 0 in F.
                continue
            if not h(Z_cand).is_square():
                # Criterion 3: -(3 * Z^2 + 4 * A) / (4 * g(Z)) is square in F.
                continue
            if g(Z_cand).is_square() or g(-Z_cand / F(2)).is_square():
                # Criterion 4: At least one of g(Z) and g(-Z / 2) is square in F.
                return Z_cand
        ctr += 1
</pre><a href="#section-e.1-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="sswu-z-code">
<section id="section-e.2">
        <h2 id="name-finding-z-for-simplified-sw">
<a href="#section-e.2" class="section-number selfRef">E.2. </a><a href="#name-finding-z-for-simplified-sw" class="section-name selfRef">Finding Z for Simplified SWU</a>
        </h2>
<p id="section-e.2-1">The below function outputs an appropriate Z for the Simplified SWU map (<a href="#simple-swu" class="xref">Section 6.6.2</a>).<a href="#section-e.2-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft art-sage" id="section-e.2-2">
<pre>
# Arguments:
# - F, a field object, e.g., F = GF(2^521 - 1)
# - A and B, the coefficients of the curve equation y^2 = x^3 + A * x + B
def find_z_sswu(F, A, B):
    R.&lt;xx&gt; = F[]                        # Polynomial ring over F
    g = xx^3 + F(A) * xx + F(B)         # y^2 = g(x) = x^3 + A * x + B
    ctr = F.gen()
    while True:
        for Z_cand in (F(ctr), F(-ctr)):
            if Z_cand.is_square():
                # Criterion 1: Z is non-square in F.
                continue
            if Z_cand == F(-1):
                # Criterion 2: Z != -1 in F.
                continue
            if not (g - Z_cand).is_irreducible():
                # Criterion 3: g(x) - Z is irreducible over F.
                continue
            if g(B / (Z_cand * A)).is_square():
                # Criterion 4: g(B / (Z * A)) is square in F.
                return Z_cand
        ctr += 1
</pre><a href="#section-e.2-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="elligator-z-code">
<section id="section-e.3">
        <h2 id="name-finding-z-for-elligator-2">
<a href="#section-e.3" class="section-number selfRef">E.3. </a><a href="#name-finding-z-for-elligator-2" class="section-name selfRef">Finding Z for Elligator 2</a>
        </h2>
<p id="section-e.3-1">The below function outputs an appropriate Z for the Elligator 2 map (<a href="#elligator2" class="xref">Section 6.7.1</a>).<a href="#section-e.3-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft art-sage" id="section-e.3-2">
<pre>
# Argument:
# - F, a field object, e.g., F = GF(2^255 - 19)
def find_z_ell2(F):
    ctr = F.gen()
    while True:
        for Z_cand in (F(ctr), F(-ctr)):
            if Z_cand.is_square():
                # Z must be a non-square in F.
                continue
            return Z_cand
        ctr += 1
</pre><a href="#section-e.3-2" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="appx-sqrt">
<section id="section-appendix.f">
      <h2 id="name-sqrt-functions">
<a href="#section-appendix.f" class="section-number selfRef">Appendix F. </a><a href="#name-sqrt-functions" class="section-name selfRef">sqrt functions</a>
      </h2>
<p id="section-appendix.f-1">This section defines special-purpose sqrt functions for the three most common cases,
q = 3 (mod 4), q = 5 (mod 8), and q = 9 (mod 16).
In addition, it gives a generic constant-time algorithm that works for any prime modulus.<a href="#section-appendix.f-1" class="pilcrow">¶</a></p>
<p id="section-appendix.f-2"><span>[<a href="#AR13" class="xref">AR13</a>]</span> and <span>[<a href="#S85" class="xref">S85</a>]</span> describe optimized methods for extension fields.<a href="#section-appendix.f-2" class="pilcrow">¶</a></p>
<div id="sqrt-3mod4">
<section id="section-f.1">
        <h2 id="name-q-3-mod-4">
<a href="#section-f.1" class="section-number selfRef">F.1. </a><a href="#name-q-3-mod-4" class="section-name selfRef">q = 3 (mod 4)</a>
        </h2>
<div class="artwork art-text alignLeft" id="section-f.1-1">
<pre>
sqrt_3mod4(x)

Parameters:
- F, a finite field of characteristic p and order q = p^m.

Input: x, an element of F.
Output: z, an element of F such that (z^2) == x, if x is square in F.

Constants:
1. c1 = (q + 1) / 4     # Integer arithmetic

Procedure:
1. return x^c1
</pre><a href="#section-f.1-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="sqrt-5mod8">
<section id="section-f.2">
        <h2 id="name-q-5-mod-8">
<a href="#section-f.2" class="section-number selfRef">F.2. </a><a href="#name-q-5-mod-8" class="section-name selfRef">q = 5 (mod 8)</a>
        </h2>
<div class="artwork art-text alignLeft" id="section-f.2-1">
<pre>
sqrt_5mod8(x)

Parameters:
- F, a finite field of characteristic p and order q = p^m.

Input: x, an element of F.
Output: z, an element of F such that (z^2) == x, if x is square in F.

Constants:
1. c1 = sqrt(-1) in F, i.e., (c1^2) == -1 in F
2. c2 = (q + 3) / 8     # Integer arithmetic

Procedure:
1. tv1 = x^c2
2. tv2 = tv1 * c1
3.   e = (tv1^2) == x
4.   z = CMOV(tv2, tv1, e)
5. return z
</pre><a href="#section-f.2-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="sqrt-9mod16">
<section id="section-f.3">
        <h2 id="name-q-9-mod-16">
<a href="#section-f.3" class="section-number selfRef">F.3. </a><a href="#name-q-9-mod-16" class="section-name selfRef">q = 9 (mod 16)</a>
        </h2>
<div class="artwork art-text alignLeft" id="section-f.3-1">
<pre>
sqrt_9mod16(x)

Parameters:
- F, a finite field of characteristic p and order q = p^m.

Input: x, an element of F.
Output: z, an element of F such that (z^2) == x, if x is square in F.

Constants:
1. c1 = sqrt(-1) in F, i.e., (c1^2) == -1 in F
2. c2 = sqrt(c1) in F, i.e., (c2^2) == c1 in F
3. c3 = sqrt(-c1) in F, i.e., (c3^2) == -c1 in F
4. c4 = (q + 7) / 16         # Integer arithmetic

Procedure:
1. tv1 = x^c4
2. tv2 = c1 * tv1
3. tv3 = c2 * tv1
4. tv4 = c3 * tv1
5.  e1 = (tv2^2) == x
6.  e2 = (tv3^2) == x
7. tv1 = CMOV(tv1, tv2, e1)  # Select tv2 if (tv2^2) == x
8. tv2 = CMOV(tv4, tv3, e2)  # Select tv3 if (tv3^2) == x
9.  e3 = (tv2^2) == x
10.  z = CMOV(tv1, tv2, e3)  # Select the sqrt from tv1 and tv2
11. return z
</pre><a href="#section-f.3-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="sqrt-ts">
<section id="section-f.4">
        <h2 id="name-constant-time-tonelli-shank">
<a href="#section-f.4" class="section-number selfRef">F.4. </a><a href="#name-constant-time-tonelli-shank" class="section-name selfRef">Constant-time Tonelli-Shanks algorithm</a>
        </h2>
<p id="section-f.4-1">This algorithm is a constant-time version of the classic Tonelli-Shanks algorithm
(<span>[<a href="#C93" class="xref">C93</a>]</span>, Algorithm 1.5.1) due to Sean Bowe, Jack Grigg, and Eirik Ogilvie-Wigley <span>[<a href="#jubjub-fq" class="xref">jubjub-fq</a>]</span>,
adapted and optimized by Michael Scott.<a href="#section-f.4-1" class="pilcrow">¶</a></p>
<p id="section-f.4-2">This algorithm applies to GF(p) for any p.
Note, however, that the special-purpose algorithms given in the prior sections are
faster, when they apply.<a href="#section-f.4-2" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-f.4-3">
<pre>
sqrt_ts_ct(x)

Parameters:
- F, a finite field of characteristic p and order q = p^m.

Input x, an element of F.
Output: z, an element of F such that z^2 == x, if x is square in F.

Constants:
1. c1, the largest integer such that 2^c1 divides q - 1.
2. c2 = (q - 1) / (2^c1)        # Integer arithmetic
3. c3 = (c2 - 1) / 2            # Integer arithmetic
4. c4, a non-square value in F
5. c5 = c4^c2 in F

Procedure:
1.  z = x^c3
2.  t = z * z * x
3.  z = z * x
4.  b = t
5.  c = c5
6.  for i in (c1, c1 - 1, ..., 2):
7.      for j in (1, 2, ..., i - 2):
8.           b = b * b
9.      z = CMOV(z, z * c, b != 1)
10.     c = c * c
11.     t = CMOV(t, t * c, b != 1)
12.     b = t
13. return z
</pre><a href="#section-f.4-3" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="authors-addresses">
<section id="section-appendix.g">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Armando Faz-Hernandez</span></div>
<div dir="auto" class="left"><span class="org">Cloudflare</span></div>
<div dir="auto" class="left"><span class="street-address">101 Townsend St</span></div>
<div dir="auto" class="left">
<span class="locality">San Francisco</span>,  </div>
<div dir="auto" class="left"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:armfazh@cloudflare.com" class="email">armfazh@cloudflare.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Sam Scott</span></div>
<div dir="auto" class="left"><span class="org">Cornell Tech</span></div>
<div dir="auto" class="left"><span class="street-address">2 West Loop Rd</span></div>
<div dir="auto" class="left">
<span class="locality">New York, New York 10044</span>,  </div>
<div dir="auto" class="left"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:sam.scott@cornell.edu" class="email">sam.scott@cornell.edu</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Nick Sullivan</span></div>
<div dir="auto" class="left"><span class="org">Cloudflare</span></div>
<div dir="auto" class="left"><span class="street-address">101 Townsend St</span></div>
<div dir="auto" class="left">
<span class="locality">San Francisco</span>,  </div>
<div dir="auto" class="left"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:nick@cloudflare.com" class="email">nick@cloudflare.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Riad S. Wahby</span></div>
<div dir="auto" class="left"><span class="org">Stanford University</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:rsw@cs.stanford.edu" class="email">rsw@cs.stanford.edu</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Christopher A. Wood</span></div>
<div dir="auto" class="left"><span class="org">Apple Inc.</span></div>
<div dir="auto" class="left"><span class="street-address">One Apple Park Way</span></div>
<div dir="auto" class="left">
<span class="locality">Cupertino, California 95014</span>,  </div>
<div dir="auto" class="left"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:cawood@apple.com" class="email">cawood@apple.com</a>
</div>
</address>
</section>
</div>
<script>var toc = document.getElementById("toc");
var tocToggle = toc.querySelector("h2");
var tocNav = toc.querySelector("nav");

// mobile menu toggle
tocToggle.onclick = function(event) {
    if (window.innerWidth < 1024) {
 var tocNavDisplay = tocNav.currentStyle ? tocNav.currentStyle.display : getComputedStyle(tocNav, null).display;
 if (tocNavDisplay == "none") {
     tocNav.style.display = "block";
 } else {
     tocNav.style.display = "none";
 }
    }
}

// toc anchor scroll to anchor
tocNav.addEventListener("click", function (event) {
    event.preventDefault();
    if (event.target.nodeName == 'A') {
 if (window.innerWidth < 1024) {
     tocNav.style.display = "none";
 }
 var href = event.target.getAttribute("href");
 var anchorId = href.substr(1);
 var anchor =  document.getElementById(anchorId);
 anchor.scrollIntoView(true);
 window.history.pushState("","",href);
    }
});

// switch toc mode when window resized
window.onresize = function () {
    if (window.innerWidth < 1024) {
 tocNav.style.display = "none";
    } else {
 tocNav.style.display = "block";
    }
}
</script>
</body>
</html>
